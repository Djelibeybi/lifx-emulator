import{a as b,f as y,c as ke}from"../chunks/Binc8JbE.js";import{i as kt}from"../chunks/BORyfda6.js";import{o as Xt,a as Kt}from"../chunks/yhjkpkcN.js";import{i as _t,b as Qt,h as xe,c as pt,L as $t,a as ea,w as t,r as ta,H as aa,s as Ct,d as bt,k as vt,S as ra,as as sa,ab as Tt,e as Oe,aN as Be,j as yt,l as ia,aH as la,aO as Rt,aq as St,aP as na,aQ as oa,aL as va,Y as At,aR as ca,f as Ot,p as Bt,aS as ht,aT as da,ap as ua,g as fa,U as _a,aU as Vt,_ as Ht,aV as pa,aj as ba,aW as ha,aX as ma,aY as zt,V as ga,aZ as Ut,a_ as wa,a$ as ya,b0 as xa,b1 as ka,b2 as Sa,aM as za,q as Wt,X as jt,aw as h,au as Z,B as De,C as ve,D as O,F as Me,G as i,J as n,I as r,ac as ct,av as nt,ax as Le,o as dt}from"../chunks/DfIkQq0Y.js";import{d as Je,s as z,e as Fa}from"../chunks/BaoxLdOF.js";import{i as R}from"../chunks/BTLkiQR5.js";import{s as Ke,a as ot,d as U,b as qe,u as I,t as mt}from"../chunks/DK1z4bVD.js";function Se(e,a){return a}function Ea(e,a,l){for(var s=[],o=a.length,c,d=a.length,w=0;w<o;w++){let u=a[w];Bt(u,()=>{if(c){if(c.pending.delete(u),c.done.add(u),c.pending.size===0){var f=e.outrogroups;xt(St(c.done)),f.delete(c),f.size===0&&(e.outrogroups=null)}}else d-=1},!1)}if(d===0){var m=s.length===0&&l!==null;if(m){var x=l,_=x.parentNode;ua(_),_.append(x),e.items.clear()}xt(a,!m)}else c={pending:new Set(a),done:new Set},(e.outrogroups??=new Set).add(c)}function xt(e,a=!0){for(var l=0;l<e.length;l++)fa(e[l],a)}var Pt;function he(e,a,l,s,o,c=null){var d=e,w=new Map,m=(a&Vt)!==0;if(m){var x=e;d=xe?pt($t(x)):x.appendChild(_t())}xe&&ea();var _=null,u=la(()=>{var S=l();return Rt(S)?S:S==null?[]:St(S)}),f,v=!0;function C(){g.fallback=_,Ia(g,f,d,a,s),_!==null&&(f.length===0?(_.f&Be)===0?Ot(_):(_.f^=Be,it(_,null,d)):Bt(_,()=>{_=null}))}var B=Qt(()=>{f=t(u);var S=f.length;let D=!1;if(xe){var A=ta(d)===aa;A!==(S===0)&&(d=Ct(),pt(d),bt(!1),D=!0)}for(var X=new Set,E=Oe,L=ia(),M=0;M<S;M+=1){xe&&vt.nodeType===ra&&vt.data===sa&&(d=vt,D=!0,bt(!1));var W=f[M],j=s(W,M),V=v?null:w.get(j);V?(V.v&&Tt(V.v,W),V.i&&Tt(V.i,M),L&&E.skipped_effects.delete(V.e)):(V=La(w,v?d:Pt??=_t(),W,j,M,o,a,l),v||(V.e.f|=Be),w.set(j,V)),X.add(j)}if(S===0&&c&&!_&&(v?_=yt(()=>c(d)):(_=yt(()=>c(Pt??=_t())),_.f|=Be)),xe&&S>0&&pt(Ct()),!v)if(L){for(const[fe,Q]of w)X.has(fe)||E.skipped_effects.add(Q.e);E.oncommit(C),E.ondiscard(()=>{})}else C();D&&bt(!0),t(u)}),g={effect:B,items:w,outrogroups:null,fallback:_};v=!1,xe&&(d=vt)}function st(e){for(;e!==null&&(e.f&da)===0;)e=e.next;return e}function Ia(e,a,l,s,o){var c=(s&pa)!==0,d=a.length,w=e.items,m=st(e.effect.first),x,_=null,u,f=[],v=[],C,B,g,S;if(c)for(S=0;S<d;S+=1)C=a[S],B=o(C,S),g=w.get(B).e,(g.f&Be)===0&&(g.nodes?.a?.measure(),(u??=new Set).add(g));for(S=0;S<d;S+=1){if(C=a[S],B=o(C,S),g=w.get(B).e,e.outrogroups!==null)for(const V of e.outrogroups)V.pending.delete(g),V.done.delete(g);if((g.f&Be)!==0)if(g.f^=Be,g===m)it(g,null,l);else{var D=_?_.next:m;g===e.effect.last&&(e.effect.last=g.prev),g.prev&&(g.prev.next=g.next),g.next&&(g.next.prev=g.prev),je(e,_,g),je(e,g,D),it(g,D,l),_=g,f=[],v=[],m=st(_.next);continue}if((g.f&ht)!==0&&(Ot(g),c&&(g.nodes?.a?.unfix(),(u??=new Set).delete(g))),g!==m){if(x!==void 0&&x.has(g)){if(f.length<v.length){var A=v[0],X;_=A.prev;var E=f[0],L=f[f.length-1];for(X=0;X<f.length;X+=1)it(f[X],A,l);for(X=0;X<v.length;X+=1)x.delete(v[X]);je(e,E.prev,L.next),je(e,_,E),je(e,L,A),m=A,_=L,S-=1,f=[],v=[]}else x.delete(g),it(g,m,l),je(e,g.prev,g.next),je(e,g,_===null?e.effect.first:_.next),je(e,_,g),_=g;continue}for(f=[],v=[];m!==null&&m!==g;)(x??=new Set).add(m),v.push(m),m=st(m.next);if(m===null)continue}(g.f&Be)===0&&f.push(g),_=g,m=st(g.next)}if(e.outrogroups!==null){for(const V of e.outrogroups)V.pending.size===0&&(xt(St(V.done)),e.outrogroups?.delete(V));e.outrogroups.size===0&&(e.outrogroups=null)}if(m!==null||x!==void 0){var M=[];if(x!==void 0)for(g of x)(g.f&ht)===0&&M.push(g);for(;m!==null;)(m.f&ht)===0&&m!==e.fallback&&M.push(m),m=st(m.next);var W=M.length;if(W>0){var j=(s&Vt)!==0&&d===0?l:null;if(c){for(S=0;S<W;S+=1)M[S].nodes?.a?.measure();for(S=0;S<W;S+=1)M[S].nodes?.a?.fix()}Ea(e,M,j)}}c&&Ht(()=>{if(u!==void 0)for(g of u)g.nodes?.a?.apply()})}function La(e,a,l,s,o,c,d,w){var m=(d&na)!==0?(d&oa)===0?va(l,!1,!1):At(l):null,x=(d&ca)!==0?At(o):null;return{v:m,i:x,e:yt(()=>(c(a,m??l,x??o,w),()=>{e.delete(s)}))}}function it(e,a,l){if(e.nodes)for(var s=e.nodes.start,o=e.nodes.end,c=a&&(a.f&Be)===0?a.nodes.start:l;s!==null;){var d=_a(s);if(c.before(s),s===o)return;s=d}}function je(e,a,l){a===null?e.effect.first=l:a.next=l,l===null?e.effect.last=a:l.prev=a}function qt(e){var a,l,s="";if(typeof e=="string"||typeof e=="number")s+=e;else if(typeof e=="object")if(Array.isArray(e)){var o=e.length;for(a=0;a<o;a++)e[a]&&(l=qt(e[a]))&&(s&&(s+=" "),s+=l)}else for(l in e)e[l]&&(s&&(s+=" "),s+=l);return s}function Ca(){for(var e,a,l=0,s="",o=arguments.length;l<o;l++)(e=arguments[l])&&(a=qt(e))&&(s&&(s+=" "),s+=a);return s}function Ta(e){return typeof e=="object"?Ca(e):e??""}const Dt=[...`
\r\f \v\uFEFF`];function Aa(e,a,l){var s=e==null?"":""+e;if(a&&(s=s?s+" "+a:a),l){for(var o in l)if(l[o])s=s?s+" "+o:o;else if(s.length)for(var c=o.length,d=0;(d=s.indexOf(o,d))>=0;){var w=d+c;(d===0||Dt.includes(s[d-1]))&&(w===s.length||Dt.includes(s[w]))?s=(d===0?"":s.substring(0,d))+s.substring(w+1):d=w}}return s===""?null:s}function Pa(e,a){return e==null?null:String(e)}function Ce(e,a,l,s,o,c){var d=e.__className;if(xe||d!==l||d===void 0){var w=Aa(l,s,c);(!xe||w!==e.getAttribute("class"))&&(w==null?e.removeAttribute("class"):e.className=w),e.__className=l}else if(c&&o!==c)for(var m in c){var x=!!c[m];(o==null||x!==!!o[m])&&e.classList.toggle(m,x)}return c}function Pe(e,a,l,s){var o=e.__style;if(xe||o!==a){var c=Pa(a);(!xe||c!==e.getAttribute("style"))&&(c==null?e.removeAttribute("style"):e.style.cssText=c),e.__style=a}return s}function Ft(e,a,l=!1){if(e.multiple){if(a==null)return;if(!Rt(a))return ha();for(var s of e.options)s.selected=a.includes(lt(s));return}for(s of e.options){var o=lt(s);if(ma(o,a)){s.selected=!0;return}}(!l||a!==void 0)&&(e.selectedIndex=-1)}function Gt(e){var a=new MutationObserver(()=>{Ft(e,e.__value)});a.observe(e,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["value"]}),ba(()=>{a.disconnect()})}function Et(e,a,l=a){var s=new WeakSet,o=!0;zt(e,"change",c=>{var d=c?"[selected]":":checked",w;if(e.multiple)w=[].map.call(e.querySelectorAll(d),lt);else{var m=e.querySelector(d)??e.querySelector("option:not([disabled])");w=m&&lt(m)}l(w),Oe!==null&&s.add(Oe)}),ga(()=>{var c=a();if(e===document.activeElement){var d=Ut??Oe;if(s.has(d))return}if(Ft(e,c,o),o&&c===void 0){var w=e.querySelector(":checked");w!==null&&(c=lt(w),l(c))}e.__value=c,o=!1}),Gt(e)}function lt(e){return"__value"in e?e.__value:e.value}const Da=Symbol("is custom element"),Ma=Symbol("is html");function Fe(e){if(xe){var a=!1,l=()=>{if(!a){if(a=!0,e.hasAttribute("value")){var s=e.value;et(e,"value",null),e.value=s}if(e.hasAttribute("checked")){var o=e.checked;et(e,"checked",null),e.checked=o}}};e.__on_r=l,Ht(l),ka()}}function et(e,a,l,s){var o=Na(e);xe&&(o[a]=e.getAttribute(a),a==="src"||a==="srcset"||a==="href"&&e.nodeName==="LINK")||o[a]!==(o[a]=l)&&(a==="loading"&&(e[Sa]=l),l==null?e.removeAttribute(a):typeof l!="string"&&Xa(e).includes(a)?e[a]=l:e.setAttribute(a,l))}function Na(e){return e.__attributes??={[Da]:e.nodeName.includes("-"),[Ma]:e.namespaceURI===wa}}var Mt=new Map;function Xa(e){var a=e.getAttribute("is")||e.nodeName,l=Mt.get(a);if(l)return l;Mt.set(a,l=[]);for(var s,o=e,c=Element.prototype;c!==o;){s=xa(o);for(var d in s)s[d].set&&l.push(d);o=ya(o)}return l}function Ie(e,a,l=a){var s=new WeakSet;zt(e,"input",async o=>{var c=o?e.defaultValue:e.value;if(c=gt(e)?wt(c):c,l(c),Oe!==null&&s.add(Oe),await za(),c!==(c=a())){var d=e.selectionStart,w=e.selectionEnd,m=e.value.length;if(e.value=c??"",w!==null){var x=e.value.length;d===w&&w===m&&x>m?(e.selectionStart=x,e.selectionEnd=x):(e.selectionStart=d,e.selectionEnd=Math.min(w,x))}}}),(xe&&e.defaultValue!==e.value||Wt(a)==null&&e.value)&&(l(gt(e)?wt(e.value):e.value),Oe!==null&&s.add(Oe)),jt(()=>{var o=a();if(e===document.activeElement){var c=Ut??Oe;if(s.has(c))return}gt(e)&&o===wt(e.value)||e.type==="date"&&!o&&!e.value||o!==e.value&&(e.value=o??"")})}function Ra(e,a,l=a){zt(e,"change",s=>{var o=s?e.defaultChecked:e.checked;l(o)}),(xe&&e.defaultChecked!==e.checked||Wt(a)==null)&&l(e.checked),jt(()=>{var s=a();e.checked=!!s})}function gt(e){var a=e.type;return a==="number"||a==="range"}function wt(e){return e===""?null:+e}const Nt=2e3,Oa=3e4;function Ba(){let e=Z("disconnected"),a=null,l=Nt,s=null,o=!0;function c(){return`${window.location.protocol==="https:"?"wss:":"ws:"}//${window.location.host}/ws`}function d(u){try{const f=JSON.parse(u.data);switch(f.type){case"sync":{const v=f.data;v.stats&&qe.set(v.stats),v.devices&&U.set(v.devices),v.activity&&ot.set(v.activity),v.scenarios&&Ke.setAll(v.scenarios);break}case"stats":qe.set(f.data);break;case"device_added":U.add(f.data);break;case"device_removed":{const{serial:v}=f.data;U.remove(v);break}case"device_updated":{const{serial:v,changes:C}=f.data;console.log("device_updated received:",v,C),C.category!==void 0?(console.log("Using updateWithTransition for category:",C.category),U.updateWithTransition(v,C)):U.update(v,C);break}case"activity":ot.add(f.data);break;case"scenario_changed":Ke.handleChange(f.data);break;case"error":console.error("WebSocket error:",f.message);break}}catch(f){console.error("Failed to parse WebSocket message:",f)}}function w(){if(o=!0,!(a&&(a.readyState===WebSocket.CONNECTING||a.readyState===WebSocket.OPEN))){h(e,"connecting");try{a=new WebSocket(c()),a.onopen=()=>{h(e,"connected"),l=Nt,a.send(JSON.stringify({type:"subscribe",topics:["stats","devices","activity","scenarios"]})),a.send(JSON.stringify({type:"sync"}))},a.onmessage=d,a.onclose=()=>{h(e,"disconnected"),a=null,o&&m()},a.onerror=()=>{h(e,"error"),a?.close()}}catch(u){console.error("WebSocket connection error:",u),h(e,"error"),m()}}}function m(){s&&clearTimeout(s),s=setTimeout(()=>{s=null,w()},l),l=Math.min(l*1.5,Oa)}function x(){o=!1,s&&(clearTimeout(s),s=null),a&&(a.close(),a=null),h(e,"disconnected")}function _(u){a&&a.readyState===WebSocket.OPEN&&a.send(JSON.stringify(u))}return{get status(){return t(e)},connect:w,disconnect:x,send:_,sync(){_({type:"sync"})}}}const $e=Ba();var Va=y('<header class="header"><div class="header-title"><h1>LIFX Emulator Monitor</h1> <span></span></div> <div class="header-controls svelte-1elxaub"><button><svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor"><rect x="1" y="9" width="3" height="6" rx="0.5"></rect><rect x="6" y="5" width="3" height="10" rx="0.5"></rect><rect x="11" y="1" width="3" height="14" rx="0.5"></rect></svg></button> <button class="control-btn svelte-1elxaub"> </button></div></header> <p class="subtitle">Real-time monitoring and device management</p>',1);function Ha(e,a){De(a,!1);const l={light:"☀",dark:"☾",system:"◐"};kt();var s=Va(),o=ve(s),c=i(o),d=n(i(c),2);let w;r(c);var m=n(c,2),x=i(m);let _;x.__click=()=>I.toggleShowStats();var u=n(x,2);u.__click=()=>mt.toggle();var f=i(u,!0);r(u),r(m),r(o),ct(2),O(()=>{w=Ce(d,1,"status-indicator",null,w,{connecting:$e.status==="connecting",disconnected:$e.status==="disconnected",error:$e.status==="error"}),et(d,"title",$e.status),_=Ce(x,1,"control-btn svelte-1elxaub",null,_,{active:I.showStats}),et(x,"title",I.showStats?"Hide statistics":"Show statistics"),et(u,"title",`Toggle theme (${mt.mode})`),z(f,l[mt.mode])}),b(e,s),Me()}Je(["click"]);function Ge(e){const a=e.hue/65535,l=e.saturation/65535,s=e.brightness/65535;let o,c,d;const w=Math.floor(a*6),m=a*6-w,x=s*(1-l),_=s*(1-m*l),u=s*(1-(1-m)*l);switch(w%6){case 0:o=s,c=u,d=x;break;case 1:o=_,c=s,d=x;break;case 2:o=x,c=s,d=u;break;case 3:o=x,c=_,d=s;break;case 4:o=u,c=x,d=s;break;default:o=s,c=x,d=_;break}const f=Math.round(o*255),v=Math.round(c*255),C=Math.round(d*255);return`rgb(${f}, ${v}, ${C})`}function Ua(e){const a=Math.floor(e);if(a<60)return`${a}s`;if(a<3600)return`${Math.floor(a/60)}m ${a%60}s`;const l=Math.floor(a/3600),s=Math.floor(a%3600/60);return`${l}h ${s}m`}var Wa=y('<div class="card"><h2><span class="status-indicator"></span> Server Statistics</h2> <div class="stats-list"><div class="stat"><span class="stat-label">Uptime</span> <span class="stat-value"> </span></div> <div class="stat"><span class="stat-label">Devices</span> <span class="stat-value"> </span></div> <div class="stat"><span class="stat-label">Packets RX</span> <span class="stat-value"> </span></div> <div class="stat"><span class="stat-label">Packets TX</span> <span class="stat-value"> </span></div> <div class="stat"><span class="stat-label">Errors</span> <span class="stat-value"> </span></div></div></div>');function ja(e,a){De(a,!1),kt();var l=Wa(),s=n(i(l),2),o=i(s),c=n(i(o),2),d=i(c,!0);r(c),r(o);var w=n(o,2),m=n(i(w),2),x=i(m,!0);r(m),r(w);var _=n(w,2),u=n(i(_),2),f=i(u,!0);r(u),r(_);var v=n(_,2),C=n(i(v),2),B=i(C,!0);r(C),r(v);var g=n(v,2),S=n(i(g),2),D=i(S,!0);r(S),r(g),r(s),r(l),O(A=>{z(d,A),z(x,qe.value.device_count),z(f,qe.value.packets_received),z(B,qe.value.packets_sent),z(D,qe.value.error_count)},[()=>Ua(qe.value.uptime_seconds)]),b(e,l),Me()}const Ye="/api";async function qa(){const e=await fetch(`${Ye}/products`);if(!e.ok)throw new Error(`Failed to fetch products: ${e.status}`);return e.json()}async function Ga(e){const a=await fetch(`${Ye}/devices`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({product_id:e})});if(!a.ok){const l=await a.json();throw new Error(l.detail||`Failed to create device: ${a.status}`)}}async function Jt(e){const a=await fetch(`${Ye}/devices/${e}`,{method:"DELETE"});if(!a.ok)throw new Error(`Failed to delete device: ${a.status}`)}async function It(){const e=await fetch(`${Ye}/devices`,{method:"DELETE"});if(!e.ok)throw new Error(`Failed to remove devices: ${e.status}`);return e.json()}async function Ja(e){const a=await fetch(`${Ye}/scenarios/global`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!a.ok){const l=await a.json();throw new Error(l.detail||`Failed to set global scenario: ${a.status}`)}}async function Ya(){const e=await fetch(`${Ye}/scenarios/global`,{method:"DELETE"});if(!e.ok)throw new Error(`Failed to clear global scenario: ${e.status}`)}async function Za(e,a,l){const s=await fetch(`${Ye}/scenarios/${e}/${encodeURIComponent(a)}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(l)});if(!s.ok){const o=await s.json();throw new Error(o.detail||`Failed to set ${e} scenario: ${s.status}`)}}async function Ka(e,a){const l=await fetch(`${Ye}/scenarios/${e}/${encodeURIComponent(a)}`,{method:"DELETE"});if(l.status!==404&&!l.ok)throw new Error(`Failed to clear ${e} scenario: ${l.status}`)}var Qa=y("<option> </option>"),$a=y("<option>Loading products...</option>"),er=y("<option> </option>"),tr=y('<p style="color: var(--accent-danger); font-size: 0.85em; margin-top: 10px;"> </p>'),ar=y('<div class="card"><div class="toolbar-header svelte-zw83d1"><h2>Device Management</h2> <div class="toolbar-actions svelte-zw83d1"><div class="view-toggle svelte-zw83d1"><button title="Card view"><svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor"><rect x="1" y="1" width="6" height="6" rx="1"></rect><rect x="9" y="1" width="6" height="6" rx="1"></rect><rect x="1" y="9" width="6" height="6" rx="1"></rect><rect x="9" y="9" width="6" height="6" rx="1"></rect></svg></button> <button title="Table view"><svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor"><rect x="1" y="2" width="14" height="2" rx="0.5"></rect><rect x="1" y="7" width="14" height="2" rx="0.5"></rect><rect x="1" y="12" width="14" height="2" rx="0.5"></rect></svg></button></div> <div class="page-size svelte-zw83d1"><label for="page-size" class="svelte-zw83d1">Show:</label> <select id="page-size" class="svelte-zw83d1"></select></div> <button class="btn btn-delete"> </button></div></div> <form><div class="form-row"><div class="form-group"><label for="product-id">Product</label> <select id="product-id"><!></select></div> <button type="submit" class="btn"> </button></div> <!></form></div>');function rr(e,a){De(a,!0);let l=Z(nt([])),s=Z(null),o=Z(!1),c=Z(!1),d=Z(null);const w=[10,20,50,100];Xt(async()=>{try{h(l,await qa(),!0),t(l).length>0&&h(s,t(l)[0].pid,!0)}catch(T){h(d,T instanceof Error?T.message:"Failed to load products",!0)}});async function m(T){if(T.preventDefault(),t(s)!==null){h(o,!0),h(d,null);try{await Ga(t(s))}catch(H){h(d,H instanceof Error?H.message:"Failed to create device",!0)}finally{h(o,!1)}}}async function x(){if(U.count!==0&&confirm(`Remove all ${U.count} devices?`)){h(c,!0),h(d,null);try{const T=await It();console.log(`Removed ${T.removed} devices`)}catch(T){h(d,T instanceof Error?T.message:"Failed to remove devices",!0)}finally{h(c,!1)}}}function _(T){const H=T.target;I.setPageSize(parseInt(H.value,10))}var u=ar(),f=i(u),v=n(i(f),2),C=i(v),B=i(C);let g;B.__click=()=>I.setViewMode("card");var S=n(B,2);let D;S.__click=()=>I.setViewMode("table"),r(C);var A=n(C,2),X=n(i(A),2);X.__change=_,he(X,21,()=>w,Se,(T,H)=>{var K=Qa(),J=i(K,!0);r(K);var ie={};O(()=>{z(J,t(H)),ie!==(ie=t(H))&&(K.value=(K.__value=t(H))??"")}),b(T,K)}),r(X);var E;Gt(X),r(A);var L=n(A,2);L.__click=x;var M=i(L,!0);r(L),r(v),r(f);var W=n(f,2),j=i(W),V=i(j),fe=n(i(V),2),Q=i(fe);{var P=T=>{var H=$a();H.value=H.__value="",b(T,H)},re=T=>{var H=ke(),K=ve(H);he(K,17,()=>t(l),J=>J.pid,(J,ie)=>{var $=er(),k=i($);r($);var N={};O(()=>{z(k,`${t(ie).pid??""} - ${t(ie).name??""}`),N!==(N=t(ie).pid)&&($.value=($.__value=t(ie).pid)??"")}),b(J,$)}),b(T,H)};R(Q,T=>{t(l).length===0?T(P):T(re,!1)})}r(fe),r(V);var ce=n(V,2),ge=i(ce,!0);r(ce),r(j);var be=n(j,2);{var le=T=>{var H=tr(),K=i(H,!0);r(H),O(()=>z(K,t(d))),b(T,H)};R(be,T=>{t(d)&&T(le)})}r(W),r(u),O(()=>{g=Ce(B,1,"view-btn svelte-zw83d1",null,g,{active:I.viewMode==="card"}),D=Ce(S,1,"view-btn svelte-zw83d1",null,D,{active:I.viewMode==="table"}),E!==(E=I.pageSize)&&(X.value=(X.__value=I.pageSize)??"",Ft(X,I.pageSize)),L.disabled=t(c)||U.count===0,et(L,"title",U.count===0?"No devices to remove":"Remove all devices"),z(M,t(c)?"Removing...":"Remove All"),fe.disabled=t(l).length===0,ce.disabled=t(o)||t(s)===null,z(ge,t(o)?"Adding...":"Add Device")}),Fa("submit",W,m),Et(fe,()=>t(s),T=>h(s,T)),b(e,u),Me()}Je(["click","change"]);var sr=y('<span class="badge badge-capability">color</span>'),ir=y('<span class="badge badge-capability">IR</span>'),lr=y('<span class="badge badge-extended-mz"> </span>'),nr=y('<span class="badge badge-capability"> </span>'),or=y('<span class="badge badge-capability"> </span>'),vr=y('<span class="badge badge-capability">HEV</span>'),cr=y('<div class="metadata-display"><div class="metadata-row"><span class="metadata-label">Firmware:</span> <span class="metadata-value"> </span></div> <div class="metadata-row"><span class="metadata-label">Vendor:</span> <span class="metadata-value"> </span></div> <div class="metadata-row"><span class="metadata-label">Product:</span> <span class="metadata-value"> </span></div> <div class="metadata-row"><span class="metadata-label">Capabilities:</span> <span class="metadata-value" style="color: var(--accent-primary);"> </span></div> <div class="metadata-row"><span class="metadata-label">Group:</span> <span class="metadata-value"> </span></div> <div class="metadata-row"><span class="metadata-label">Location:</span> <span class="metadata-value"> </span></div> <div class="metadata-row"><span class="metadata-label">Uptime:</span> <span class="metadata-value"> </span></div> <div class="metadata-row"><span class="metadata-label">WiFi Signal:</span> <span class="metadata-value"> </span></div></div>'),dr=y('<div class="zone-segment"></div>'),ur=y('<div class="zone-strip"></div>'),fr=y('<button type="button" class="toggle-link"> </button> <!>',1),_r=y('<div class="tile-zone"></div>'),pr=y('<div class="tile-grid"></div>'),br=y('<div style="color: var(--text-dimmed);">No color data</div>'),hr=y('<div class="tile-item"><div class="tile-label"></div> <!></div>'),mr=y('<div class="tiles-container"></div>'),gr=y('<button type="button" class="toggle-link"> </button> <!>',1),wr=y('<div style="margin-top: 4px;"><span class="color-swatch"></span> <span style="color: var(--text-muted); font-size: 0.75em;">Current color</span></div>'),yr=y('<div class="device"><div class="device-header"><div><div class="device-serial"> </div> <div class="device-label"> </div></div> <button class="btn btn-delete btn-sm"> </button></div> <div class="badges"><span> </span> <span class="badge badge-capability"> </span> <!> <!> <!> <!> <!></div> <button type="button" class="toggle-link"> </button> <!> <!></div>');function xr(e,a){De(a,!0);let l=Z(!1);async function s(){if(confirm(`Delete device ${a.device.serial}?`)){h(l,!0);try{await Jt(a.device.serial)}catch(k){alert(k instanceof Error?k.message:"Failed to delete device")}finally{h(l,!1)}}}function o(k){return`${Math.floor(k/1e9)}s`}function c(){const k=[];return a.device.has_color&&k.push("Color"),a.device.has_infrared&&k.push("Infrared"),a.device.has_multizone&&k.push(`Multizone (${a.device.zone_count} zones)`),a.device.has_extended_multizone&&k.push("Extended Multizone"),a.device.has_matrix&&k.push(`Matrix (${a.device.tile_count} tiles)`),a.device.has_hev&&k.push("HEV/Clean"),a.device.has_relays&&k.push("Relays"),a.device.has_buttons&&k.push("Buttons"),k.join(", ")||"None"}let d=Le(()=>I.isZonesExpanded(a.device.serial)),w=Le(()=>I.isMetadataExpanded(a.device.serial));var m=yr(),x=i(m),_=i(x),u=i(_),f=i(u,!0);r(u);var v=n(u,2),C=i(v,!0);r(v),r(_);var B=n(_,2);B.__click=s;var g=i(B,!0);r(B),r(x);var S=n(x,2),D=i(S);let A;var X=i(D,!0);r(D);var E=n(D,2),L=i(E);r(E);var M=n(E,2);{var W=k=>{var N=sr();b(k,N)};R(M,k=>{a.device.has_color&&k(W)})}var j=n(M,2);{var V=k=>{var N=ir();b(k,N)};R(j,k=>{a.device.has_infrared&&k(V)})}var fe=n(j,2);{var Q=k=>{var N=lr(),Y=i(N);r(N),O(()=>z(Y,`extended-mz×${a.device.zone_count??""}`)),b(k,N)},P=k=>{var N=ke(),Y=ve(N);{var ee=te=>{var q=nr(),de=i(q);r(q),O(()=>z(de,`multizone×${a.device.zone_count??""}`)),b(te,q)};R(Y,te=>{a.device.has_multizone&&te(ee)},!0)}b(k,N)};R(fe,k=>{a.device.has_extended_multizone?k(Q):k(P,!1)})}var re=n(fe,2);{var ce=k=>{var N=or(),Y=i(N);r(N),O(()=>z(Y,`matrix×${a.device.tile_count??""}`)),b(k,N)};R(re,k=>{a.device.has_matrix&&k(ce)})}var ge=n(re,2);{var be=k=>{var N=vr();b(k,N)};R(ge,k=>{a.device.has_hev&&k(be)})}r(S);var le=n(S,2);le.__click=()=>I.toggleMetadataExpanded(a.device.serial);var T=i(le);r(le);var H=n(le,2);{var K=k=>{var N=cr(),Y=i(N),ee=n(i(Y),2),te=i(ee);r(ee),r(Y);var q=n(Y,2),de=n(i(q),2),ae=i(de,!0);r(de),r(q);var ne=n(q,2),oe=n(i(ne),2),_e=i(oe,!0);r(oe),r(ne);var pe=n(ne,2),se=n(i(pe),2),me=i(se,!0);r(se),r(pe);var ue=n(pe,2),Ne=n(i(ue),2),Ve=i(Ne,!0);r(Ne),r(ue);var He=n(ue,2),Ze=n(i(He),2),tt=i(Ze,!0);r(Ze),r(He);var Ue=n(He,2),we=n(i(Ue),2),Te=i(we,!0);r(we),r(Ue);var Xe=n(Ue,2),Qe=n(i(Xe),2),p=i(Qe);r(Qe),r(Xe),r(N),O((F,G,ye)=>{z(te,`${a.device.version_major??""}.${a.device.version_minor??""}`),z(ae,a.device.vendor),z(_e,a.device.product),z(me,F),z(Ve,a.device.group_label),z(tt,a.device.location_label),z(Te,G),z(p,`${ye??""} dBm`)},[c,()=>o(a.device.uptime_ns),()=>a.device.wifi_signal.toFixed(1)]),b(k,N)};R(H,k=>{t(w)&&k(K)})}var J=n(H,2);{var ie=k=>{var N=fr(),Y=ve(N);Y.__click=()=>I.toggleZonesExpanded(a.device.serial);var ee=i(Y);r(Y);var te=n(Y,2);{var q=de=>{var ae=ur();he(ae,21,()=>a.device.zone_colors,Se,(ne,oe)=>{var _e=dr();O(pe=>Pe(_e,`background: ${pe??""};`),[()=>Ge(t(oe))]),b(ne,_e)}),r(ae),b(de,ae)};R(te,de=>{t(d)&&de(q)})}O(()=>z(ee,`${t(d)?"▾":"▸"} ${t(d)?"Hide":"Show"} zones (${a.device.zone_colors.length??""})`)),b(k,N)},$=k=>{var N=ke(),Y=ve(N);{var ee=q=>{var de=gr(),ae=ve(de);ae.__click=()=>I.toggleZonesExpanded(a.device.serial);var ne=i(ae);r(ae);var oe=n(ae,2);{var _e=pe=>{var se=mr();he(se,21,()=>a.device.tile_devices,Se,(me,ue,Ne)=>{var Ve=hr(),He=i(Ve);He.textContent=`T${Ne+1}`;var Ze=n(He,2);{var tt=we=>{var Te=pr();he(Te,21,()=>t(ue).colors.slice(0,(t(ue).width||8)*(t(ue).height||8)),Se,(Xe,Qe)=>{var p=_r();O(F=>Pe(p,`background: ${F??""};`),[()=>Ge(t(Qe))]),b(Xe,p)}),r(Te),O(()=>Pe(Te,`grid-template-columns: repeat(${(t(ue).width||8)??""}, 8px);`)),b(we,Te)},Ue=we=>{var Te=br();b(we,Te)};R(Ze,we=>{t(ue).colors&&t(ue).colors.length>0?we(tt):we(Ue,!1)})}r(Ve),b(me,Ve)}),r(se),b(pe,se)};R(oe,pe=>{t(d)&&pe(_e)})}O(()=>z(ne,`${t(d)?"▾":"▸"} ${t(d)?"Hide":"Show"} tiles (${a.device.tile_devices.length??""})`)),b(q,de)},te=q=>{var de=ke(),ae=ve(de);{var ne=oe=>{var _e=wr(),pe=i(_e);ct(2),r(_e),O(se=>Pe(pe,`background: ${se??""};`),[()=>Ge(a.device.color)]),b(oe,_e)};R(ae,oe=>{a.device.has_color&&a.device.color&&oe(ne)},!0)}b(q,de)};R(Y,q=>{a.device.has_matrix&&a.device.tile_devices&&a.device.tile_devices.length>0?q(ee):q(te,!1)},!0)}b(k,N)};R(J,k=>{a.device.has_multizone&&a.device.zone_colors&&a.device.zone_colors.length>0?k(ie):k($,!1)})}r(m),O(()=>{z(f,a.device.serial),z(C,a.device.label),B.disabled=t(l),z(g,t(l)?"...":"Del"),A=Ce(D,1,"badge",null,A,{"badge-power-on":a.device.power_level>0,"badge-power-off":a.device.power_level===0}),z(X,a.device.power_level>0?"ON":"OFF"),z(L,`P${a.device.product??""}`),z(T,`${t(w)?"▾":"▸"} ${t(w)?"Hide":"Show"} metadata`)}),b(e,m),Me()}Je(["click"]);var kr=y('<div class="no-devices">No devices emulated</div>'),Sr=y('<div class="pagination svelte-qz4xni"><button class="btn btn-sm">Previous</button> <span class="page-info svelte-qz4xni"> </span> <button class="btn btn-sm">Next</button></div>'),zr=y('<div class="devices-grid"></div> <!>',1),Fr=y('<div class="card"><h2 style="display: flex; justify-content: space-between; align-items: center;"><span> </span> <button class="btn btn-delete" title="Remove all devices from server (runtime only)"> </button></h2> <!></div>');function Er(e,a){De(a,!0);let l=Z(!1),s=Z(nt(U.count));async function o(){if(U.count===0){alert("No devices to remove");return}const D=`Remove all ${U.count} device(s) from the server?

This will stop all devices from responding to LIFX protocol packets, but will not delete persistent storage.`;if(confirm(D)){h(l,!0);try{const A=await It();alert(A.message)}catch(A){alert(A instanceof Error?A.message:"Failed to remove devices")}finally{h(l,!1)}}}let c=Le(()=>Math.max(1,Math.ceil(U.count/I.pageSize))),d=Le(()=>{const D=(I.currentPage-1)*I.pageSize,A=D+I.pageSize;return U.list.slice(D,A)});function w(){I.currentPage>1&&I.setCurrentPage(I.currentPage-1)}function m(){I.currentPage<t(c)&&I.setCurrentPage(I.currentPage+1)}dt(()=>{if(Math.abs(U.count-t(s))>0){const A=Math.max(1,Math.ceil(U.count/I.pageSize));I.currentPage>A&&I.setCurrentPage(1),h(s,U.count,!0)}});var x=Fr(),_=i(x),u=i(_),f=i(u);r(u);var v=n(u,2);v.__click=o;var C=i(v,!0);r(v),r(_);var B=n(_,2);{var g=D=>{var A=kr();b(D,A)},S=D=>{var A=zr(),X=ve(A);he(X,21,()=>t(d),M=>M.serial,(M,W)=>{xr(M,{get device(){return t(W)}})}),r(X);var E=n(X,2);{var L=M=>{var W=Sr(),j=i(W);j.__click=w;var V=n(j,2),fe=i(V);r(V);var Q=n(V,2);Q.__click=m,r(W),O(()=>{j.disabled=I.currentPage<=1,z(fe,`Page ${I.currentPage??""} of ${t(c)??""}`),Q.disabled=I.currentPage>=t(c)}),b(M,W)};R(E,M=>{t(c)>1&&M(L)})}b(D,A)};R(B,D=>{U.count===0?D(g):D(S,!1)})}r(x),O(()=>{z(f,`Devices (${U.count??""})`),v.disabled=t(l)||U.count===0,z(C,t(l)?"Removing...":"Remove All")}),b(e,x),Me()}Je(["click"]);var Ir=y('<div class="no-devices svelte-14519bm">No devices emulated</div>'),Lr=y('<div class="zone-mini svelte-14519bm"></div>'),Cr=y('<span class="more-zones svelte-14519bm"> </span>'),Tr=y('<div class="zone-mini-strip svelte-14519bm"><!> <!></div>'),Ar=y('<span class="color-swatch svelte-14519bm"></span>'),Pr=y('<span class="no-color svelte-14519bm">-</span>'),Dr=y('<tr class="svelte-14519bm"><td class="cell-serial svelte-14519bm"> </td><td class="cell-label svelte-14519bm"> </td><td class="cell-product svelte-14519bm"> </td><td class="svelte-14519bm"><span> </span></td><td class="svelte-14519bm"><!></td><td class="svelte-14519bm"><button class="btn btn-delete btn-sm"> </button></td></tr>'),Mr=y('<div class="pagination svelte-14519bm"><button class="btn btn-sm">Previous</button> <span class="page-info svelte-14519bm"> </span> <button class="btn btn-sm">Next</button></div>'),Nr=y('<div class="table-container svelte-14519bm"><table class="device-table svelte-14519bm"><thead><tr><th class="svelte-14519bm">Serial</th><th class="svelte-14519bm">Label</th><th class="svelte-14519bm">Product</th><th class="svelte-14519bm">Power</th><th class="svelte-14519bm">Color</th><th class="svelte-14519bm">Actions</th></tr></thead><tbody class="svelte-14519bm"></tbody></table></div> <!>',1),Xr=y('<div class="card"><h2 style="display: flex; justify-content: space-between; align-items: center;"><span> </span> <button class="btn btn-delete" title="Remove all devices from server (runtime only)"> </button></h2> <!></div>');function Rr(e,a){De(a,!0);let l=Z(!1),s=Z(null),o=Z(nt(U.count));async function c(){if(U.count===0){alert("No devices to remove");return}const E=`Remove all ${U.count} device(s) from the server?

This will stop all devices from responding to LIFX protocol packets, but will not delete persistent storage.`;if(confirm(E)){h(l,!0);try{const L=await It();alert(L.message)}catch(L){alert(L instanceof Error?L.message:"Failed to remove devices")}finally{h(l,!1)}}}async function d(E){if(confirm(`Delete device ${E}?`)){h(s,E,!0);try{await Jt(E)}catch(L){alert(L instanceof Error?L.message:"Failed to delete device")}finally{h(s,null)}}}function w(E){return{1:"Original 1000",10:"White 800 (Low Voltage)",11:"White 800 (High Voltage)",18:"White 900 BR30",20:"Color 1000 BR30",22:"Color 1000",27:"LIFX A19",28:"LIFX BR30",29:"LIFX+ A19",30:"LIFX+ BR30",31:"LIFX Z",32:"LIFX Z 2",36:"LIFX Downlight",37:"LIFX Downlight",38:"LIFX Beam",43:"LIFX A19",44:"LIFX BR30",45:"LIFX+ A19",46:"LIFX+ BR30",49:"LIFX Mini Color",50:"LIFX Mini Day and Dusk",51:"LIFX Mini White",52:"LIFX GU10",55:"LIFX Tile",57:"LIFX Candle",59:"LIFX Mini Color",60:"LIFX Mini Day and Dusk",61:"LIFX Mini White",62:"LIFX A19",63:"LIFX BR30",64:"LIFX A19 Night Vision",65:"LIFX BR30 Night Vision",68:"LIFX Candle CA",70:"LIFX Switch",71:"LIFX Switch",81:"LIFX Candle Warm to White",82:"LIFX Filament",85:"LIFX A19 HEV",87:"LIFX Candle Color",88:"LIFX BR30 HEV",89:"LIFX A19 Clean",90:"LIFX Color",91:"LIFX Color",94:"LIFX BR30",96:"LIFX Candle White to Warm",97:"LIFX A19",98:"LIFX BR30",99:"LIFX Clean",100:"LIFX Filament Clear",101:"LIFX Filament Amber",109:"LIFX A19 HEV",110:"LIFX BR30 HEV",111:"LIFX Neon",112:"LIFX Lightstrip",120:"LIFX GU10"}[E]||`Product ${E}`}let m=Le(()=>Math.max(1,Math.ceil(U.count/I.pageSize))),x=Le(()=>{const E=(I.currentPage-1)*I.pageSize,L=E+I.pageSize;return U.list.slice(E,L)});function _(){I.currentPage>1&&I.setCurrentPage(I.currentPage-1)}function u(){I.currentPage<t(m)&&I.setCurrentPage(I.currentPage+1)}dt(()=>{if(Math.abs(U.count-t(o))>0){const L=Math.max(1,Math.ceil(U.count/I.pageSize));I.currentPage>L&&I.setCurrentPage(1),h(o,U.count,!0)}});var f=Xr(),v=i(f),C=i(v),B=i(C);r(C);var g=n(C,2);g.__click=c;var S=i(g,!0);r(g),r(v);var D=n(v,2);{var A=E=>{var L=Ir();b(E,L)},X=E=>{var L=Nr(),M=ve(L),W=i(M),j=n(i(W));he(j,21,()=>t(x),Q=>Q.serial,(Q,P)=>{var re=Dr(),ce=i(re),ge=i(ce,!0);r(ce);var be=n(ce),le=i(be,!0);r(be);var T=n(be),H=i(T,!0);r(T);var K=n(T),J=i(K);let ie;var $=i(J,!0);r(J),r(K);var k=n(K),N=i(k);{var Y=ae=>{var ne=Tr(),oe=i(ne);he(oe,17,()=>t(P).zone_colors.slice(0,16),Se,(se,me)=>{var ue=Lr();O(Ne=>Pe(ue,`background: ${Ne??""};`),[()=>Ge(t(me))]),b(se,ue)});var _e=n(oe,2);{var pe=se=>{var me=Cr(),ue=i(me);r(me),O(()=>z(ue,`+${t(P).zone_colors.length-16}`)),b(se,me)};R(_e,se=>{t(P).zone_colors.length>16&&se(pe)})}r(ne),b(ae,ne)},ee=ae=>{var ne=ke(),oe=ve(ne);{var _e=se=>{var me=Ar();O(ue=>Pe(me,`background: ${ue??""};`),[()=>Ge(t(P).color)]),b(se,me)},pe=se=>{var me=Pr();b(se,me)};R(oe,se=>{t(P).has_color&&t(P).color?se(_e):se(pe,!1)},!0)}b(ae,ne)};R(N,ae=>{t(P).has_multizone&&t(P).zone_colors&&t(P).zone_colors.length>0?ae(Y):ae(ee,!1)})}r(k);var te=n(k),q=i(te);q.__click=()=>d(t(P).serial);var de=i(q,!0);r(q),r(te),r(re),O(ae=>{z(ge,t(P).serial),z(le,t(P).label),z(H,ae),ie=Ce(J,1,"power-badge svelte-14519bm",null,ie,{"power-on":t(P).power_level>0,"power-off":t(P).power_level===0}),z($,t(P).power_level>0?"ON":"OFF"),q.disabled=t(s)===t(P).serial,z(de,t(s)===t(P).serial?"...":"Del")},[()=>w(t(P).product)]),b(Q,re)}),r(j),r(W),r(M);var V=n(M,2);{var fe=Q=>{var P=Mr(),re=i(P);re.__click=_;var ce=n(re,2),ge=i(ce);r(ce);var be=n(ce,2);be.__click=u,r(P),O(()=>{re.disabled=I.currentPage<=1,z(ge,`Page ${I.currentPage??""} of ${t(m)??""}`),be.disabled=I.currentPage>=t(m)}),b(Q,P)};R(V,Q=>{t(m)>1&&Q(fe)})}b(E,L)};R(D,E=>{U.count===0?E(A):E(X,!1)})}r(f),O(()=>{z(B,`Devices (${U.count??""})`),g.disabled=t(l)||U.count===0,z(S,t(l)?"Removing...":"Remove All")}),b(e,f),Me()}Je(["click"]);var Or=y('<div class="activity-disabled svelte-i8zsux"><p class="svelte-i8zsux">Activity logging is disabled.</p> <p class="hint svelte-i8zsux">Start the emulator with <code class="svelte-i8zsux">--api-activity</code> to enable packet logging.</p></div>'),Br=y('<button class="btn btn-sm">Clear</button>'),Vr=y('<div style="color: var(--text-dimmed);">No activity yet</div>'),Hr=y('<div style="color: var(--text-dimmed);">No matching activity</div>'),Ur=y('<div class="activity-item"><span class="activity-time"> </span> <span> </span> <span class="activity-packet"> </span> <span class="device-serial"> </span> <span style="color: var(--text-dimmed);"> </span></div>'),Wr=y('<div class="activity-filters"><div class="filter-group"><label for="filter-direction">Direction:</label> <select id="filter-direction"><option>All</option><option>RX</option><option>TX</option></select></div> <div class="filter-group"><label for="filter-device">Device/Target:</label> <input id="filter-device" type="text" placeholder="Filter by device..."/></div> <div class="filter-group"><label for="filter-packet">Packet:</label> <input id="filter-packet" type="text" placeholder="Filter by packet..."/></div> <!></div> <div class="activity-log"><!></div>',1),jr=y('<div class="card"><h2>Recent Activity</h2> <!></div>');function qr(e,a){De(a,!0);let l=Z("all"),s=Z(""),o=Z("");function c(u){return new Date(u*1e3).toLocaleTimeString()}let d=Le(()=>{let u=ot.reversed;if(t(l)!=="all"&&(u=u.filter(f=>f.direction===t(l))),t(s)){const f=t(s).toLowerCase();u=u.filter(v=>v.device?.toLowerCase().includes(f)||v.target?.toLowerCase().includes(f))}if(t(o)){const f=t(o).toLowerCase();u=u.filter(v=>v.packet_name.toLowerCase().includes(f))}return u});var w=jr(),m=n(i(w),2);{var x=u=>{var f=Or();b(u,f)},_=u=>{var f=Wr(),v=ve(f),C=i(v),B=n(i(C),2),g=i(B);g.value=g.__value="all";var S=n(g);S.value=S.__value="rx";var D=n(S);D.value=D.__value="tx",r(B),r(C);var A=n(C,2),X=n(i(A),2);Fe(X),r(A);var E=n(A,2),L=n(i(E),2);Fe(L),r(E);var M=n(E,2);{var W=P=>{var re=Br();re.__click=()=>{h(l,"all"),h(s,""),h(o,"")},b(P,re)};R(M,P=>{(t(l)!=="all"||t(s)||t(o))&&P(W)})}r(v);var j=n(v,2),V=i(j);{var fe=P=>{var re=Vr();b(P,re)},Q=P=>{var re=ke(),ce=ve(re);{var ge=le=>{var T=Hr();b(le,T)},be=le=>{var T=ke(),H=ve(T);he(H,17,()=>t(d),Se,(K,J)=>{var ie=Ur(),$=i(ie),k=i($,!0);r($);var N=n($,2),Y=i(N,!0);r(N);var ee=n(N,2),te=i(ee,!0);r(ee);var q=n(ee,2),de=i(q,!0);r(q);var ae=n(q,2),ne=i(ae,!0);r(ae),r(ie),O((oe,_e)=>{z(k,oe),Ce(N,1,Ta(t(J).direction==="rx"?"activity-rx":"activity-tx")),z(Y,_e),z(te,t(J).packet_name),z(de,t(J).device||t(J).target||"N/A"),z(ne,t(J).addr)},[()=>c(t(J).timestamp),()=>t(J).direction.toUpperCase()]),b(K,ie)}),b(le,T)};R(ce,le=>{t(d).length===0?le(ge):le(be,!1)},!0)}b(P,re)};R(V,P=>{ot.count===0?P(fe):P(Q,!1)})}r(j),Et(B,()=>t(l),P=>h(l,P)),Ie(X,()=>t(s),P=>h(s,P)),Ie(L,()=>t(o),P=>h(o,P)),b(u,f)};R(m,u=>{qe.value.activity_enabled?u(_,!1):u(x)})}r(w),b(e,w),Me()}Je(["click"]);var Gr=y("<button> </button>"),Jr=y("<option> </option>"),Yr=y("<option> </option>"),Zr=y('<div class="form-group" style="margin-top: 12px;"><label for="identifier"> </label> <select id="identifier"><!></select></div>'),Kr=y('<div class="inline-row svelte-15drtwo"><input type="text" placeholder="Packet type (e.g., 101)" style="width: 140px;" class="svelte-15drtwo"/> <input type="number" min="0" max="1" step="0.1" placeholder="Drop rate" style="width: 100px;" class="svelte-15drtwo"/> <button type="button" class="btn btn-delete btn-sm">X</button></div>'),Qr=y('<div class="inline-row svelte-15drtwo"><input type="text" placeholder="Packet type (e.g., 101)" style="width: 140px;" class="svelte-15drtwo"/> <input type="number" min="0" step="0.1" placeholder="Delay (s)" style="width: 100px;" class="svelte-15drtwo"/> <button type="button" class="btn btn-delete btn-sm">X</button></div>'),$r=y('<button type="button" class="btn btn-sm">Clear</button>'),es=y('<p class="message error svelte-15drtwo"> </p>'),ts=y('<p class="message success svelte-15drtwo"> </p>'),as=y('<div class="card"><h2>Scenario Configuration</h2> <div class="scope-tabs svelte-15drtwo"></div> <!> <div class="scenario-form svelte-15drtwo"><div class="form-section svelte-15drtwo"><div class="section-header svelte-15drtwo"><span class="section-title svelte-15drtwo">Drop Packets</span> <button type="button" class="btn btn-sm">+ Add</button></div> <p class="section-desc svelte-15drtwo">Specify packet types to drop (0.0 = never, 1.0 = always)</p> <!></div> <div class="form-section svelte-15drtwo"><div class="section-header svelte-15drtwo"><span class="section-title svelte-15drtwo">Response Delays</span> <button type="button" class="btn btn-sm">+ Add</button></div> <p class="section-desc svelte-15drtwo">Add delay (seconds) before responding to packet types</p> <!></div> <div class="form-section svelte-15drtwo"><label for="malformed" class="section-title svelte-15drtwo">Malformed Packets</label> <p class="section-desc svelte-15drtwo">Packet types to send with corrupted payloads (comma-separated)</p> <input id="malformed" type="text" placeholder="e.g., 101, 102, 118" class="svelte-15drtwo"/></div> <div class="form-section svelte-15drtwo"><label for="invalid" class="section-title svelte-15drtwo">Invalid Field Values</label> <p class="section-desc svelte-15drtwo">Packet types to send with 0xFF bytes (comma-separated)</p> <input id="invalid" type="text" placeholder="e.g., 101, 102" class="svelte-15drtwo"/></div> <div class="form-section svelte-15drtwo"><div class="section-header svelte-15drtwo"><span class="section-title svelte-15drtwo">Firmware Version Override</span> <!></div> <p class="section-desc svelte-15drtwo">Override reported firmware version (major.minor)</p> <div class="inline-row svelte-15drtwo"><input type="number" min="0" max="255" placeholder="Major" style="width: 80px;" class="svelte-15drtwo"/> <span>.</span> <input type="number" min="0" max="255" placeholder="Minor" style="width: 80px;" class="svelte-15drtwo"/></div></div> <div class="form-section svelte-15drtwo"><label for="partial" class="section-title svelte-15drtwo">Partial Responses</label> <p class="section-desc svelte-15drtwo">Packet types to send with incomplete data (comma-separated)</p> <input id="partial" type="text" placeholder="e.g., 506, 512" class="svelte-15drtwo"/></div> <div class="form-section svelte-15drtwo"><label class="checkbox-label svelte-15drtwo"><input type="checkbox" class="svelte-15drtwo"/> <span>Send Unhandled</span></label> <p class="section-desc svelte-15drtwo">Return StateUnhandled for unknown packet types</p></div></div> <!> <!> <div class="actions svelte-15drtwo"><button class="btn"> </button> <button class="btn btn-delete"> </button></div></div>');function rs(e,a){De(a,!0);const l=["matrix","extended_multizone","multizone","hev","infrared","color","basic"];let s=Z("global"),o=Z(""),c=Z(!1),d=Z(null),w=Z(null),m=Z(nt([])),x=Z(nt([])),_=Z(""),u=Z(""),f=Z(""),v=Z(""),C=Z(""),B=Z(!1);function g(p){return{global:"devices",device:"devices",type:"types",location:"locations",group:"groups"}[p]}let S=Le(()=>()=>{switch(t(s)){case"device":return U.list.map(p=>p.serial);case"type":return l;case"location":return[...new Set(U.list.map(p=>p.location_label).filter(Boolean))];case"group":return[...new Set(U.list.map(p=>p.group_label).filter(Boolean))];default:return[]}}),D=Le(()=>()=>{switch(t(s)){case"global":return Ke.global;case"device":return t(o)?Ke.devices[t(o)]:null;case"type":return t(o)?Ke.types[t(o)]:null;case"location":return t(o)?Ke.locations[t(o)]:null;case"group":return t(o)?Ke.groups[t(o)]:null;default:return null}});function A(p){if(!p){h(m,[],!0),h(x,[],!0),h(_,""),h(u,""),h(f,""),h(v,""),h(C,""),h(B,!0);return}p.drop_packets&&Object.keys(p.drop_packets).length>0?h(m,Object.entries(p.drop_packets).map(([F,G])=>({packetType:F,rate:String(G)})),!0):h(m,[],!0),p.response_delays&&Object.keys(p.response_delays).length>0?h(x,Object.entries(p.response_delays).map(([F,G])=>({packetType:F,delay:String(G)})),!0):h(x,[],!0),h(_,p.malformed_packets?.join(", ")||"",!0),h(u,p.invalid_field_values?.join(", ")||"",!0),h(C,p.partial_responses?.join(", ")||"",!0),p.firmware_version?(h(f,String(p.firmware_version[0]),!0),h(v,String(p.firmware_version[1]),!0)):(h(f,""),h(v,"")),h(B,p.send_unhandled??!0,!0)}function X(){const p={};if(t(m).length>0){p.drop_packets={};for(const{packetType:F,rate:G}of t(m))F&&G&&(p.drop_packets[F]=parseFloat(G))}if(t(x).length>0){p.response_delays={};for(const{packetType:F,delay:G}of t(x))F&&G&&(p.response_delays[F]=parseFloat(G))}return t(_).trim()&&(p.malformed_packets=t(_).split(",").map(F=>parseInt(F.trim(),10)).filter(F=>!isNaN(F))),t(u).trim()&&(p.invalid_field_values=t(u).split(",").map(F=>parseInt(F.trim(),10)).filter(F=>!isNaN(F))),t(C).trim()&&(p.partial_responses=t(C).split(",").map(F=>parseInt(F.trim(),10)).filter(F=>!isNaN(F))),t(f)&&t(v)&&(p.firmware_version=[parseInt(t(f),10),parseInt(t(v),10)]),p.send_unhandled=t(B),p}async function E(){h(d,null),h(w,null),h(c,!0);try{const p=X();if(t(s)==="global")await Ja(p);else{if(!t(o))throw new Error("Please select an identifier");await Za(g(t(s)),t(o),p)}h(w,"Scenario applied successfully"),setTimeout(()=>h(w,null),3e3)}catch(p){h(d,p instanceof Error?p.message:"Failed to apply scenario",!0)}finally{h(c,!1)}}async function L(){h(d,null),h(w,null),h(c,!0);try{if(t(s)==="global")await Ya();else{if(!t(o))throw new Error("Please select an identifier");await Ka(g(t(s)),t(o))}A(null),h(w,"Scenario cleared successfully"),setTimeout(()=>h(w,null),3e3)}catch(p){h(d,p instanceof Error?p.message:"Failed to clear scenario",!0)}finally{h(c,!1)}}function M(){h(m,[...t(m),{packetType:"",rate:"1.0"}],!0)}function W(p){h(m,t(m).filter((F,G)=>G!==p),!0)}function j(){h(x,[...t(x),{packetType:"",delay:"0.5"}],!0)}function V(p){h(x,t(x).filter((F,G)=>G!==p),!0)}function fe(){h(f,""),h(v,"")}dt(()=>{t(s)==="global"?A(t(D)()):t(o)?A(t(D)()):A(null)}),dt(()=>{const p=t(S)();t(s)!=="global"&&p.length>0&&!p.includes(t(o))&&h(o,p[0],!0)});var Q=as(),P=n(i(Q),2);he(P,20,()=>["global","device","type","location","group"],Se,(p,F)=>{var G=Gr();let ye;G.__click=()=>h(s,F,!0);var ze=i(G,!0);r(G),O(Ee=>{ye=Ce(G,1,"scope-tab svelte-15drtwo",null,ye,{active:t(s)===F}),z(ze,Ee)},[()=>F.charAt(0).toUpperCase()+F.slice(1)]),b(p,G)}),r(P);var re=n(P,2);{var ce=p=>{var F=Zr(),G=i(F),ye=i(G);r(G);var ze=n(G,2),Ee=i(ze);{var at=Ae=>{var We=Jr(),ut=i(We);r(We),We.value=We.__value="",O(()=>z(ut,`No ${t(s)??""}s available`)),b(Ae,We)},Re=Ae=>{var We=ke(),ut=ve(We);he(ut,17,()=>t(S)(),Se,(Yt,ft)=>{var rt=Yr(),Zt=i(rt,!0);r(rt);var Lt={};O(()=>{z(Zt,t(ft)),Lt!==(Lt=t(ft))&&(rt.value=(rt.__value=t(ft))??"")}),b(Yt,rt)}),b(Ae,We)};R(Ee,Ae=>{t(S)().length===0?Ae(at):Ae(Re,!1)})}r(ze),r(F),O(Ae=>z(ye,`${Ae??""}:`),[()=>t(s).charAt(0).toUpperCase()+t(s).slice(1)]),Et(ze,()=>t(o),Ae=>h(o,Ae)),b(p,F)};R(re,p=>{t(s)!=="global"&&p(ce)})}var ge=n(re,2),be=i(ge),le=i(be),T=n(i(le),2);T.__click=M,r(le);var H=n(le,4);he(H,17,()=>t(m),Se,(p,F,G)=>{var ye=Kr(),ze=i(ye);Fe(ze);var Ee=n(ze,2);Fe(Ee);var at=n(Ee,2);at.__click=()=>W(G),r(ye),Ie(ze,()=>t(F).packetType,Re=>t(F).packetType=Re),Ie(Ee,()=>t(F).rate,Re=>t(F).rate=Re),b(p,ye)}),r(be);var K=n(be,2),J=i(K),ie=n(i(J),2);ie.__click=j,r(J);var $=n(J,4);he($,17,()=>t(x),Se,(p,F,G)=>{var ye=Qr(),ze=i(ye);Fe(ze);var Ee=n(ze,2);Fe(Ee);var at=n(Ee,2);at.__click=()=>V(G),r(ye),Ie(ze,()=>t(F).packetType,Re=>t(F).packetType=Re),Ie(Ee,()=>t(F).delay,Re=>t(F).delay=Re),b(p,ye)}),r(K);var k=n(K,2),N=n(i(k),4);Fe(N),r(k);var Y=n(k,2),ee=n(i(Y),4);Fe(ee),r(Y);var te=n(Y,2),q=i(te),de=n(i(q),2);{var ae=p=>{var F=$r();F.__click=fe,b(p,F)};R(de,p=>{(t(f)||t(v))&&p(ae)})}r(q);var ne=n(q,4),oe=i(ne);Fe(oe);var _e=n(oe,4);Fe(_e),r(ne),r(te);var pe=n(te,2),se=n(i(pe),4);Fe(se),r(pe);var me=n(pe,2),ue=i(me),Ne=i(ue);Fe(Ne),ct(2),r(ue),ct(2),r(me),r(ge);var Ve=n(ge,2);{var He=p=>{var F=es(),G=i(F,!0);r(F),O(()=>z(G,t(d))),b(p,F)};R(Ve,p=>{t(d)&&p(He)})}var Ze=n(Ve,2);{var tt=p=>{var F=ts(),G=i(F,!0);r(F),O(()=>z(G,t(w))),b(p,F)};R(Ze,p=>{t(w)&&p(tt)})}var Ue=n(Ze,2),we=i(Ue);we.__click=E;var Te=i(we,!0);r(we);var Xe=n(we,2);Xe.__click=L;var Qe=i(Xe,!0);r(Xe),r(Ue),r(Q),O(()=>{we.disabled=t(c)||t(s)!=="global"&&!t(o),z(Te,t(c)?"Applying...":"Apply"),Xe.disabled=t(c)||t(s)!=="global"&&!t(o),z(Qe,t(c)?"Clearing...":"Clear")}),Ie(N,()=>t(_),p=>h(_,p)),Ie(ee,()=>t(u),p=>h(u,p)),Ie(oe,()=>t(f),p=>h(f,p)),Ie(_e,()=>t(v),p=>h(v,p)),Ie(se,()=>t(C),p=>h(C,p)),Ra(Ne,()=>t(B),p=>h(B,p)),b(e,Q),Me()}Je(["click"]);var ss=y('<div class="no-devices svelte-t60k18"><p class="svelte-t60k18">No devices to visualize</p> <p class="hint svelte-t60k18">Add devices with color, multizone, or matrix capabilities</p></div>'),is=y('<span class="viz-zones svelte-t60k18"> </span>'),ls=y('<div class="viz-tile-zone svelte-t60k18"></div>'),ns=y('<div class="viz-tile-wrapper svelte-t60k18"><div class="viz-tile-label svelte-t60k18"></div> <div class="viz-tile-grid svelte-t60k18"></div></div>'),os=y('<div class="viz-tiles svelte-t60k18"></div>'),vs=y('<div class="viz-zone svelte-t60k18"></div>'),cs=y('<div class="viz-zone-strip svelte-t60k18"></div>'),ds=y('<div class="viz-color-swatch svelte-t60k18"></div>'),us=y('<div><div class="viz-header svelte-t60k18"><div class="viz-info svelte-t60k18"><span class="viz-label svelte-t60k18"> </span> <span class="viz-serial svelte-t60k18"> </span></div> <div class="viz-meta svelte-t60k18"><span class="viz-type svelte-t60k18"> </span> <!> <span> </span></div></div> <div class="viz-display svelte-t60k18"><!></div></div>'),fs=y('<div class="device-grid svelte-t60k18"></div>'),_s=y('<div class="visualizer svelte-t60k18"><!></div>');function ps(e,a){De(a,!0);let l=Le(()=>{const _=U.list.filter(u=>u.has_color&&u.color||u.has_multizone&&u.zone_colors&&u.zone_colors.length>0||u.has_matrix&&u.tile_devices&&u.tile_devices.length>0);return console.log("Visualizer devices:",U.list.length,"total,",_.length,"visual"),_});function s(_){const u=U.getTransition(_);return!u||Date.now()-u.timestamp>u.duration_ms+100?0:u.duration_ms}function o(_){return _.has_relays?"Switch":_.has_matrix?"Matrix":_.has_multizone?"Multizone":_.has_color?"Color":"Light"}function c(_){return _.has_matrix&&_.tile_devices?_.tile_devices.reduce((u,f)=>u+f.width*f.height,0):_.zone_count}var d=_s(),w=i(d);{var m=_=>{var u=ss();b(_,u)},x=_=>{var u=fs();he(u,21,()=>t(l),f=>f.serial,(f,v)=>{const C=Le(()=>s(t(v).serial));var B=us();let g;var S=i(B),D=i(S),A=i(D),X=i(A,!0);r(A);var E=n(A,2),L=i(E,!0);r(E),r(D);var M=n(D,2),W=i(M),j=i(W,!0);r(W);var V=n(W,2);{var fe=T=>{var H=is(),K=i(H);r(H),O(J=>z(K,`${J??""} zones`),[()=>c(t(v))]),b(T,H)};R(V,T=>{(t(v).has_multizone||t(v).has_matrix)&&T(fe)})}var Q=n(V,2);let P;var re=i(Q,!0);r(Q),r(M),r(S);var ce=n(S,2),ge=i(ce);{var be=T=>{var H=os();he(H,21,()=>t(v).tile_devices,Se,(K,J,ie)=>{var $=ns(),k=i($);k.textContent=`T${ie+1}`;var N=n(k,2);he(N,21,()=>t(J).colors,Se,(Y,ee)=>{var te=ls();O(q=>Pe(te,`
														background: ${q??""};
														transition: background ${t(C)??""}ms ease-out;
													`),[()=>Ge(t(ee))]),b(Y,te)}),r(N),r($),O(()=>Pe(N,`
												grid-template-columns: repeat(${t(J).width??""}, 1fr);
												aspect-ratio: ${t(J).width??""} / ${t(J).height??""};
											`)),b(K,$)}),r(H),b(T,H)},le=T=>{var H=ke(),K=ve(H);{var J=$=>{var k=cs();he(k,21,()=>t(v).zone_colors,Se,(N,Y)=>{var ee=vs();O(te=>Pe(ee,`
											background: ${te??""};
											transition: background ${t(C)??""}ms ease-out;
										`),[()=>Ge(t(Y))]),b(N,ee)}),r(k),b($,k)},ie=$=>{var k=ke(),N=ve(k);{var Y=ee=>{var te=ds();O(q=>Pe(te,`
									background: ${q??""};
									transition: background ${t(C)??""}ms ease-out;
								`),[()=>Ge(t(v).color)]),b(ee,te)};R(N,ee=>{t(v).has_color&&t(v).color&&ee(Y)},!0)}b($,k)};R(K,$=>{t(v).has_multizone&&t(v).zone_colors&&t(v).zone_colors.length>0?$(J):$(ie,!1)},!0)}b(T,H)};R(ge,T=>{t(v).has_matrix&&t(v).tile_devices&&t(v).tile_devices.length>0?T(be):T(le,!1)})}r(ce),r(B),O(T=>{g=Ce(B,1,"viz-device svelte-t60k18",null,g,{"power-off":t(v).power_level===0}),z(X,t(v).label),z(L,t(v).serial),z(j,T),P=Ce(Q,1,"viz-power svelte-t60k18",null,P,{on:t(v).power_level>0}),z(re,t(v).power_level>0?"ON":"OFF")},[()=>o(t(v))]),b(f,B)}),r(u),b(_,u)};R(w,_=>{t(l).length===0?_(m):_(x,!1)})}r(d),b(e,d),Me()}var bs=y('<span class="tab-count svelte-1uha8ag"> </span>'),hs=y('<span class="tab-count svelte-1uha8ag"> </span>'),ms=y("<button> <!></button>"),gs=y("<!> <!>",1),ws=y('<div class="container"><!> <!> <div class="tabs svelte-1uha8ag"></div> <div class="tab-content svelte-1uha8ag"><!></div></div>');function Is(e,a){De(a,!1);const l=[{id:"visualizer",label:"Visualizer"},{id:"devices",label:"Devices"},{id:"activity",label:"Activity"},{id:"scenarios",label:"Scenarios"}];Xt(()=>{$e.connect()}),Kt(()=>{$e.disconnect()}),kt();var s=ws(),o=i(s);Ha(o,{});var c=n(o,2);{var d=f=>{ja(f,{})};R(c,f=>{I.showStats&&f(d)})}var w=n(c,2);he(w,5,()=>l,Se,(f,v)=>{var C=ms();let B;C.__click=()=>I.setActiveTab(t(v).id);var g=i(C),S=n(g);{var D=X=>{var E=bs(),L=i(E,!0);r(E),O(()=>z(L,U.count)),b(X,E)},A=X=>{var E=ke(),L=ve(E);{var M=W=>{var j=hs(),V=i(j,!0);r(j),O(()=>z(V,ot.count)),b(W,j)};R(L,W=>{t(v).id==="activity"&&W(M)},!0)}b(X,E)};R(S,X=>{t(v).id==="visualizer"||t(v).id==="devices"?X(D):X(A,!1)})}r(C),O(()=>{B=Ce(C,1,"tab svelte-1uha8ag",null,B,{active:I.activeTab===t(v).id}),z(g,`${t(v).label??""} `)}),b(f,C)}),r(w);var m=n(w,2),x=i(m);{var _=f=>{ps(f,{})},u=f=>{var v=ke(),C=ve(v);{var B=S=>{var D=gs(),A=ve(D);rr(A,{});var X=n(A,2);{var E=M=>{Rr(M,{})},L=M=>{Er(M,{})};R(X,M=>{I.viewMode==="table"?M(E):M(L,!1)})}b(S,D)},g=S=>{var D=ke(),A=ve(D);{var X=L=>{qr(L,{})},E=L=>{var M=ke(),W=ve(M);{var j=V=>{rs(V,{})};R(W,V=>{I.activeTab==="scenarios"&&V(j)},!0)}b(L,M)};R(A,L=>{I.activeTab==="activity"?L(X):L(E,!1)},!0)}b(S,D)};R(C,S=>{I.activeTab==="devices"?S(B):S(g,!1)},!0)}b(f,v)};R(x,f=>{I.activeTab==="visualizer"?f(_):f(u,!1)})}r(m),r(s),b(e,s),Me()}Je(["click"]);export{Is as component};
