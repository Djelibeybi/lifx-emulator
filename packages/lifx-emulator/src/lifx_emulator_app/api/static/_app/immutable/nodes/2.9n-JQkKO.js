import{a as f,f as y,c as Se}from"../chunks/Binc8JbE.js";import{i as kt}from"../chunks/BORyfda6.js";import{o as Xt,a as Kt}from"../chunks/yhjkpkcN.js";import{i as _t,b as Qt,h as ke,c as pt,L as $t,a as ea,w as e,r as ta,H as aa,s as Ct,d as ht,k as vt,S as ra,as as sa,ab as Tt,e as Oe,aN as Be,j as yt,l as ia,aH as la,aO as Rt,aq as St,aP as na,aQ as oa,aL as va,Y as At,aR as ca,f as Ot,p as Bt,aS as bt,aT as da,ap as ua,g as fa,U as _a,aU as Vt,_ as Ht,aV as pa,aj as ha,aW as ba,aX as ma,aY as zt,V as ga,aZ as Ut,a_ as wa,a$ as ya,b0 as xa,b1 as ka,b2 as Sa,aM as za,q as Wt,X as jt,aw as h,au as re,B as De,C as de,D as O,F as Me,G as i,J as n,I as r,ac as ct,av as tt,ax as Ee,o as dt}from"../chunks/DfIkQq0Y.js";import{d as Ve,s as z,e as Fa}from"../chunks/BaoxLdOF.js";import{i as R}from"../chunks/BTLkiQR5.js";import{s as Ke,a as ot,d as j,b as Ge,u as A,t as mt}from"../chunks/DK1z4bVD.js";function ze(t,a){return a}function Ea(t,a,l){for(var s=[],o=a.length,v,c=a.length,w=0;w<o;w++){let x=a[w];Bt(x,()=>{if(v){if(v.pending.delete(x),v.done.add(x),v.pending.size===0){var _=t.outrogroups;xt(St(v.done)),_.delete(v),_.size===0&&(t.outrogroups=null)}}else c-=1},!1)}if(c===0){var m=s.length===0&&l!==null;if(m){var S=l,k=S.parentNode;ua(k),k.append(S),t.items.clear()}xt(a,!m)}else v={pending:new Set(a),done:new Set},(t.outrogroups??=new Set).add(v)}function xt(t,a=!0){for(var l=0;l<t.length;l++)fa(t[l],a)}var Pt;function be(t,a,l,s,o,v=null){var c=t,w=new Map,m=(a&Vt)!==0;if(m){var S=t;c=ke?pt($t(S)):S.appendChild(_t())}ke&&ea();var k=null,x=la(()=>{var d=l();return Rt(d)?d:d==null?[]:St(d)}),_,g=!0;function b(){p.fallback=k,Ia(p,_,c,a,s),k!==null&&(_.length===0?(k.f&Be)===0?Ot(k):(k.f^=Be,lt(k,null,c)):Bt(k,()=>{k=null}))}var E=Qt(()=>{_=e(x);var d=_.length;let M=!1;if(ke){var N=ta(c)===aa;N!==(d===0)&&(c=Ct(),pt(c),ht(!1),M=!0)}for(var X=new Set,C=Oe,T=ia(),D=0;D<d;D+=1){ke&&vt.nodeType===ra&&vt.data===sa&&(c=vt,M=!0,ht(!1));var q=_[D],G=s(q,D),H=g?null:w.get(G);H?(H.v&&Tt(H.v,q),H.i&&Tt(H.i,D),T&&C.skipped_effects.delete(H.e)):(H=La(w,g?c:Pt??=_t(),q,G,D,o,a,l),g||(H.e.f|=Be),w.set(G,H)),X.add(G)}if(d===0&&v&&!k&&(g?k=yt(()=>v(c)):(k=yt(()=>v(Pt??=_t())),k.f|=Be)),ke&&d>0&&pt(Ct()),!g)if(T){for(const[pe,le]of w)X.has(pe)||C.skipped_effects.add(le.e);C.oncommit(b),C.ondiscard(()=>{})}else b();M&&ht(!0),e(x)}),p={effect:E,items:w,outrogroups:null,fallback:k};g=!1,ke&&(c=vt)}function it(t){for(;t!==null&&(t.f&da)===0;)t=t.next;return t}function Ia(t,a,l,s,o){var v=(s&pa)!==0,c=a.length,w=t.items,m=it(t.effect.first),S,k=null,x,_=[],g=[],b,E,p,d;if(v)for(d=0;d<c;d+=1)b=a[d],E=o(b,d),p=w.get(E).e,(p.f&Be)===0&&(p.nodes?.a?.measure(),(x??=new Set).add(p));for(d=0;d<c;d+=1){if(b=a[d],E=o(b,d),p=w.get(E).e,t.outrogroups!==null)for(const H of t.outrogroups)H.pending.delete(p),H.done.delete(p);if((p.f&Be)!==0)if(p.f^=Be,p===m)lt(p,null,l);else{var M=k?k.next:m;p===t.effect.last&&(t.effect.last=p.prev),p.prev&&(p.prev.next=p.next),p.next&&(p.next.prev=p.prev),qe(t,k,p),qe(t,p,M),lt(p,M,l),k=p,_=[],g=[],m=it(k.next);continue}if((p.f&bt)!==0&&(Ot(p),v&&(p.nodes?.a?.unfix(),(x??=new Set).delete(p))),p!==m){if(S!==void 0&&S.has(p)){if(_.length<g.length){var N=g[0],X;k=N.prev;var C=_[0],T=_[_.length-1];for(X=0;X<_.length;X+=1)lt(_[X],N,l);for(X=0;X<g.length;X+=1)S.delete(g[X]);qe(t,C.prev,T.next),qe(t,k,C),qe(t,T,N),m=N,k=T,d-=1,_=[],g=[]}else S.delete(p),lt(p,m,l),qe(t,p.prev,p.next),qe(t,p,k===null?t.effect.first:k.next),qe(t,k,p),k=p;continue}for(_=[],g=[];m!==null&&m!==p;)(S??=new Set).add(m),g.push(m),m=it(m.next);if(m===null)continue}(p.f&Be)===0&&_.push(p),k=p,m=it(p.next)}if(t.outrogroups!==null){for(const H of t.outrogroups)H.pending.size===0&&(xt(St(H.done)),t.outrogroups?.delete(H));t.outrogroups.size===0&&(t.outrogroups=null)}if(m!==null||S!==void 0){var D=[];if(S!==void 0)for(p of S)(p.f&bt)===0&&D.push(p);for(;m!==null;)(m.f&bt)===0&&m!==t.fallback&&D.push(m),m=it(m.next);var q=D.length;if(q>0){var G=(s&Vt)!==0&&c===0?l:null;if(v){for(d=0;d<q;d+=1)D[d].nodes?.a?.measure();for(d=0;d<q;d+=1)D[d].nodes?.a?.fix()}Ea(t,D,G)}}v&&Ht(()=>{if(x!==void 0)for(p of x)p.nodes?.a?.apply()})}function La(t,a,l,s,o,v,c,w){var m=(c&na)!==0?(c&oa)===0?va(l,!1,!1):At(l):null,S=(c&ca)!==0?At(o):null;return{v:m,i:S,e:yt(()=>(v(a,m??l,S??o,w),()=>{t.delete(s)}))}}function lt(t,a,l){if(t.nodes)for(var s=t.nodes.start,o=t.nodes.end,v=a&&(a.f&Be)===0?a.nodes.start:l;s!==null;){var c=_a(s);if(v.before(s),s===o)return;s=c}}function qe(t,a,l){a===null?t.effect.first=l:a.next=l,l===null?t.effect.last=a:l.prev=a}function qt(t){var a,l,s="";if(typeof t=="string"||typeof t=="number")s+=t;else if(typeof t=="object")if(Array.isArray(t)){var o=t.length;for(a=0;a<o;a++)t[a]&&(l=qt(t[a]))&&(s&&(s+=" "),s+=l)}else for(l in t)t[l]&&(s&&(s+=" "),s+=l);return s}function Ca(){for(var t,a,l=0,s="",o=arguments.length;l<o;l++)(t=arguments[l])&&(a=qt(t))&&(s&&(s+=" "),s+=a);return s}function Ta(t){return typeof t=="object"?Ca(t):t??""}const Dt=[...`
\r\f \v\uFEFF`];function Aa(t,a,l){var s=t==null?"":""+t;if(a&&(s=s?s+" "+a:a),l){for(var o in l)if(l[o])s=s?s+" "+o:o;else if(s.length)for(var v=o.length,c=0;(c=s.indexOf(o,c))>=0;){var w=c+v;(c===0||Dt.includes(s[c-1]))&&(w===s.length||Dt.includes(s[w]))?s=(c===0?"":s.substring(0,c))+s.substring(w+1):c=w}}return s===""?null:s}function Pa(t,a){return t==null?null:String(t)}function ye(t,a,l,s,o,v){var c=t.__className;if(ke||c!==l||c===void 0){var w=Aa(l,s,v);(!ke||w!==t.getAttribute("class"))&&(w==null?t.removeAttribute("class"):t.className=w),t.__className=l}else if(v&&o!==v)for(var m in v){var S=!!v[m];(o==null||S!==!!o[m])&&t.classList.toggle(m,S)}return v}function Pe(t,a,l,s){var o=t.__style;if(ke||o!==a){var v=Pa(a);(!ke||v!==t.getAttribute("style"))&&(v==null?t.removeAttribute("style"):t.style.cssText=v),t.__style=a}return s}function Ft(t,a,l=!1){if(t.multiple){if(a==null)return;if(!Rt(a))return ba();for(var s of t.options)s.selected=a.includes(nt(s));return}for(s of t.options){var o=nt(s);if(ma(o,a)){s.selected=!0;return}}(!l||a!==void 0)&&(t.selectedIndex=-1)}function Gt(t){var a=new MutationObserver(()=>{Ft(t,t.__value)});a.observe(t,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["value"]}),ha(()=>{a.disconnect()})}function Et(t,a,l=a){var s=new WeakSet,o=!0;zt(t,"change",v=>{var c=v?"[selected]":":checked",w;if(t.multiple)w=[].map.call(t.querySelectorAll(c),nt);else{var m=t.querySelector(c)??t.querySelector("option:not([disabled])");w=m&&nt(m)}l(w),Oe!==null&&s.add(Oe)}),ga(()=>{var v=a();if(t===document.activeElement){var c=Ut??Oe;if(s.has(c))return}if(Ft(t,v,o),o&&v===void 0){var w=t.querySelector(":checked");w!==null&&(v=nt(w),l(v))}t.__value=v,o=!1}),Gt(t)}function nt(t){return"__value"in t?t.__value:t.value}const Da=Symbol("is custom element"),Ma=Symbol("is html");function Ie(t){if(ke){var a=!1,l=()=>{if(!a){if(a=!0,t.hasAttribute("value")){var s=t.value;Qe(t,"value",null),t.value=s}if(t.hasAttribute("checked")){var o=t.checked;Qe(t,"checked",null),t.checked=o}}};t.__on_r=l,Ht(l),ka()}}function Qe(t,a,l,s){var o=Na(t);ke&&(o[a]=t.getAttribute(a),a==="src"||a==="srcset"||a==="href"&&t.nodeName==="LINK")||o[a]!==(o[a]=l)&&(a==="loading"&&(t[Sa]=l),l==null?t.removeAttribute(a):typeof l!="string"&&Xa(t).includes(a)?t[a]=l:t.setAttribute(a,l))}function Na(t){return t.__attributes??={[Da]:t.nodeName.includes("-"),[Ma]:t.namespaceURI===wa}}var Mt=new Map;function Xa(t){var a=t.getAttribute("is")||t.nodeName,l=Mt.get(a);if(l)return l;Mt.set(a,l=[]);for(var s,o=t,v=Element.prototype;v!==o;){s=xa(o);for(var c in s)s[c].set&&l.push(c);o=ya(o)}return l}function Ce(t,a,l=a){var s=new WeakSet;zt(t,"input",async o=>{var v=o?t.defaultValue:t.value;if(v=gt(t)?wt(v):v,l(v),Oe!==null&&s.add(Oe),await za(),v!==(v=a())){var c=t.selectionStart,w=t.selectionEnd,m=t.value.length;if(t.value=v??"",w!==null){var S=t.value.length;c===w&&w===m&&S>m?(t.selectionStart=S,t.selectionEnd=S):(t.selectionStart=c,t.selectionEnd=Math.min(w,S))}}}),(ke&&t.defaultValue!==t.value||Wt(a)==null&&t.value)&&(l(gt(t)?wt(t.value):t.value),Oe!==null&&s.add(Oe)),jt(()=>{var o=a();if(t===document.activeElement){var v=Ut??Oe;if(s.has(v))return}gt(t)&&o===wt(t.value)||t.type==="date"&&!o&&!t.value||o!==t.value&&(t.value=o??"")})}function Ra(t,a,l=a){zt(t,"change",s=>{var o=s?t.defaultChecked:t.checked;l(o)}),(ke&&t.defaultChecked!==t.checked||Wt(a)==null)&&l(t.checked),jt(()=>{var s=a();t.checked=!!s})}function gt(t){var a=t.type;return a==="number"||a==="range"}function wt(t){return t===""?null:+t}const Nt=2e3,Oa=3e4;function Ba(){let t=re("disconnected"),a=null,l=Nt,s=null,o=!0;function v(){return`${window.location.protocol==="https:"?"wss:":"ws:"}//${window.location.host}/ws`}function c(x){try{const _=JSON.parse(x.data);switch(_.type){case"sync":{const g=_.data;g.stats&&Ge.set(g.stats),g.devices&&j.set(g.devices),g.activity&&ot.set(g.activity),g.scenarios&&Ke.setAll(g.scenarios);break}case"stats":Ge.set(_.data);break;case"device_added":j.add(_.data);break;case"device_removed":{const{serial:g}=_.data;j.remove(g);break}case"device_updated":{const{serial:g,changes:b}=_.data;console.log("device_updated received:",g,b),b.category!==void 0?(console.log("Using updateWithTransition for category:",b.category),j.updateWithTransition(g,b)):j.update(g,b);break}case"activity":ot.add(_.data);break;case"scenario_changed":Ke.handleChange(_.data);break;case"error":console.error("WebSocket error:",_.message);break}}catch(_){console.error("Failed to parse WebSocket message:",_)}}function w(){if(o=!0,!(a&&(a.readyState===WebSocket.CONNECTING||a.readyState===WebSocket.OPEN))){h(t,"connecting");try{a=new WebSocket(v()),a.onopen=()=>{h(t,"connected"),l=Nt,a.send(JSON.stringify({type:"subscribe",topics:["stats","devices","activity","scenarios"]})),a.send(JSON.stringify({type:"sync"}))},a.onmessage=c,a.onclose=()=>{h(t,"disconnected"),a=null,o&&m()},a.onerror=()=>{h(t,"error"),a?.close()}}catch(x){console.error("WebSocket connection error:",x),h(t,"error"),m()}}}function m(){s&&clearTimeout(s),s=setTimeout(()=>{s=null,w()},l),l=Math.min(l*1.5,Oa)}function S(){o=!1,s&&(clearTimeout(s),s=null),a&&(a.close(),a=null),h(t,"disconnected")}function k(x){a&&a.readyState===WebSocket.OPEN&&a.send(JSON.stringify(x))}return{get status(){return e(t)},connect:w,disconnect:S,send:k,sync(){k({type:"sync"})}}}const et=Ba();var Va=y('<header class="header"><div class="header-title"><h1>LIFX Emulator Monitor</h1> <span></span></div> <div class="header-controls svelte-1elxaub"><button><svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor"><rect x="1" y="9" width="3" height="6" rx="0.5"></rect><rect x="6" y="5" width="3" height="10" rx="0.5"></rect><rect x="11" y="1" width="3" height="14" rx="0.5"></rect></svg></button> <button class="control-btn svelte-1elxaub"> </button></div></header> <p class="subtitle">Real-time monitoring and device management</p>',1);function Ha(t,a){De(a,!1);const l={light:"☀",dark:"☾",system:"◐"};kt();var s=Va(),o=de(s),v=i(o),c=n(i(v),2);let w;r(v);var m=n(v,2),S=i(m);let k;S.__click=()=>A.toggleShowStats();var x=n(S,2);x.__click=()=>mt.toggle();var _=i(x,!0);r(x),r(m),r(o),ct(2),O(()=>{w=ye(c,1,"status-indicator",null,w,{connecting:et.status==="connecting",disconnected:et.status==="disconnected",error:et.status==="error"}),Qe(c,"title",et.status),k=ye(S,1,"control-btn svelte-1elxaub",null,k,{active:A.showStats}),Qe(S,"title",A.showStats?"Hide statistics":"Show statistics"),Qe(x,"title",`Toggle theme (${mt.mode})`),z(_,l[mt.mode])}),f(t,s),Me()}Ve(["click"]);function Je(t){const a=t.hue/65535,l=t.saturation/65535,s=t.brightness/65535;let o,v,c;const w=Math.floor(a*6),m=a*6-w,S=s*(1-l),k=s*(1-m*l),x=s*(1-(1-m)*l);switch(w%6){case 0:o=s,v=x,c=S;break;case 1:o=k,v=s,c=S;break;case 2:o=S,v=s,c=x;break;case 3:o=S,v=k,c=s;break;case 4:o=x,v=S,c=s;break;default:o=s,v=S,c=k;break}const _=Math.round(o*255),g=Math.round(v*255),b=Math.round(c*255);return`rgb(${_}, ${g}, ${b})`}function Ua(t){const a=Math.floor(t);if(a<60)return`${a}s`;if(a<3600)return`${Math.floor(a/60)}m ${a%60}s`;const l=Math.floor(a/3600),s=Math.floor(a%3600/60);return`${l}h ${s}m`}var Wa=y('<div class="card"><h2><span class="status-indicator"></span> Server Statistics</h2> <div class="stats-list"><div class="stat"><span class="stat-label">Uptime</span> <span class="stat-value"> </span></div> <div class="stat"><span class="stat-label">Devices</span> <span class="stat-value"> </span></div> <div class="stat"><span class="stat-label">Packets RX</span> <span class="stat-value"> </span></div> <div class="stat"><span class="stat-label">Packets TX</span> <span class="stat-value"> </span></div> <div class="stat"><span class="stat-label">Errors</span> <span class="stat-value"> </span></div></div></div>');function ja(t,a){De(a,!1),kt();var l=Wa(),s=n(i(l),2),o=i(s),v=n(i(o),2),c=i(v,!0);r(v),r(o);var w=n(o,2),m=n(i(w),2),S=i(m,!0);r(m),r(w);var k=n(w,2),x=n(i(k),2),_=i(x,!0);r(x),r(k);var g=n(k,2),b=n(i(g),2),E=i(b,!0);r(b),r(g);var p=n(g,2),d=n(i(p),2),M=i(d,!0);r(d),r(p),r(s),r(l),O(N=>{z(c,N),z(S,Ge.value.device_count),z(_,Ge.value.packets_received),z(E,Ge.value.packets_sent),z(M,Ge.value.error_count)},[()=>Ua(Ge.value.uptime_seconds)]),f(t,l),Me()}const Ye="/api";async function qa(){const t=await fetch(`${Ye}/products`);if(!t.ok)throw new Error(`Failed to fetch products: ${t.status}`);return t.json()}async function Ga(t){const a=await fetch(`${Ye}/devices`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({product_id:t})});if(!a.ok){const l=await a.json();throw new Error(l.detail||`Failed to create device: ${a.status}`)}}async function Jt(t){const a=await fetch(`${Ye}/devices/${t}`,{method:"DELETE"});if(!a.ok)throw new Error(`Failed to delete device: ${a.status}`)}async function It(){const t=await fetch(`${Ye}/devices`,{method:"DELETE"});if(!t.ok)throw new Error(`Failed to remove devices: ${t.status}`);return t.json()}async function Ja(t){const a=await fetch(`${Ye}/scenarios/global`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});if(!a.ok){const l=await a.json();throw new Error(l.detail||`Failed to set global scenario: ${a.status}`)}}async function Ya(){const t=await fetch(`${Ye}/scenarios/global`,{method:"DELETE"});if(!t.ok)throw new Error(`Failed to clear global scenario: ${t.status}`)}async function Za(t,a,l){const s=await fetch(`${Ye}/scenarios/${t}/${encodeURIComponent(a)}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(l)});if(!s.ok){const o=await s.json();throw new Error(o.detail||`Failed to set ${t} scenario: ${s.status}`)}}async function Ka(t,a){const l=await fetch(`${Ye}/scenarios/${t}/${encodeURIComponent(a)}`,{method:"DELETE"});if(l.status!==404&&!l.ok)throw new Error(`Failed to clear ${t} scenario: ${l.status}`)}var Qa=y("<option> </option>"),$a=y("<option>Loading products...</option>"),er=y("<option> </option>"),tr=y('<p style="color: var(--accent-danger); font-size: 0.85em; margin-top: 10px;"> </p>'),ar=y('<div class="card"><div class="toolbar-header svelte-zw83d1"><h2>Device Management</h2> <div class="toolbar-actions svelte-zw83d1"><div class="view-toggle svelte-zw83d1"><button title="Card view"><svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor"><rect x="1" y="1" width="6" height="6" rx="1"></rect><rect x="9" y="1" width="6" height="6" rx="1"></rect><rect x="1" y="9" width="6" height="6" rx="1"></rect><rect x="9" y="9" width="6" height="6" rx="1"></rect></svg></button> <button title="Table view"><svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor"><rect x="1" y="2" width="14" height="2" rx="0.5"></rect><rect x="1" y="7" width="14" height="2" rx="0.5"></rect><rect x="1" y="12" width="14" height="2" rx="0.5"></rect></svg></button></div> <div class="page-size svelte-zw83d1"><label for="page-size" class="svelte-zw83d1">Show:</label> <select id="page-size" class="svelte-zw83d1"></select></div> <button class="btn btn-delete"> </button></div></div> <form><div class="form-row"><div class="form-group"><label for="product-id">Product</label> <select id="product-id"><!></select></div> <button type="submit" class="btn"> </button></div> <!></form></div>');function rr(t,a){De(a,!0);let l=re(tt([])),s=re(null),o=re(!1),v=re(!1),c=re(null);const w=[10,20,50,100];Xt(async()=>{try{h(l,await qa(),!0),e(l).length>0&&h(s,e(l)[0].pid,!0)}catch(B){h(c,B instanceof Error?B.message:"Failed to load products",!0)}});async function m(B){if(B.preventDefault(),e(s)!==null){h(o,!0),h(c,null);try{await Ga(e(s))}catch(K){h(c,K instanceof Error?K.message:"Failed to create device",!0)}finally{h(o,!1)}}}async function S(){if(j.count!==0&&confirm(`Remove all ${j.count} devices?`)){h(v,!0),h(c,null);try{const B=await It();console.log(`Removed ${B.removed} devices`)}catch(B){h(c,B instanceof Error?B.message:"Failed to remove devices",!0)}finally{h(v,!1)}}}function k(B){const K=B.target;A.setPageSize(parseInt(K.value,10))}var x=ar(),_=i(x),g=n(i(_),2),b=i(g),E=i(b);let p;E.__click=()=>A.setViewMode("card");var d=n(E,2);let M;d.__click=()=>A.setViewMode("table"),r(b);var N=n(b,2),X=n(i(N),2);X.__change=k,be(X,21,()=>w,ze,(B,K)=>{var oe=Qa(),ie=i(oe,!0);r(oe);var fe={};O(()=>{z(ie,e(K)),fe!==(fe=e(K))&&(oe.value=(oe.__value=e(K))??"")}),f(B,oe)}),r(X);var C;Gt(X),r(N);var T=n(N,2);T.__click=S;var D=i(T,!0);r(T),r(g),r(_);var q=n(_,2),G=i(q),H=i(G),pe=n(i(H),2),le=i(pe);{var P=B=>{var K=$a();K.value=K.__value="",f(B,K)},ne=B=>{var K=Se(),oe=de(K);be(oe,17,()=>e(l),ie=>ie.pid,(ie,fe)=>{var me=er(),F=i(me);r(me);var L={};O(()=>{z(F,`${e(fe).pid??""} - ${e(fe).name??""}`),L!==(L=e(fe).pid)&&(me.value=(me.__value=e(fe).pid)??"")}),f(ie,me)}),f(B,K)};R(le,B=>{e(l).length===0?B(P):B(ne,!1)})}r(pe),r(H);var ue=n(H,2),ge=i(ue,!0);r(ue),r(G);var he=n(G,2);{var ce=B=>{var K=tr(),oe=i(K,!0);r(K),O(()=>z(oe,e(c))),f(B,K)};R(he,B=>{e(c)&&B(ce)})}r(q),r(x),O(()=>{p=ye(E,1,"view-btn svelte-zw83d1",null,p,{active:A.viewMode==="card"}),M=ye(d,1,"view-btn svelte-zw83d1",null,M,{active:A.viewMode==="table"}),C!==(C=A.pageSize)&&(X.value=(X.__value=A.pageSize)??"",Ft(X,A.pageSize)),T.disabled=e(v)||j.count===0,Qe(T,"title",j.count===0?"No devices to remove":"Remove all devices"),z(D,e(v)?"Removing...":"Remove All"),pe.disabled=e(l).length===0,ue.disabled=e(o)||e(s)===null,z(ge,e(o)?"Adding...":"Add Device")}),Fa("submit",q,m),Et(pe,()=>e(s),B=>h(s,B)),f(t,x),Me()}Ve(["click","change"]);var sr=y('<span class="badge badge-capability">color</span>'),ir=y('<span class="badge badge-capability">IR</span>'),lr=y('<span class="badge badge-extended-mz"> </span>'),nr=y('<span class="badge badge-capability"> </span>'),or=y('<span class="badge badge-capability"> </span>'),vr=y('<span class="badge badge-capability">HEV</span>'),cr=y('<div class="metadata-display"><div class="metadata-row"><span class="metadata-label">Firmware:</span> <span class="metadata-value"> </span></div> <div class="metadata-row"><span class="metadata-label">Vendor:</span> <span class="metadata-value"> </span></div> <div class="metadata-row"><span class="metadata-label">Product:</span> <span class="metadata-value"> </span></div> <div class="metadata-row"><span class="metadata-label">Capabilities:</span> <span class="metadata-value" style="color: var(--accent-primary);"> </span></div> <div class="metadata-row"><span class="metadata-label">Group:</span> <span class="metadata-value"> </span></div> <div class="metadata-row"><span class="metadata-label">Location:</span> <span class="metadata-value"> </span></div> <div class="metadata-row"><span class="metadata-label">Uptime:</span> <span class="metadata-value"> </span></div> <div class="metadata-row"><span class="metadata-label">WiFi Signal:</span> <span class="metadata-value"> </span></div></div>'),dr=y('<div class="zone-segment"></div>'),ur=y('<div class="zone-strip"></div>'),fr=y('<button type="button" class="toggle-link"> </button> <!>',1),_r=y('<div class="tile-zone"></div>'),pr=y('<div class="tile-grid"></div>'),hr=y('<div style="color: var(--text-dimmed);">No color data</div>'),br=y('<div class="tile-item"><div class="tile-label"></div> <!></div>'),mr=y('<div class="tiles-container"></div>'),gr=y('<button type="button" class="toggle-link"> </button> <!>',1),wr=y('<div style="margin-top: 4px;"><span class="color-swatch"></span> <span style="color: var(--text-muted); font-size: 0.75em;">Current color</span></div>'),yr=y('<div class="device"><div class="device-header"><div><div class="device-serial"> </div> <div class="device-label"> </div></div> <button class="btn btn-delete btn-sm"> </button></div> <div class="badges"><span> </span> <span class="badge badge-capability"> </span> <!> <!> <!> <!> <!></div> <button type="button" class="toggle-link"> </button> <!> <!></div>');function xr(t,a){De(a,!0);let l=re(!1);async function s(){if(confirm(`Delete device ${a.device.serial}?`)){h(l,!0);try{await Jt(a.device.serial)}catch(F){alert(F instanceof Error?F.message:"Failed to delete device")}finally{h(l,!1)}}}function o(F){return`${Math.floor(F/1e9)}s`}function v(){const F=[];return a.device.has_color&&F.push("Color"),a.device.has_infrared&&F.push("Infrared"),a.device.has_multizone&&F.push(`Multizone (${a.device.zone_count} zones)`),a.device.has_extended_multizone&&F.push("Extended Multizone"),a.device.has_matrix&&F.push(`Matrix (${a.device.tile_count} tiles)`),a.device.has_hev&&F.push("HEV/Clean"),a.device.has_relays&&F.push("Relays"),a.device.has_buttons&&F.push("Buttons"),F.join(", ")||"None"}let c=Ee(()=>A.isZonesExpanded(a.device.serial)),w=Ee(()=>A.isMetadataExpanded(a.device.serial));var m=yr(),S=i(m),k=i(S),x=i(k),_=i(x,!0);r(x);var g=n(x,2),b=i(g,!0);r(g),r(k);var E=n(k,2);E.__click=s;var p=i(E,!0);r(E),r(S);var d=n(S,2),M=i(d);let N;var X=i(M,!0);r(M);var C=n(M,2),T=i(C);r(C);var D=n(C,2);{var q=F=>{var L=sr();f(F,L)};R(D,F=>{a.device.has_color&&F(q)})}var G=n(D,2);{var H=F=>{var L=ir();f(F,L)};R(G,F=>{a.device.has_infrared&&F(H)})}var pe=n(G,2);{var le=F=>{var L=lr(),V=i(L);r(L),O(()=>z(V,`extended-mz×${a.device.zone_count??""}`)),f(F,L)},P=F=>{var L=Se(),V=de(L);{var se=te=>{var W=nr(),Q=i(W);r(W),O(()=>z(Q,`multizone×${a.device.zone_count??""}`)),f(te,W)};R(V,te=>{a.device.has_multizone&&te(se)},!0)}f(F,L)};R(pe,F=>{a.device.has_extended_multizone?F(le):F(P,!1)})}var ne=n(pe,2);{var ue=F=>{var L=or(),V=i(L);r(L),O(()=>z(V,`matrix×${a.device.tile_count??""}`)),f(F,L)};R(ne,F=>{a.device.has_matrix&&F(ue)})}var ge=n(ne,2);{var he=F=>{var L=vr();f(F,L)};R(ge,F=>{a.device.has_hev&&F(he)})}r(d);var ce=n(d,2);ce.__click=()=>A.toggleMetadataExpanded(a.device.serial);var B=i(ce);r(ce);var K=n(ce,2);{var oe=F=>{var L=cr(),V=i(L),se=n(i(V),2),te=i(se);r(se),r(V);var W=n(V,2),Q=n(i(W),2),U=i(Q,!0);r(Q),r(W);var ee=n(W,2),ae=n(i(ee),2),Y=i(ae,!0);r(ae),r(ee);var Z=n(ee,2),$=n(i(Z),2),_e=i($,!0);r($),r(Z);var ve=n(Z,2),Ne=n(i(ve),2),He=i(Ne,!0);r(Ne),r(ve);var Ue=n(ve,2),Ze=n(i(Ue),2),at=i(Ze,!0);r(Ze),r(Ue);var We=n(Ue,2),we=n(i(We),2),Te=i(we,!0);r(we),r(We);var Xe=n(We,2),$e=n(i(Xe),2),u=i($e);r($e),r(Xe),r(L),O((I,J,xe)=>{z(te,`${a.device.version_major??""}.${a.device.version_minor??""}`),z(U,a.device.vendor),z(Y,a.device.product),z(_e,I),z(He,a.device.group_label),z(at,a.device.location_label),z(Te,J),z(u,`${xe??""} dBm`)},[v,()=>o(a.device.uptime_ns),()=>a.device.wifi_signal.toFixed(1)]),f(F,L)};R(K,F=>{e(w)&&F(oe)})}var ie=n(K,2);{var fe=F=>{var L=fr(),V=de(L);V.__click=()=>A.toggleZonesExpanded(a.device.serial);var se=i(V);r(V);var te=n(V,2);{var W=Q=>{var U=ur();be(U,21,()=>a.device.zone_colors,ze,(ee,ae)=>{var Y=dr();O(Z=>Pe(Y,`background: ${Z??""};`),[()=>Je(e(ae))]),f(ee,Y)}),r(U),f(Q,U)};R(te,Q=>{e(c)&&Q(W)})}O(()=>z(se,`${e(c)?"▾":"▸"} ${e(c)?"Hide":"Show"} zones (${a.device.zone_colors.length??""})`)),f(F,L)},me=F=>{var L=Se(),V=de(L);{var se=W=>{var Q=gr(),U=de(Q);U.__click=()=>A.toggleZonesExpanded(a.device.serial);var ee=i(U);r(U);var ae=n(U,2);{var Y=Z=>{var $=mr();be($,21,()=>a.device.tile_devices,ze,(_e,ve,Ne)=>{var He=br(),Ue=i(He);Ue.textContent=`T${Ne+1}`;var Ze=n(Ue,2);{var at=we=>{var Te=pr();be(Te,21,()=>e(ve).colors.slice(0,(e(ve).width||8)*(e(ve).height||8)),ze,(Xe,$e)=>{var u=_r();O(I=>Pe(u,`background: ${I??""};`),[()=>Je(e($e))]),f(Xe,u)}),r(Te),O(()=>Pe(Te,`grid-template-columns: repeat(${(e(ve).width||8)??""}, 8px);`)),f(we,Te)},We=we=>{var Te=hr();f(we,Te)};R(Ze,we=>{e(ve).colors&&e(ve).colors.length>0?we(at):we(We,!1)})}r(He),f(_e,He)}),r($),f(Z,$)};R(ae,Z=>{e(c)&&Z(Y)})}O(()=>z(ee,`${e(c)?"▾":"▸"} ${e(c)?"Hide":"Show"} tiles (${a.device.tile_devices.length??""})`)),f(W,Q)},te=W=>{var Q=Se(),U=de(Q);{var ee=ae=>{var Y=wr(),Z=i(Y);ct(2),r(Y),O($=>Pe(Z,`background: ${$??""};`),[()=>Je(a.device.color)]),f(ae,Y)};R(U,ae=>{a.device.has_color&&a.device.color&&ae(ee)},!0)}f(W,Q)};R(V,W=>{a.device.has_matrix&&a.device.tile_devices&&a.device.tile_devices.length>0?W(se):W(te,!1)},!0)}f(F,L)};R(ie,F=>{a.device.has_multizone&&a.device.zone_colors&&a.device.zone_colors.length>0?F(fe):F(me,!1)})}r(m),O(()=>{z(_,a.device.serial),z(b,a.device.label),E.disabled=e(l),z(p,e(l)?"...":"Del"),N=ye(M,1,"badge",null,N,{"badge-power-on":a.device.power_level>0,"badge-power-off":a.device.power_level===0}),z(X,a.device.power_level>0?"ON":"OFF"),z(T,`P${a.device.product??""}`),z(B,`${e(w)?"▾":"▸"} ${e(w)?"Hide":"Show"} metadata`)}),f(t,m),Me()}Ve(["click"]);var kr=y('<div class="no-devices">No devices emulated</div>'),Sr=y('<div class="pagination svelte-qz4xni"><button class="btn btn-sm">Previous</button> <span class="page-info svelte-qz4xni"> </span> <button class="btn btn-sm">Next</button></div>'),zr=y('<div class="devices-grid"></div> <!>',1),Fr=y('<div class="card"><h2 style="display: flex; justify-content: space-between; align-items: center;"><span> </span> <button class="btn btn-delete" title="Remove all devices from server (runtime only)"> </button></h2> <!></div>');function Er(t,a){De(a,!0);let l=re(!1),s=re(tt(j.count));async function o(){if(j.count===0){alert("No devices to remove");return}const M=`Remove all ${j.count} device(s) from the server?

This will stop all devices from responding to LIFX protocol packets, but will not delete persistent storage.`;if(confirm(M)){h(l,!0);try{const N=await It();alert(N.message)}catch(N){alert(N instanceof Error?N.message:"Failed to remove devices")}finally{h(l,!1)}}}let v=Ee(()=>Math.max(1,Math.ceil(j.count/A.pageSize))),c=Ee(()=>{const M=(A.currentPage-1)*A.pageSize,N=M+A.pageSize;return j.list.slice(M,N)});function w(){A.currentPage>1&&A.setCurrentPage(A.currentPage-1)}function m(){A.currentPage<e(v)&&A.setCurrentPage(A.currentPage+1)}dt(()=>{if(Math.abs(j.count-e(s))>0){const N=Math.max(1,Math.ceil(j.count/A.pageSize));A.currentPage>N&&A.setCurrentPage(1),h(s,j.count,!0)}});var S=Fr(),k=i(S),x=i(k),_=i(x);r(x);var g=n(x,2);g.__click=o;var b=i(g,!0);r(g),r(k);var E=n(k,2);{var p=M=>{var N=kr();f(M,N)},d=M=>{var N=zr(),X=de(N);be(X,21,()=>e(c),D=>D.serial,(D,q)=>{xr(D,{get device(){return e(q)}})}),r(X);var C=n(X,2);{var T=D=>{var q=Sr(),G=i(q);G.__click=w;var H=n(G,2),pe=i(H);r(H);var le=n(H,2);le.__click=m,r(q),O(()=>{G.disabled=A.currentPage<=1,z(pe,`Page ${A.currentPage??""} of ${e(v)??""}`),le.disabled=A.currentPage>=e(v)}),f(D,q)};R(C,D=>{e(v)>1&&D(T)})}f(M,N)};R(E,M=>{j.count===0?M(p):M(d,!1)})}r(S),O(()=>{z(_,`Devices (${j.count??""})`),g.disabled=e(l)||j.count===0,z(b,e(l)?"Removing...":"Remove All")}),f(t,S),Me()}Ve(["click"]);var Ir=y('<div class="no-devices svelte-14519bm">No devices emulated</div>'),Lr=y('<div class="zone-mini svelte-14519bm"></div>'),Cr=y('<span class="more-zones svelte-14519bm"> </span>'),Tr=y('<div class="zone-mini-strip svelte-14519bm"><!> <!></div>'),Ar=y('<span class="color-swatch svelte-14519bm"></span>'),Pr=y('<span class="no-color svelte-14519bm">-</span>'),Dr=y('<tr class="svelte-14519bm"><td class="cell-serial svelte-14519bm"> </td><td class="cell-label svelte-14519bm"> </td><td class="cell-product svelte-14519bm"> </td><td class="svelte-14519bm"><span> </span></td><td class="svelte-14519bm"><!></td><td class="svelte-14519bm"><button class="btn btn-delete btn-sm"> </button></td></tr>'),Mr=y('<div class="pagination svelte-14519bm"><button class="btn btn-sm">Previous</button> <span class="page-info svelte-14519bm"> </span> <button class="btn btn-sm">Next</button></div>'),Nr=y('<div class="table-container svelte-14519bm"><table class="device-table svelte-14519bm"><thead><tr><th class="svelte-14519bm">Serial</th><th class="svelte-14519bm">Label</th><th class="svelte-14519bm">Product</th><th class="svelte-14519bm">Power</th><th class="svelte-14519bm">Color</th><th class="svelte-14519bm">Actions</th></tr></thead><tbody class="svelte-14519bm"></tbody></table></div> <!>',1),Xr=y('<div class="card"><h2 style="display: flex; justify-content: space-between; align-items: center;"><span> </span> <button class="btn btn-delete" title="Remove all devices from server (runtime only)"> </button></h2> <!></div>');function Rr(t,a){De(a,!0);let l=re(!1),s=re(null),o=re(tt(j.count));async function v(){if(j.count===0){alert("No devices to remove");return}const C=`Remove all ${j.count} device(s) from the server?

This will stop all devices from responding to LIFX protocol packets, but will not delete persistent storage.`;if(confirm(C)){h(l,!0);try{const T=await It();alert(T.message)}catch(T){alert(T instanceof Error?T.message:"Failed to remove devices")}finally{h(l,!1)}}}async function c(C){if(confirm(`Delete device ${C}?`)){h(s,C,!0);try{await Jt(C)}catch(T){alert(T instanceof Error?T.message:"Failed to delete device")}finally{h(s,null)}}}function w(C){return{1:"Original 1000",10:"White 800 (Low Voltage)",11:"White 800 (High Voltage)",18:"White 900 BR30",20:"Color 1000 BR30",22:"Color 1000",27:"LIFX A19",28:"LIFX BR30",29:"LIFX+ A19",30:"LIFX+ BR30",31:"LIFX Z",32:"LIFX Z 2",36:"LIFX Downlight",37:"LIFX Downlight",38:"LIFX Beam",43:"LIFX A19",44:"LIFX BR30",45:"LIFX+ A19",46:"LIFX+ BR30",49:"LIFX Mini Color",50:"LIFX Mini Day and Dusk",51:"LIFX Mini White",52:"LIFX GU10",55:"LIFX Tile",57:"LIFX Candle",59:"LIFX Mini Color",60:"LIFX Mini Day and Dusk",61:"LIFX Mini White",62:"LIFX A19",63:"LIFX BR30",64:"LIFX A19 Night Vision",65:"LIFX BR30 Night Vision",68:"LIFX Candle CA",70:"LIFX Switch",71:"LIFX Switch",81:"LIFX Candle Warm to White",82:"LIFX Filament",85:"LIFX A19 HEV",87:"LIFX Candle Color",88:"LIFX BR30 HEV",89:"LIFX A19 Clean",90:"LIFX Color",91:"LIFX Color",94:"LIFX BR30",96:"LIFX Candle White to Warm",97:"LIFX A19",98:"LIFX BR30",99:"LIFX Clean",100:"LIFX Filament Clear",101:"LIFX Filament Amber",109:"LIFX A19 HEV",110:"LIFX BR30 HEV",111:"LIFX Neon",112:"LIFX Lightstrip",120:"LIFX GU10"}[C]||`Product ${C}`}let m=Ee(()=>Math.max(1,Math.ceil(j.count/A.pageSize))),S=Ee(()=>{const C=(A.currentPage-1)*A.pageSize,T=C+A.pageSize;return j.list.slice(C,T)});function k(){A.currentPage>1&&A.setCurrentPage(A.currentPage-1)}function x(){A.currentPage<e(m)&&A.setCurrentPage(A.currentPage+1)}dt(()=>{if(Math.abs(j.count-e(o))>0){const T=Math.max(1,Math.ceil(j.count/A.pageSize));A.currentPage>T&&A.setCurrentPage(1),h(o,j.count,!0)}});var _=Xr(),g=i(_),b=i(g),E=i(b);r(b);var p=n(b,2);p.__click=v;var d=i(p,!0);r(p),r(g);var M=n(g,2);{var N=C=>{var T=Ir();f(C,T)},X=C=>{var T=Nr(),D=de(T),q=i(D),G=n(i(q));be(G,21,()=>e(S),le=>le.serial,(le,P)=>{var ne=Dr(),ue=i(ne),ge=i(ue,!0);r(ue);var he=n(ue),ce=i(he,!0);r(he);var B=n(he),K=i(B,!0);r(B);var oe=n(B),ie=i(oe);let fe;var me=i(ie,!0);r(ie),r(oe);var F=n(oe),L=i(F);{var V=U=>{var ee=Tr(),ae=i(ee);be(ae,17,()=>e(P).zone_colors.slice(0,16),ze,($,_e)=>{var ve=Lr();O(Ne=>Pe(ve,`background: ${Ne??""};`),[()=>Je(e(_e))]),f($,ve)});var Y=n(ae,2);{var Z=$=>{var _e=Cr(),ve=i(_e);r(_e),O(()=>z(ve,`+${e(P).zone_colors.length-16}`)),f($,_e)};R(Y,$=>{e(P).zone_colors.length>16&&$(Z)})}r(ee),f(U,ee)},se=U=>{var ee=Se(),ae=de(ee);{var Y=$=>{var _e=Ar();O(ve=>Pe(_e,`background: ${ve??""};`),[()=>Je(e(P).color)]),f($,_e)},Z=$=>{var _e=Pr();f($,_e)};R(ae,$=>{e(P).has_color&&e(P).color?$(Y):$(Z,!1)},!0)}f(U,ee)};R(L,U=>{e(P).has_multizone&&e(P).zone_colors&&e(P).zone_colors.length>0?U(V):U(se,!1)})}r(F);var te=n(F),W=i(te);W.__click=()=>c(e(P).serial);var Q=i(W,!0);r(W),r(te),r(ne),O(U=>{z(ge,e(P).serial),z(ce,e(P).label),z(K,U),fe=ye(ie,1,"power-badge svelte-14519bm",null,fe,{"power-on":e(P).power_level>0,"power-off":e(P).power_level===0}),z(me,e(P).power_level>0?"ON":"OFF"),W.disabled=e(s)===e(P).serial,z(Q,e(s)===e(P).serial?"...":"Del")},[()=>w(e(P).product)]),f(le,ne)}),r(G),r(q),r(D);var H=n(D,2);{var pe=le=>{var P=Mr(),ne=i(P);ne.__click=k;var ue=n(ne,2),ge=i(ue);r(ue);var he=n(ue,2);he.__click=x,r(P),O(()=>{ne.disabled=A.currentPage<=1,z(ge,`Page ${A.currentPage??""} of ${e(m)??""}`),he.disabled=A.currentPage>=e(m)}),f(le,P)};R(H,le=>{e(m)>1&&le(pe)})}f(C,T)};R(M,C=>{j.count===0?C(N):C(X,!1)})}r(_),O(()=>{z(E,`Devices (${j.count??""})`),p.disabled=e(l)||j.count===0,z(d,e(l)?"Removing...":"Remove All")}),f(t,_),Me()}Ve(["click"]);var Or=y('<div class="activity-disabled svelte-i8zsux"><p class="svelte-i8zsux">Activity logging is disabled.</p> <p class="hint svelte-i8zsux">Start the emulator with <code class="svelte-i8zsux">--api-activity</code> to enable packet logging.</p></div>'),Br=y('<button class="btn btn-sm">Clear</button>'),Vr=y('<div style="color: var(--text-dimmed);">No activity yet</div>'),Hr=y('<div style="color: var(--text-dimmed);">No matching activity</div>'),Ur=y('<div class="activity-item"><span class="activity-time"> </span> <span> </span> <span class="activity-packet"> </span> <span class="device-serial"> </span> <span style="color: var(--text-dimmed);"> </span></div>'),Wr=y('<div class="activity-filters"><div class="filter-group"><label for="filter-direction">Direction:</label> <select id="filter-direction"><option>All</option><option>RX</option><option>TX</option></select></div> <div class="filter-group"><label for="filter-device">Device/Target:</label> <input id="filter-device" type="text" placeholder="Filter by device..."/></div> <div class="filter-group"><label for="filter-packet">Packet:</label> <input id="filter-packet" type="text" placeholder="Filter by packet..."/></div> <!></div> <div class="activity-log"><!></div>',1),jr=y('<div class="card"><h2>Recent Activity</h2> <!></div>');function qr(t,a){De(a,!0);let l=re("all"),s=re(""),o=re("");function v(x){return new Date(x*1e3).toLocaleTimeString()}let c=Ee(()=>{let x=ot.reversed;if(e(l)!=="all"&&(x=x.filter(_=>_.direction===e(l))),e(s)){const _=e(s).toLowerCase();x=x.filter(g=>g.device?.toLowerCase().includes(_)||g.target?.toLowerCase().includes(_))}if(e(o)){const _=e(o).toLowerCase();x=x.filter(g=>g.packet_name.toLowerCase().includes(_))}return x});var w=jr(),m=n(i(w),2);{var S=x=>{var _=Or();f(x,_)},k=x=>{var _=Wr(),g=de(_),b=i(g),E=n(i(b),2),p=i(E);p.value=p.__value="all";var d=n(p);d.value=d.__value="rx";var M=n(d);M.value=M.__value="tx",r(E),r(b);var N=n(b,2),X=n(i(N),2);Ie(X),r(N);var C=n(N,2),T=n(i(C),2);Ie(T),r(C);var D=n(C,2);{var q=P=>{var ne=Br();ne.__click=()=>{h(l,"all"),h(s,""),h(o,"")},f(P,ne)};R(D,P=>{(e(l)!=="all"||e(s)||e(o))&&P(q)})}r(g);var G=n(g,2),H=i(G);{var pe=P=>{var ne=Vr();f(P,ne)},le=P=>{var ne=Se(),ue=de(ne);{var ge=ce=>{var B=Hr();f(ce,B)},he=ce=>{var B=Se(),K=de(B);be(K,17,()=>e(c),ze,(oe,ie)=>{var fe=Ur(),me=i(fe),F=i(me,!0);r(me);var L=n(me,2),V=i(L,!0);r(L);var se=n(L,2),te=i(se,!0);r(se);var W=n(se,2),Q=i(W,!0);r(W);var U=n(W,2),ee=i(U,!0);r(U),r(fe),O((ae,Y)=>{z(F,ae),ye(L,1,Ta(e(ie).direction==="rx"?"activity-rx":"activity-tx")),z(V,Y),z(te,e(ie).packet_name),z(Q,e(ie).device||e(ie).target||"N/A"),z(ee,e(ie).addr)},[()=>v(e(ie).timestamp),()=>e(ie).direction.toUpperCase()]),f(oe,fe)}),f(ce,B)};R(ue,ce=>{e(c).length===0?ce(ge):ce(he,!1)},!0)}f(P,ne)};R(H,P=>{ot.count===0?P(pe):P(le,!1)})}r(G),Et(E,()=>e(l),P=>h(l,P)),Ce(X,()=>e(s),P=>h(s,P)),Ce(T,()=>e(o),P=>h(o,P)),f(x,_)};R(m,x=>{Ge.value.activity_enabled?x(k,!1):x(S)})}r(w),f(t,w),Me()}Ve(["click"]);var Gr=y("<button> </button>"),Jr=y("<option> </option>"),Yr=y("<option> </option>"),Zr=y('<div class="form-group" style="margin-top: 12px;"><label for="identifier"> </label> <select id="identifier"><!></select></div>'),Kr=y('<div class="inline-row svelte-15drtwo"><input type="text" placeholder="Packet type (e.g., 101)" style="width: 140px;" class="svelte-15drtwo"/> <input type="number" min="0" max="1" step="0.1" placeholder="Drop rate" style="width: 100px;" class="svelte-15drtwo"/> <button type="button" class="btn btn-delete btn-sm">X</button></div>'),Qr=y('<div class="inline-row svelte-15drtwo"><input type="text" placeholder="Packet type (e.g., 101)" style="width: 140px;" class="svelte-15drtwo"/> <input type="number" min="0" step="0.1" placeholder="Delay (s)" style="width: 100px;" class="svelte-15drtwo"/> <button type="button" class="btn btn-delete btn-sm">X</button></div>'),$r=y('<button type="button" class="btn btn-sm">Clear</button>'),es=y('<p class="message error svelte-15drtwo"> </p>'),ts=y('<p class="message success svelte-15drtwo"> </p>'),as=y('<div class="card"><h2>Scenario Configuration</h2> <div class="scope-tabs svelte-15drtwo"></div> <!> <div class="scenario-form svelte-15drtwo"><div class="form-section svelte-15drtwo"><div class="section-header svelte-15drtwo"><span class="section-title svelte-15drtwo">Drop Packets</span> <button type="button" class="btn btn-sm">+ Add</button></div> <p class="section-desc svelte-15drtwo">Specify packet types to drop (0.0 = never, 1.0 = always)</p> <!></div> <div class="form-section svelte-15drtwo"><div class="section-header svelte-15drtwo"><span class="section-title svelte-15drtwo">Response Delays</span> <button type="button" class="btn btn-sm">+ Add</button></div> <p class="section-desc svelte-15drtwo">Add delay (seconds) before responding to packet types</p> <!></div> <div class="form-section svelte-15drtwo"><label for="malformed" class="section-title svelte-15drtwo">Malformed Packets</label> <p class="section-desc svelte-15drtwo">Packet types to send with corrupted payloads (comma-separated)</p> <input id="malformed" type="text" placeholder="e.g., 101, 102, 118" class="svelte-15drtwo"/></div> <div class="form-section svelte-15drtwo"><label for="invalid" class="section-title svelte-15drtwo">Invalid Field Values</label> <p class="section-desc svelte-15drtwo">Packet types to send with 0xFF bytes (comma-separated)</p> <input id="invalid" type="text" placeholder="e.g., 101, 102" class="svelte-15drtwo"/></div> <div class="form-section svelte-15drtwo"><div class="section-header svelte-15drtwo"><span class="section-title svelte-15drtwo">Firmware Version Override</span> <!></div> <p class="section-desc svelte-15drtwo">Override reported firmware version (major.minor)</p> <div class="inline-row svelte-15drtwo"><input type="number" min="0" max="255" placeholder="Major" style="width: 80px;" class="svelte-15drtwo"/> <span>.</span> <input type="number" min="0" max="255" placeholder="Minor" style="width: 80px;" class="svelte-15drtwo"/></div></div> <div class="form-section svelte-15drtwo"><label for="partial" class="section-title svelte-15drtwo">Partial Responses</label> <p class="section-desc svelte-15drtwo">Packet types to send with incomplete data (comma-separated)</p> <input id="partial" type="text" placeholder="e.g., 506, 512" class="svelte-15drtwo"/></div> <div class="form-section svelte-15drtwo"><label class="checkbox-label svelte-15drtwo"><input type="checkbox" class="svelte-15drtwo"/> <span>Send Unhandled</span></label> <p class="section-desc svelte-15drtwo">Return StateUnhandled for unknown packet types</p></div></div> <!> <!> <div class="actions svelte-15drtwo"><button class="btn"> </button> <button class="btn btn-delete"> </button></div></div>');function rs(t,a){De(a,!0);const l=["matrix","extended_multizone","multizone","hev","infrared","color","basic"];let s=re("global"),o=re(""),v=re(!1),c=re(null),w=re(null),m=re(tt([])),S=re(tt([])),k=re(""),x=re(""),_=re(""),g=re(""),b=re(""),E=re(!1);function p(u){return{global:"devices",device:"devices",type:"types",location:"locations",group:"groups"}[u]}let d=Ee(()=>()=>{switch(e(s)){case"device":return j.list.map(u=>u.serial);case"type":return l;case"location":return[...new Set(j.list.map(u=>u.location_label).filter(Boolean))];case"group":return[...new Set(j.list.map(u=>u.group_label).filter(Boolean))];default:return[]}}),M=Ee(()=>()=>{switch(e(s)){case"global":return Ke.global;case"device":return e(o)?Ke.devices[e(o)]:null;case"type":return e(o)?Ke.types[e(o)]:null;case"location":return e(o)?Ke.locations[e(o)]:null;case"group":return e(o)?Ke.groups[e(o)]:null;default:return null}});function N(u){if(!u){h(m,[],!0),h(S,[],!0),h(k,""),h(x,""),h(_,""),h(g,""),h(b,""),h(E,!0);return}u.drop_packets&&Object.keys(u.drop_packets).length>0?h(m,Object.entries(u.drop_packets).map(([I,J])=>({packetType:I,rate:String(J)})),!0):h(m,[],!0),u.response_delays&&Object.keys(u.response_delays).length>0?h(S,Object.entries(u.response_delays).map(([I,J])=>({packetType:I,delay:String(J)})),!0):h(S,[],!0),h(k,u.malformed_packets?.join(", ")||"",!0),h(x,u.invalid_field_values?.join(", ")||"",!0),h(b,u.partial_responses?.join(", ")||"",!0),u.firmware_version?(h(_,String(u.firmware_version[0]),!0),h(g,String(u.firmware_version[1]),!0)):(h(_,""),h(g,"")),h(E,u.send_unhandled??!0,!0)}function X(){const u={};if(e(m).length>0){u.drop_packets={};for(const{packetType:I,rate:J}of e(m))I&&J&&(u.drop_packets[I]=parseFloat(J))}if(e(S).length>0){u.response_delays={};for(const{packetType:I,delay:J}of e(S))I&&J&&(u.response_delays[I]=parseFloat(J))}return e(k).trim()&&(u.malformed_packets=e(k).split(",").map(I=>parseInt(I.trim(),10)).filter(I=>!isNaN(I))),e(x).trim()&&(u.invalid_field_values=e(x).split(",").map(I=>parseInt(I.trim(),10)).filter(I=>!isNaN(I))),e(b).trim()&&(u.partial_responses=e(b).split(",").map(I=>parseInt(I.trim(),10)).filter(I=>!isNaN(I))),e(_)&&e(g)&&(u.firmware_version=[parseInt(e(_),10),parseInt(e(g),10)]),u.send_unhandled=e(E),u}async function C(){h(c,null),h(w,null),h(v,!0);try{const u=X();if(e(s)==="global")await Ja(u);else{if(!e(o))throw new Error("Please select an identifier");await Za(p(e(s)),e(o),u)}h(w,"Scenario applied successfully"),setTimeout(()=>h(w,null),3e3)}catch(u){h(c,u instanceof Error?u.message:"Failed to apply scenario",!0)}finally{h(v,!1)}}async function T(){h(c,null),h(w,null),h(v,!0);try{if(e(s)==="global")await Ya();else{if(!e(o))throw new Error("Please select an identifier");await Ka(p(e(s)),e(o))}N(null),h(w,"Scenario cleared successfully"),setTimeout(()=>h(w,null),3e3)}catch(u){h(c,u instanceof Error?u.message:"Failed to clear scenario",!0)}finally{h(v,!1)}}function D(){h(m,[...e(m),{packetType:"",rate:"1.0"}],!0)}function q(u){h(m,e(m).filter((I,J)=>J!==u),!0)}function G(){h(S,[...e(S),{packetType:"",delay:"0.5"}],!0)}function H(u){h(S,e(S).filter((I,J)=>J!==u),!0)}function pe(){h(_,""),h(g,"")}dt(()=>{e(s)==="global"?N(e(M)()):e(o)?N(e(M)()):N(null)}),dt(()=>{const u=e(d)();e(s)!=="global"&&u.length>0&&!u.includes(e(o))&&h(o,u[0],!0)});var le=as(),P=n(i(le),2);be(P,20,()=>["global","device","type","location","group"],ze,(u,I)=>{var J=Gr();let xe;J.__click=()=>h(s,I,!0);var Fe=i(J,!0);r(J),O(Le=>{xe=ye(J,1,"scope-tab svelte-15drtwo",null,xe,{active:e(s)===I}),z(Fe,Le)},[()=>I.charAt(0).toUpperCase()+I.slice(1)]),f(u,J)}),r(P);var ne=n(P,2);{var ue=u=>{var I=Zr(),J=i(I),xe=i(J);r(J);var Fe=n(J,2),Le=i(Fe);{var rt=Ae=>{var je=Jr(),ut=i(je);r(je),je.value=je.__value="",O(()=>z(ut,`No ${e(s)??""}s available`)),f(Ae,je)},Re=Ae=>{var je=Se(),ut=de(je);be(ut,17,()=>e(d)(),ze,(Yt,ft)=>{var st=Yr(),Zt=i(st,!0);r(st);var Lt={};O(()=>{z(Zt,e(ft)),Lt!==(Lt=e(ft))&&(st.value=(st.__value=e(ft))??"")}),f(Yt,st)}),f(Ae,je)};R(Le,Ae=>{e(d)().length===0?Ae(rt):Ae(Re,!1)})}r(Fe),r(I),O(Ae=>z(xe,`${Ae??""}:`),[()=>e(s).charAt(0).toUpperCase()+e(s).slice(1)]),Et(Fe,()=>e(o),Ae=>h(o,Ae)),f(u,I)};R(ne,u=>{e(s)!=="global"&&u(ue)})}var ge=n(ne,2),he=i(ge),ce=i(he),B=n(i(ce),2);B.__click=D,r(ce);var K=n(ce,4);be(K,17,()=>e(m),ze,(u,I,J)=>{var xe=Kr(),Fe=i(xe);Ie(Fe);var Le=n(Fe,2);Ie(Le);var rt=n(Le,2);rt.__click=()=>q(J),r(xe),Ce(Fe,()=>e(I).packetType,Re=>e(I).packetType=Re),Ce(Le,()=>e(I).rate,Re=>e(I).rate=Re),f(u,xe)}),r(he);var oe=n(he,2),ie=i(oe),fe=n(i(ie),2);fe.__click=G,r(ie);var me=n(ie,4);be(me,17,()=>e(S),ze,(u,I,J)=>{var xe=Qr(),Fe=i(xe);Ie(Fe);var Le=n(Fe,2);Ie(Le);var rt=n(Le,2);rt.__click=()=>H(J),r(xe),Ce(Fe,()=>e(I).packetType,Re=>e(I).packetType=Re),Ce(Le,()=>e(I).delay,Re=>e(I).delay=Re),f(u,xe)}),r(oe);var F=n(oe,2),L=n(i(F),4);Ie(L),r(F);var V=n(F,2),se=n(i(V),4);Ie(se),r(V);var te=n(V,2),W=i(te),Q=n(i(W),2);{var U=u=>{var I=$r();I.__click=pe,f(u,I)};R(Q,u=>{(e(_)||e(g))&&u(U)})}r(W);var ee=n(W,4),ae=i(ee);Ie(ae);var Y=n(ae,4);Ie(Y),r(ee),r(te);var Z=n(te,2),$=n(i(Z),4);Ie($),r(Z);var _e=n(Z,2),ve=i(_e),Ne=i(ve);Ie(Ne),ct(2),r(ve),ct(2),r(_e),r(ge);var He=n(ge,2);{var Ue=u=>{var I=es(),J=i(I,!0);r(I),O(()=>z(J,e(c))),f(u,I)};R(He,u=>{e(c)&&u(Ue)})}var Ze=n(He,2);{var at=u=>{var I=ts(),J=i(I,!0);r(I),O(()=>z(J,e(w))),f(u,I)};R(Ze,u=>{e(w)&&u(at)})}var We=n(Ze,2),we=i(We);we.__click=C;var Te=i(we,!0);r(we);var Xe=n(we,2);Xe.__click=T;var $e=i(Xe,!0);r(Xe),r(We),r(le),O(()=>{we.disabled=e(v)||e(s)!=="global"&&!e(o),z(Te,e(v)?"Applying...":"Apply"),Xe.disabled=e(v)||e(s)!=="global"&&!e(o),z($e,e(v)?"Clearing...":"Clear")}),Ce(L,()=>e(k),u=>h(k,u)),Ce(se,()=>e(x),u=>h(x,u)),Ce(ae,()=>e(_),u=>h(_,u)),Ce(Y,()=>e(g),u=>h(g,u)),Ce($,()=>e(b),u=>h(b,u)),Ra(Ne,()=>e(E),u=>h(E,u)),f(t,le),Me()}Ve(["click"]);var ss=y('<div class="no-devices svelte-t60k18"><p class="svelte-t60k18">No devices to visualize</p> <p class="hint svelte-t60k18">Add devices with color, multizone, or matrix capabilities</p></div>'),is=y('<span class="viz-zones svelte-t60k18"> </span>'),ls=y("<button><span>Tiled</span> <span>Seamless</span></button>"),ns=y('<div class="viz-tile-label svelte-t60k18"></div>'),os=y('<div class="viz-tile-zone svelte-t60k18"></div>'),vs=y('<div class="viz-tile-wrapper svelte-t60k18"><!> <div class="viz-tile-grid svelte-t60k18"></div></div>'),cs=y("<div></div>"),ds=y('<div class="viz-zone svelte-t60k18"></div>'),us=y('<div class="viz-zone-strip svelte-t60k18"></div>'),fs=y('<div class="viz-color-swatch svelte-t60k18"></div>'),_s=y('<div><div class="viz-header svelte-t60k18"><div class="viz-info svelte-t60k18"><span class="viz-label svelte-t60k18"> </span> <span class="viz-serial svelte-t60k18"> </span></div> <div class="viz-meta svelte-t60k18"><span class="viz-type svelte-t60k18"> </span> <!> <!> <span> </span></div></div> <div class="viz-display svelte-t60k18"><!></div></div>'),ps=y('<div class="device-grid svelte-t60k18"></div>'),hs=y('<div class="visualizer svelte-t60k18"><!></div>');function bs(t,a){De(a,!0);let l=re(tt(new Set));function s(b){h(l,new Set(e(l)),!0),e(l).has(b)?e(l).delete(b):e(l).add(b)}function o(b){return b.has_matrix&&b.tile_devices?Math.min(b.tile_devices.length,5):b.has_multizone&&b.zone_count>50?2:1}let v=Ee(()=>{const b=j.list.filter(E=>E.has_color&&E.color||E.has_multizone&&E.zone_colors&&E.zone_colors.length>0||E.has_matrix&&E.tile_devices&&E.tile_devices.length>0);return console.log("Visualizer devices:",j.list.length,"total,",b.length,"visual"),b}),c=Ee(()=>[...e(v)].sort((b,E)=>o(E)-o(b)));function w(b){const E=j.getTransition(b);return!E||Date.now()-E.timestamp>E.duration_ms+100?0:E.duration_ms}function m(b){return b.has_relays?"Switch":b.has_matrix?"Matrix":b.has_multizone?"Multizone":b.has_color?"Color":"Light"}function S(b){return b.has_matrix&&b.tile_devices?b.tile_devices.reduce((E,p)=>E+p.width*p.height,0):b.zone_count}var k=hs(),x=i(k);{var _=b=>{var E=ss();f(b,E)},g=b=>{var E=ps();be(E,21,()=>e(c),p=>p.serial,(p,d)=>{const M=Ee(()=>w(e(d).serial)),N=Ee(()=>o(e(d)));var X=_s();let C;var T=i(X),D=i(T),q=i(D),G=i(q,!0);r(q);var H=n(q,2),pe=i(H,!0);r(H),r(D);var le=n(D,2),P=i(le),ne=i(P,!0);r(P);var ue=n(P,2);{var ge=L=>{var V=is(),se=i(V);r(V),O(te=>z(se,`${te??""} zones`),[()=>S(e(d))]),f(L,V)};R(ue,L=>{(e(d).has_multizone||e(d).has_matrix)&&L(ge)})}var he=n(ue,2);{var ce=L=>{var V=ls();let se;V.__click=()=>s(e(d).serial);var te=i(V);let W;var Q=n(te,2);let U;r(V),O((ee,ae,Y,Z)=>{se=ye(V,1,"viz-view-toggle svelte-t60k18",null,se,ee),Qe(V,"title",ae),W=ye(te,1,"toggle-option svelte-t60k18",null,W,Y),U=ye(Q,1,"toggle-option svelte-t60k18",null,U,Z)},[()=>({seamless:e(l).has(e(d).serial)}),()=>e(l).has(e(d).serial)?"Show tiles separately":"Show as seamless matrix",()=>({active:!e(l).has(e(d).serial)}),()=>({active:e(l).has(e(d).serial)})]),f(L,V)};R(he,L=>{e(d).has_matrix&&e(d).tile_devices&&e(d).tile_devices.length>1&&L(ce)})}var B=n(he,2);let K;var oe=i(B,!0);r(B),r(le),r(T);var ie=n(T,2),fe=i(ie);{var me=L=>{var V=cs();let se;be(V,21,()=>e(d).tile_devices,ze,(te,W,Q)=>{var U=vs(),ee=i(U);{var ae=Z=>{var $=ns();$.textContent=`T${Q+1}`,f(Z,$)};R(ee,Z=>{e(l).has(e(d).serial)||Z(ae)})}var Y=n(ee,2);be(Y,21,()=>e(W).colors,ze,(Z,$)=>{var _e=os();O(ve=>Pe(_e,`
														background: ${ve??""};
														transition: background ${e(M)??""}ms ease-out;
													`),[()=>Je(e($))]),f(Z,_e)}),r(Y),r(U),O(()=>Pe(Y,`
												grid-template-columns: repeat(${e(W).width??""}, 1fr);
												aspect-ratio: ${e(W).width??""} / ${e(W).height??""};
											`)),f(te,U)}),r(V),O(te=>se=ye(V,1,"viz-tiles svelte-t60k18",null,se,te),[()=>({seamless:e(l).has(e(d).serial)})]),f(L,V)},F=L=>{var V=Se(),se=de(V);{var te=Q=>{var U=us();be(U,21,()=>e(d).zone_colors,ze,(ee,ae)=>{var Y=ds();O(Z=>Pe(Y,`
											background: ${Z??""};
											transition: background ${e(M)??""}ms ease-out;
										`),[()=>Je(e(ae))]),f(ee,Y)}),r(U),f(Q,U)},W=Q=>{var U=Se(),ee=de(U);{var ae=Y=>{var Z=fs();O($=>Pe(Z,`
									background: ${$??""};
									transition: background ${e(M)??""}ms ease-out;
								`),[()=>Je(e(d).color)]),f(Y,Z)};R(ee,Y=>{e(d).has_color&&e(d).color&&Y(ae)},!0)}f(Q,U)};R(se,Q=>{e(d).has_multizone&&e(d).zone_colors&&e(d).zone_colors.length>0?Q(te):Q(W,!1)},!0)}f(L,V)};R(fe,L=>{e(d).has_matrix&&e(d).tile_devices&&e(d).tile_devices.length>0?L(me):L(F,!1)})}r(ie),r(X),O(L=>{C=ye(X,1,`viz-device span-${e(N)??""}`,"svelte-t60k18",C,{"power-off":e(d).power_level===0}),z(G,e(d).label),z(pe,e(d).serial),z(ne,L),K=ye(B,1,"viz-power svelte-t60k18",null,K,{on:e(d).power_level>0}),z(oe,e(d).power_level>0?"ON":"OFF")},[()=>m(e(d))]),f(p,X)}),r(E),f(b,E)};R(x,b=>{e(v).length===0?b(_):b(g,!1)})}r(k),f(t,k),Me()}Ve(["click"]);var ms=y('<span class="tab-count svelte-1uha8ag"> </span>'),gs=y('<span class="tab-count svelte-1uha8ag"> </span>'),ws=y("<button> <!></button>"),ys=y("<!> <!>",1),xs=y('<div class="container"><!> <!> <div class="tabs svelte-1uha8ag"></div> <div class="tab-content svelte-1uha8ag"><!></div></div>');function Cs(t,a){De(a,!1);const l=[{id:"visualizer",label:"Visualizer"},{id:"devices",label:"Devices"},{id:"activity",label:"Activity"},{id:"scenarios",label:"Scenarios"}];Xt(()=>{et.connect()}),Kt(()=>{et.disconnect()}),kt();var s=xs(),o=i(s);Ha(o,{});var v=n(o,2);{var c=_=>{ja(_,{})};R(v,_=>{A.showStats&&_(c)})}var w=n(v,2);be(w,5,()=>l,ze,(_,g)=>{var b=ws();let E;b.__click=()=>A.setActiveTab(e(g).id);var p=i(b),d=n(p);{var M=X=>{var C=ms(),T=i(C,!0);r(C),O(()=>z(T,j.count)),f(X,C)},N=X=>{var C=Se(),T=de(C);{var D=q=>{var G=gs(),H=i(G,!0);r(G),O(()=>z(H,ot.count)),f(q,G)};R(T,q=>{e(g).id==="activity"&&q(D)},!0)}f(X,C)};R(d,X=>{e(g).id==="visualizer"||e(g).id==="devices"?X(M):X(N,!1)})}r(b),O(()=>{E=ye(b,1,"tab svelte-1uha8ag",null,E,{active:A.activeTab===e(g).id}),z(p,`${e(g).label??""} `)}),f(_,b)}),r(w);var m=n(w,2),S=i(m);{var k=_=>{bs(_,{})},x=_=>{var g=Se(),b=de(g);{var E=d=>{var M=ys(),N=de(M);rr(N,{});var X=n(N,2);{var C=D=>{Rr(D,{})},T=D=>{Er(D,{})};R(X,D=>{A.viewMode==="table"?D(C):D(T,!1)})}f(d,M)},p=d=>{var M=Se(),N=de(M);{var X=T=>{qr(T,{})},C=T=>{var D=Se(),q=de(D);{var G=H=>{rs(H,{})};R(q,H=>{A.activeTab==="scenarios"&&H(G)},!0)}f(T,D)};R(N,T=>{A.activeTab==="activity"?T(X):T(C,!1)},!0)}f(d,M)};R(b,d=>{A.activeTab==="devices"?d(E):d(p,!1)},!0)}f(_,g)};R(S,_=>{A.activeTab==="visualizer"?_(k):_(x,!1)})}r(m),r(s),f(t,s),Me()}Ve(["click"]);export{Cs as component};
