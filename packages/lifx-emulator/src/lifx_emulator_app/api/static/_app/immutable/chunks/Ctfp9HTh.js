import{au as c,av as d,aw as a,w as t,ax as b}from"./DfIkQq0Y.js";const m={uptime_seconds:0,start_time:0,device_count:0,packets_received:0,packets_sent:0,packets_received_by_type:{},packets_sent_by_type:{},error_count:0,activity_enabled:!1};function z(){let e=c(d({...m}));return{get value(){return t(e)},set(r){a(e,r,!0)},reset(){a(e,{...m},!0)}}}const Y=z();function M(){let e=c(d(new Map)),r=c(d(new Map)),s=new Map,o=!1;function l(){if(s.size===0){o=!1;return}const i=new Map(t(e)),n=new Map(t(r));for(const[u,g]of s)i.set(u,g.device),g.transition?n.set(u,g.transition):n.delete(u);a(e,i,!0),a(r,n,!0),s.clear(),o=!1}function f(i,n,u){s.set(i,{device:n,transition:u}),o||(o=!0,requestAnimationFrame(l))}return{get map(){return t(e)},get list(){return[...t(e).values()]},get count(){return t(e).size},get(i){return t(e).get(i)},getTransition(i){return t(r).get(i)},set(i){const n=new Map;for(const u of i)n.set(u.serial,u);a(e,n,!0)},add(i){a(e,new Map(t(e)),!0),t(e).set(i.serial,i)},remove(i){a(e,new Map(t(e)),!0),t(e).delete(i),a(r,new Map(t(r)),!0),t(r).delete(i)},update(i,n){const u=t(e).get(i);u&&(a(e,new Map(t(e)),!0),t(e).set(i,{...u,...n}))},updateWithTransition(i,n){const g=s.get(i)?.device??t(e).get(i);if(!g)return;const p={...g};n.color&&(p.color=n.color),n.power_level!==void 0&&(p.power_level=n.power_level),n.zone_colors!==void 0&&(p.zone_colors=n.zone_colors),n.tile_devices!==void 0&&(p.tile_devices=n.tile_devices);let S;n.duration_ms!==void 0&&n.duration_ms>0&&(S={serial:i,duration_ms:n.duration_ms,timestamp:Date.now()}),f(i,p,S)},clear(){a(e,new Map,!0),a(r,new Map,!0)}}}const U=M();function T(){let e=c(d([]));return{get list(){return t(e)},get count(){return t(e).length},set(r){a(e,r.slice(-100),!0)},add(r){a(e,[...t(e),r].slice(-100),!0)},clear(){a(e,[],!0)},get reversed(){return[...t(e)].reverse()}}}const L=T();function x(){let e=c(d({global:null,devices:{},types:{},locations:{},groups:{}}));return{get global(){return t(e).global},get devices(){return t(e).devices},get types(){return t(e).types},get locations(){return t(e).locations},get groups(){return t(e).groups},setGlobal(r){t(e).global=r},setDevice(r,s){if(s===null){const{[r]:o,...l}=t(e).devices;t(e).devices=l}else t(e).devices={...t(e).devices,[r]:s}},setType(r,s){if(s===null){const{[r]:o,...l}=t(e).types;t(e).types=l}else t(e).types={...t(e).types,[r]:s}},setLocation(r,s){if(s===null){const{[r]:o,...l}=t(e).locations;t(e).locations=l}else t(e).locations={...t(e).locations,[r]:s}},setGroup(r,s){if(s===null){const{[r]:o,...l}=t(e).groups;t(e).groups=l}else t(e).groups={...t(e).groups,[r]:s}},setAll(r){a(e,{global:r.global??null,devices:r.devices??{},types:r.types??{},locations:r.locations??{},groups:r.groups??{}},!0)},handleChange(r){switch(r.scope){case"global":t(e).global=r.config;break;case"device":if(r.identifier)if(r.config===null){const{[r.identifier]:s,...o}=t(e).devices;t(e).devices=o}else t(e).devices={...t(e).devices,[r.identifier]:r.config};break;case"type":if(r.identifier)if(r.config===null){const{[r.identifier]:s,...o}=t(e).types;t(e).types=o}else t(e).types={...t(e).types,[r.identifier]:r.config};break;case"location":if(r.identifier)if(r.config===null){const{[r.identifier]:s,...o}=t(e).locations;t(e).locations=o}else t(e).locations={...t(e).locations,[r.identifier]:r.config};break;case"group":if(r.identifier)if(r.config===null){const{[r.identifier]:s,...o}=t(e).groups;t(e).groups=o}else t(e).groups={...t(e).groups,[r.identifier]:r.config};break}}}}const N=x(),v="lifx-emulator-view",_="lifx-emulator-page-size",w="lifx-emulator-expanded",y="lifx-emulator-tab",h="lifx-emulator-show-stats";function A(){return typeof localStorage>"u"?"card":localStorage.getItem(v)==="table"?"table":"card"}function k(){if(typeof localStorage>"u")return 20;const e=localStorage.getItem(_),r=e?parseInt(e,10):20;return[10,20,50,100].includes(r)?r:20}function I(){if(typeof localStorage>"u")return{zones:new Set,metadata:new Set};try{const e=localStorage.getItem(w);if(!e)return{zones:new Set,metadata:new Set};const r=JSON.parse(e);return{zones:new Set(r.zones||[]),metadata:new Set(r.metadata||[])}}catch{return{zones:new Set,metadata:new Set}}}function D(){if(typeof localStorage>"u")return"visualizer";const e=localStorage.getItem(y);return e==="visualizer"||e==="devices"||e==="activity"||e==="scenarios"?e:"visualizer"}function G(){return typeof localStorage>"u"?!1:localStorage.getItem(h)==="true"}function O(){let e=c(d(A())),r=c(d(k())),s=c(1),o=c(d(I())),l=c(d(D())),f=c(d(G()));function i(){typeof localStorage<"u"&&localStorage.setItem(w,JSON.stringify({zones:[...t(o).zones],metadata:[...t(o).metadata]}))}return{get viewMode(){return t(e)},get pageSize(){return t(r)},get currentPage(){return t(s)},get expanded(){return t(o)},get activeTab(){return t(l)},get showStats(){return t(f)},setViewMode(n){a(e,n,!0),typeof localStorage<"u"&&localStorage.setItem(v,n)},setPageSize(n){a(r,n,!0),a(s,1),typeof localStorage<"u"&&localStorage.setItem(_,String(n))},setCurrentPage(n){a(s,n,!0)},setActiveTab(n){a(l,n,!0),typeof localStorage<"u"&&localStorage.setItem(y,n)},toggleShowStats(){a(f,!t(f)),typeof localStorage<"u"&&localStorage.setItem(h,String(t(f)))},toggleZonesExpanded(n){t(o).zones.has(n)?t(o).zones.delete(n):t(o).zones.add(n),a(o,{...t(o)},!0),i()},toggleMetadataExpanded(n){t(o).metadata.has(n)?t(o).metadata.delete(n):t(o).metadata.add(n),a(o,{...t(o)},!0),i()},isZonesExpanded(n){return t(o).zones.has(n)},isMetadataExpanded(n){return t(o).metadata.has(n)}}}const V=O(),E="lifx-emulator-theme";function P(){if(typeof localStorage>"u")return"system";const e=localStorage.getItem(E);return e==="light"||e==="dark"||e==="system"?e:"system"}function K(){let e=c(d(P())),r=c(d(typeof window<"u"?window.matchMedia("(prefers-color-scheme: dark)").matches:!0));const s=b(()=>t(e)==="system"?t(r)?"dark":"light":t(e));function o(){typeof document<"u"&&document.documentElement.setAttribute("data-theme",t(s))}return typeof window<"u"&&window.matchMedia("(prefers-color-scheme: dark)").addEventListener("change",l=>{a(r,l.matches,!0)}),{get mode(){return t(e)},get effective(){return t(s)},applyTheme:o,set(l){a(e,l,!0),typeof localStorage<"u"&&localStorage.setItem(E,l),o()},toggle(){const l=t(e)==="light"?"dark":t(e)==="dark"?"system":"light";this.set(l)}}}const W=K();export{L as a,Y as b,U as d,N as s,W as t,V as u};
