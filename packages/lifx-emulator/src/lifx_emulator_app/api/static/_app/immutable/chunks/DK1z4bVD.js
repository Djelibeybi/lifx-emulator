import{au as a,av as c,aw as i,w as t,ax as w}from"./DfIkQq0Y.js";const f={uptime_seconds:0,start_time:0,device_count:0,packets_received:0,packets_sent:0,packets_received_by_type:{},packets_sent_by_type:{},error_count:0,activity_enabled:!1};function y(){let e=a(c({...f}));return{get value(){return t(e)},set(o){i(e,o,!0)},reset(){i(e,{...f},!0)}}}const D=y();function E(){let e=a(c(new Map)),o=a(c(new Map));return{get map(){return t(e)},get list(){return[...t(e).values()]},get count(){return t(e).size},get(n){return t(e).get(n)},getTransition(n){return t(o).get(n)},set(n){const r=new Map;for(const s of n)r.set(s.serial,s);i(e,r,!0)},add(n){i(e,new Map(t(e)),!0),t(e).set(n.serial,n)},remove(n){i(e,new Map(t(e)),!0),t(e).delete(n),i(o,new Map(t(o)),!0),t(o).delete(n)},update(n,r){const s=t(e).get(n);s&&(i(e,new Map(t(e)),!0),t(e).set(n,{...s,...r}))},updateWithTransition(n,r){const s=t(e).get(n);if(!s){console.warn("updateWithTransition: device not found:",n);return}console.log("updateWithTransition:",n,r);const u={...s};r.color&&(u.color=r.color,console.log("Updated color:",r.color)),r.power_level!==void 0&&(u.power_level=r.power_level,console.log("Updated power_level:",r.power_level)),r.zone_colors&&(u.zone_colors=r.zone_colors,console.log("Updated zone_colors:",r.zone_colors.length,"zones")),r.tile_devices&&(u.tile_devices=r.tile_devices,console.log("Updated tile_devices:",r.tile_devices.length,"tiles")),i(e,new Map(t(e)),!0),t(e).set(n,u),r.duration_ms!==void 0&&r.duration_ms>0&&(i(o,new Map(t(o)),!0),t(o).set(n,{serial:n,duration_ms:r.duration_ms,timestamp:Date.now()}),console.log("Set transition:",r.duration_ms,"ms"))},clear(){i(e,new Map,!0),i(o,new Map,!0)}}}const P=E();function b(){let e=a(c([]));return{get list(){return t(e)},get count(){return t(e).length},set(o){i(e,o.slice(-100),!0)},add(o){i(e,[...t(e),o].slice(-100),!0)},clear(){i(e,[],!0)},get reversed(){return[...t(e)].reverse()}}}const K=b();function z(){let e=a(c({global:null,devices:{},types:{},locations:{},groups:{}}));return{get global(){return t(e).global},get devices(){return t(e).devices},get types(){return t(e).types},get locations(){return t(e).locations},get groups(){return t(e).groups},setGlobal(o){t(e).global=o},setDevice(o,n){if(n===null){const{[o]:r,...s}=t(e).devices;t(e).devices=s}else t(e).devices={...t(e).devices,[o]:n}},setType(o,n){if(n===null){const{[o]:r,...s}=t(e).types;t(e).types=s}else t(e).types={...t(e).types,[o]:n}},setLocation(o,n){if(n===null){const{[o]:r,...s}=t(e).locations;t(e).locations=s}else t(e).locations={...t(e).locations,[o]:n}},setGroup(o,n){if(n===null){const{[o]:r,...s}=t(e).groups;t(e).groups=s}else t(e).groups={...t(e).groups,[o]:n}},setAll(o){i(e,{global:o.global??null,devices:o.devices??{},types:o.types??{},locations:o.locations??{},groups:o.groups??{}},!0)},handleChange(o){switch(o.scope){case"global":t(e).global=o.config;break;case"device":if(o.identifier)if(o.config===null){const{[o.identifier]:n,...r}=t(e).devices;t(e).devices=r}else t(e).devices={...t(e).devices,[o.identifier]:o.config};break;case"type":if(o.identifier)if(o.config===null){const{[o.identifier]:n,...r}=t(e).types;t(e).types=r}else t(e).types={...t(e).types,[o.identifier]:o.config};break;case"location":if(o.identifier)if(o.config===null){const{[o.identifier]:n,...r}=t(e).locations;t(e).locations=r}else t(e).locations={...t(e).locations,[o.identifier]:o.config};break;case"group":if(o.identifier)if(o.config===null){const{[o.identifier]:n,...r}=t(e).groups;t(e).groups=r}else t(e).groups={...t(e).groups,[o.identifier]:o.config};break}}}}const R=z(),g="lifx-emulator-view",p="lifx-emulator-page-size",S="lifx-emulator-expanded",m="lifx-emulator-tab",v="lifx-emulator-show-stats";function T(){return typeof localStorage>"u"?"card":localStorage.getItem(g)==="table"?"table":"card"}function h(){if(typeof localStorage>"u")return 20;const e=localStorage.getItem(p),o=e?parseInt(e,10):20;return[10,20,50,100].includes(o)?o:20}function x(){if(typeof localStorage>"u")return{zones:new Set,metadata:new Set};try{const e=localStorage.getItem(S);if(!e)return{zones:new Set,metadata:new Set};const o=JSON.parse(e);return{zones:new Set(o.zones||[]),metadata:new Set(o.metadata||[])}}catch{return{zones:new Set,metadata:new Set}}}function M(){if(typeof localStorage>"u")return"visualizer";const e=localStorage.getItem(m);return e==="visualizer"||e==="devices"||e==="activity"||e==="scenarios"?e:"visualizer"}function k(){return typeof localStorage>"u"?!1:localStorage.getItem(v)==="true"}function A(){let e=a(c(T())),o=a(c(h())),n=a(1),r=a(c(x())),s=a(c(M())),u=a(c(k()));function d(){typeof localStorage<"u"&&localStorage.setItem(S,JSON.stringify({zones:[...t(r).zones],metadata:[...t(r).metadata]}))}return{get viewMode(){return t(e)},get pageSize(){return t(o)},get currentPage(){return t(n)},get expanded(){return t(r)},get activeTab(){return t(s)},get showStats(){return t(u)},setViewMode(l){i(e,l,!0),typeof localStorage<"u"&&localStorage.setItem(g,l)},setPageSize(l){i(o,l,!0),i(n,1),typeof localStorage<"u"&&localStorage.setItem(p,String(l))},setCurrentPage(l){i(n,l,!0)},setActiveTab(l){i(s,l,!0),typeof localStorage<"u"&&localStorage.setItem(m,l)},toggleShowStats(){i(u,!t(u)),typeof localStorage<"u"&&localStorage.setItem(v,String(t(u)))},toggleZonesExpanded(l){t(r).zones.has(l)?t(r).zones.delete(l):t(r).zones.add(l),i(r,{...t(r)},!0),d()},toggleMetadataExpanded(l){t(r).metadata.has(l)?t(r).metadata.delete(l):t(r).metadata.add(l),i(r,{...t(r)},!0),d()},isZonesExpanded(l){return t(r).zones.has(l)},isMetadataExpanded(l){return t(r).metadata.has(l)}}}const U=A(),_="lifx-emulator-theme";function I(){if(typeof localStorage>"u")return"system";const e=localStorage.getItem(_);return e==="light"||e==="dark"||e==="system"?e:"system"}function G(){let e=a(c(I())),o=a(c(typeof window<"u"?window.matchMedia("(prefers-color-scheme: dark)").matches:!0));const n=w(()=>t(e)==="system"?t(o)?"dark":"light":t(e));function r(){typeof document<"u"&&document.documentElement.setAttribute("data-theme",t(n))}return typeof window<"u"&&window.matchMedia("(prefers-color-scheme: dark)").addEventListener("change",s=>{i(o,s.matches,!0)}),{get mode(){return t(e)},get effective(){return t(n)},applyTheme:r,set(s){i(e,s,!0),typeof localStorage<"u"&&localStorage.setItem(_,s),r()},toggle(){const s=t(e)==="light"?"dark":t(e)==="dark"?"system":"light";this.set(s)}}}const Y=G();export{K as a,D as b,P as d,R as s,Y as t,U as u};
