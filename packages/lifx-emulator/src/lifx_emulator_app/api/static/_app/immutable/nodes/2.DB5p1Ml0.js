import{a as h,f as k,c as Le}from"../chunks/Binc8JbE.js";import{i as kt}from"../chunks/BORyfda6.js";import{o as Xt,a as Kt}from"../chunks/yhjkpkcN.js";import{i as _t,b as Qt,h as we,c as pt,L as $t,a as ea,w as a,r as ta,H as aa,s as At,d as bt,k as ct,S as ra,as as sa,ab as Pt,e as Me,aN as Ne,j as yt,l as ia,aH as na,aO as Rt,aq as St,aP as la,aQ as oa,aL as ca,Y as Tt,aR as va,f as Ot,p as Bt,aS as mt,aT as da,ap as ua,g as fa,U as _a,aU as Ht,_ as Vt,aV as pa,aj as ba,aW as ma,aX as ha,aY as Et,V as ga,aZ as Ut,a_ as wa,a$ as ya,b0 as xa,b1 as ka,b2 as Sa,aM as Ea,q as Wt,X as jt,aw as f,au as J,B as Re,C as de,D as B,F as Oe,G as i,J as l,I as s,ac as vt,av as lt,ax as De,o as dt}from"../chunks/DfIkQq0Y.js";import{d as qe,s as F,e as Fa}from"../chunks/BaoxLdOF.js";import{i as R}from"../chunks/BTLkiQR5.js";import{s as Ye,a as ot,d as V,b as je,u as I,t as ht}from"../chunks/CDSQEL5N.js";function Ie(e,t){return t}function Ia(e,t,n){for(var r=[],o=t.length,c,v=t.length,b=0;b<o;b++){let m=t[b];Bt(m,()=>{if(c){if(c.pending.delete(m),c.done.add(m),c.pending.size===0){var u=e.outrogroups;xt(St(c.done)),u.delete(c),u.size===0&&(e.outrogroups=null)}}else v-=1},!1)}if(v===0){var _=r.length===0&&n!==null;if(_){var w=n,g=w.parentNode;ua(g),g.append(w),e.items.clear()}xt(t,!_)}else c={pending:new Set(t),done:new Set},(e.outrogroups??=new Set).add(c)}function xt(e,t=!0){for(var n=0;n<e.length;n++)fa(e[n],t)}var zt;function ye(e,t,n,r,o,c=null){var v=e,b=new Map,_=(t&Ht)!==0;if(_){var w=e;v=we?pt($t(w)):w.appendChild(_t())}we&&ea();var g=null,m=na(()=>{var x=n();return Rt(x)?x:x==null?[]:St(x)}),u,y=!0;function P(){p.fallback=g,La(p,u,v,t,r),g!==null&&(u.length===0?(g.f&Ne)===0?Ot(g):(g.f^=Ne,st(g,null,v)):Bt(g,()=>{g=null}))}var X=Qt(()=>{u=a(m);var x=u.length;let C=!1;if(we){var T=ta(v)===aa;T!==(x===0)&&(v=At(),pt(v),bt(!1),C=!0)}for(var M=new Set,L=Me,z=ia(),O=0;O<x;O+=1){we&&ct.nodeType===ra&&ct.data===sa&&(v=ct,C=!0,bt(!1));var W=u[O],j=r(W,O),H=y?null:b.get(j);H?(H.v&&Pt(H.v,W),H.i&&Pt(H.i,O),z&&L.skipped_effects.delete(H.e)):(H=Ca(b,y?v:zt??=_t(),W,j,O,o,t,n),y||(H.e.f|=Ne),b.set(j,H)),M.add(j)}if(x===0&&c&&!g&&(y?g=yt(()=>c(v)):(g=yt(()=>c(zt??=_t())),g.f|=Ne)),we&&x>0&&pt(At()),!y)if(z){for(const[ue,ee]of b)M.has(ue)||L.skipped_effects.add(ee.e);L.oncommit(P),L.ondiscard(()=>{})}else P();C&&bt(!0),a(m)}),p={effect:X,items:b,outrogroups:null,fallback:g};y=!1,we&&(v=ct)}function rt(e){for(;e!==null&&(e.f&da)===0;)e=e.next;return e}function La(e,t,n,r,o){var c=(r&pa)!==0,v=t.length,b=e.items,_=rt(e.effect.first),w,g=null,m,u=[],y=[],P,X,p,x;if(c)for(x=0;x<v;x+=1)P=t[x],X=o(P,x),p=b.get(X).e,(p.f&Ne)===0&&(p.nodes?.a?.measure(),(m??=new Set).add(p));for(x=0;x<v;x+=1){if(P=t[x],X=o(P,x),p=b.get(X).e,e.outrogroups!==null)for(const H of e.outrogroups)H.pending.delete(p),H.done.delete(p);if((p.f&Ne)!==0)if(p.f^=Ne,p===_)st(p,null,n);else{var C=g?g.next:_;p===e.effect.last&&(e.effect.last=p.prev),p.prev&&(p.prev.next=p.next),p.next&&(p.next.prev=p.prev),We(e,g,p),We(e,p,C),st(p,C,n),g=p,u=[],y=[],_=rt(g.next);continue}if((p.f&mt)!==0&&(Ot(p),c&&(p.nodes?.a?.unfix(),(m??=new Set).delete(p))),p!==_){if(w!==void 0&&w.has(p)){if(u.length<y.length){var T=y[0],M;g=T.prev;var L=u[0],z=u[u.length-1];for(M=0;M<u.length;M+=1)st(u[M],T,n);for(M=0;M<y.length;M+=1)w.delete(y[M]);We(e,L.prev,z.next),We(e,g,L),We(e,z,T),_=T,g=z,x-=1,u=[],y=[]}else w.delete(p),st(p,_,n),We(e,p.prev,p.next),We(e,p,g===null?e.effect.first:g.next),We(e,g,p),g=p;continue}for(u=[],y=[];_!==null&&_!==p;)(w??=new Set).add(_),y.push(_),_=rt(_.next);if(_===null)continue}(p.f&Ne)===0&&u.push(p),g=p,_=rt(p.next)}if(e.outrogroups!==null){for(const H of e.outrogroups)H.pending.size===0&&(xt(St(H.done)),e.outrogroups?.delete(H));e.outrogroups.size===0&&(e.outrogroups=null)}if(_!==null||w!==void 0){var O=[];if(w!==void 0)for(p of w)(p.f&mt)===0&&O.push(p);for(;_!==null;)(_.f&mt)===0&&_!==e.fallback&&O.push(_),_=rt(_.next);var W=O.length;if(W>0){var j=(r&Ht)!==0&&v===0?n:null;if(c){for(x=0;x<W;x+=1)O[x].nodes?.a?.measure();for(x=0;x<W;x+=1)O[x].nodes?.a?.fix()}Ia(e,O,j)}}c&&Vt(()=>{if(m!==void 0)for(p of m)p.nodes?.a?.apply()})}function Ca(e,t,n,r,o,c,v,b){var _=(v&la)!==0?(v&oa)===0?ca(n,!1,!1):Tt(n):null,w=(v&va)!==0?Tt(o):null;return{v:_,i:w,e:yt(()=>(c(t,_??n,w??o,b),()=>{e.delete(r)}))}}function st(e,t,n){if(e.nodes)for(var r=e.nodes.start,o=e.nodes.end,c=t&&(t.f&Ne)===0?t.nodes.start:n;r!==null;){var v=_a(r);if(c.before(r),r===o)return;r=v}}function We(e,t,n){t===null?e.effect.first=n:t.next=n,n===null?e.effect.last=t:n.prev=t}function qt(e){var t,n,r="";if(typeof e=="string"||typeof e=="number")r+=e;else if(typeof e=="object")if(Array.isArray(e)){var o=e.length;for(t=0;t<o;t++)e[t]&&(n=qt(e[t]))&&(r&&(r+=" "),r+=n)}else for(n in e)e[n]&&(r&&(r+=" "),r+=n);return r}function Aa(){for(var e,t,n=0,r="",o=arguments.length;n<o;n++)(e=arguments[n])&&(t=qt(e))&&(r&&(r+=" "),r+=t);return r}function Pa(e){return typeof e=="object"?Aa(e):e??""}const Mt=[...`
\r\f \v\uFEFF`];function Ta(e,t,n){var r=e==null?"":""+e;if(t&&(r=r?r+" "+t:t),n){for(var o in n)if(n[o])r=r?r+" "+o:o;else if(r.length)for(var c=o.length,v=0;(v=r.indexOf(o,v))>=0;){var b=v+c;(v===0||Mt.includes(r[v-1]))&&(b===r.length||Mt.includes(r[b]))?r=(v===0?"":r.substring(0,v))+r.substring(b+1):v=b}}return r===""?null:r}function za(e,t){return e==null?null:String(e)}function Xe(e,t,n,r,o,c){var v=e.__className;if(we||v!==n||v===void 0){var b=Ta(n,r,c);(!we||b!==e.getAttribute("class"))&&(b==null?e.removeAttribute("class"):e.className=b),e.__className=n}else if(c&&o!==c)for(var _ in c){var w=!!c[_];(o==null||w!==!!o[_])&&e.classList.toggle(_,w)}return c}function Ke(e,t,n,r){var o=e.__style;if(we||o!==t){var c=za(t);(!we||c!==e.getAttribute("style"))&&(c==null?e.removeAttribute("style"):e.style.cssText=c),e.__style=t}return r}function Ft(e,t,n=!1){if(e.multiple){if(t==null)return;if(!Rt(t))return ma();for(var r of e.options)r.selected=t.includes(it(r));return}for(r of e.options){var o=it(r);if(ha(o,t)){r.selected=!0;return}}(!n||t!==void 0)&&(e.selectedIndex=-1)}function Gt(e){var t=new MutationObserver(()=>{Ft(e,e.__value)});t.observe(e,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["value"]}),ba(()=>{t.disconnect()})}function It(e,t,n=t){var r=new WeakSet,o=!0;Et(e,"change",c=>{var v=c?"[selected]":":checked",b;if(e.multiple)b=[].map.call(e.querySelectorAll(v),it);else{var _=e.querySelector(v)??e.querySelector("option:not([disabled])");b=_&&it(_)}n(b),Me!==null&&r.add(Me)}),ga(()=>{var c=t();if(e===document.activeElement){var v=Ut??Me;if(r.has(v))return}if(Ft(e,c,o),o&&c===void 0){var b=e.querySelector(":checked");b!==null&&(c=it(b),n(c))}e.__value=c,o=!1}),Gt(e)}function it(e){return"__value"in e?e.__value:e.value}const Ma=Symbol("is custom element"),Na=Symbol("is html");function Se(e){if(we){var t=!1,n=()=>{if(!t){if(t=!0,e.hasAttribute("value")){var r=e.value;$e(e,"value",null),e.value=r}if(e.hasAttribute("checked")){var o=e.checked;$e(e,"checked",null),e.checked=o}}};e.__on_r=n,Vt(n),ka()}}function $e(e,t,n,r){var o=Da(e);we&&(o[t]=e.getAttribute(t),t==="src"||t==="srcset"||t==="href"&&e.nodeName==="LINK")||o[t]!==(o[t]=n)&&(t==="loading"&&(e[Sa]=n),n==null?e.removeAttribute(t):typeof n!="string"&&Xa(e).includes(t)?e[t]=n:e.setAttribute(t,n))}function Da(e){return e.__attributes??={[Ma]:e.nodeName.includes("-"),[Na]:e.namespaceURI===wa}}var Nt=new Map;function Xa(e){var t=e.getAttribute("is")||e.nodeName,n=Nt.get(t);if(n)return n;Nt.set(t,n=[]);for(var r,o=e,c=Element.prototype;c!==o;){r=xa(o);for(var v in r)r[v].set&&n.push(v);o=ya(o)}return n}function Fe(e,t,n=t){var r=new WeakSet;Et(e,"input",async o=>{var c=o?e.defaultValue:e.value;if(c=gt(e)?wt(c):c,n(c),Me!==null&&r.add(Me),await Ea(),c!==(c=t())){var v=e.selectionStart,b=e.selectionEnd,_=e.value.length;if(e.value=c??"",b!==null){var w=e.value.length;v===b&&b===_&&w>_?(e.selectionStart=w,e.selectionEnd=w):(e.selectionStart=v,e.selectionEnd=Math.min(b,w))}}}),(we&&e.defaultValue!==e.value||Wt(t)==null&&e.value)&&(n(gt(e)?wt(e.value):e.value),Me!==null&&r.add(Me)),jt(()=>{var o=t();if(e===document.activeElement){var c=Ut??Me;if(r.has(c))return}gt(e)&&o===wt(e.value)||e.type==="date"&&!o&&!e.value||o!==e.value&&(e.value=o??"")})}function Ra(e,t,n=t){Et(e,"change",r=>{var o=r?e.defaultChecked:e.checked;n(o)}),(we&&e.defaultChecked!==e.checked||Wt(t)==null)&&n(e.checked),jt(()=>{var r=t();e.checked=!!r})}function gt(e){var t=e.type;return t==="number"||t==="range"}function wt(e){return e===""?null:+e}const Dt=2e3,Oa=3e4;function Ba(){let e=J("disconnected"),t=null,n=Dt,r=null;function o(){return`${window.location.protocol==="https:"?"wss:":"ws:"}//${window.location.host}/ws`}function c(g){try{const m=JSON.parse(g.data);switch(m.type){case"sync":{const u=m.data;u.stats&&je.set(u.stats),u.devices&&V.set(u.devices),u.activity&&ot.set(u.activity),u.scenarios&&Ye.setAll(u.scenarios);break}case"stats":je.set(m.data);break;case"device_added":V.add(m.data);break;case"device_removed":{const{serial:u}=m.data;V.remove(u);break}case"device_updated":{const{serial:u,changes:y}=m.data;V.update(u,y);break}case"activity":ot.add(m.data);break;case"scenario_changed":Ye.handleChange(m.data);break;case"error":console.error("WebSocket error:",m.message);break}}catch(m){console.error("Failed to parse WebSocket message:",m)}}function v(){if(!(t&&(t.readyState===WebSocket.CONNECTING||t.readyState===WebSocket.OPEN))){f(e,"connecting");try{t=new WebSocket(o()),t.onopen=()=>{f(e,"connected"),n=Dt,t.send(JSON.stringify({type:"subscribe",topics:["stats","devices","activity","scenarios"]})),t.send(JSON.stringify({type:"sync"}))},t.onmessage=c,t.onclose=()=>{f(e,"disconnected"),t=null,b()},t.onerror=()=>{f(e,"error"),t?.close()}}catch(g){console.error("WebSocket connection error:",g),f(e,"error"),b()}}}function b(){r&&clearTimeout(r),r=setTimeout(()=>{r=null,v()},n),n=Math.min(n*1.5,Oa)}function _(){r&&(clearTimeout(r),r=null),t&&(t.close(),t=null),f(e,"disconnected")}function w(g){t&&t.readyState===WebSocket.OPEN&&t.send(JSON.stringify(g))}return{get status(){return a(e)},connect:v,disconnect:_,send:w,sync(){w({type:"sync"})}}}const Qe=Ba();var Ha=k('<header class="header"><div class="header-title"><h1>LIFX Emulator Monitor</h1> <span></span></div> <div class="header-controls svelte-1elxaub"><button><svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor"><rect x="1" y="9" width="3" height="6" rx="0.5"></rect><rect x="6" y="5" width="3" height="10" rx="0.5"></rect><rect x="11" y="1" width="3" height="14" rx="0.5"></rect></svg></button> <button class="control-btn svelte-1elxaub"> </button></div></header> <p class="subtitle">Real-time monitoring and device management</p>',1);function Va(e,t){Re(t,!1);const n={light:"☀",dark:"☾",system:"◐"};kt();var r=Ha(),o=de(r),c=i(o),v=l(i(c),2);let b;s(c);var _=l(c,2),w=i(_);let g;w.__click=()=>I.toggleShowStats();var m=l(w,2);m.__click=()=>ht.toggle();var u=i(m,!0);s(m),s(_),s(o),vt(2),B(()=>{b=Xe(v,1,"status-indicator",null,b,{connecting:Qe.status==="connecting",disconnected:Qe.status==="disconnected",error:Qe.status==="error"}),$e(v,"title",Qe.status),g=Xe(w,1,"control-btn svelte-1elxaub",null,g,{active:I.showStats}),$e(w,"title",I.showStats?"Hide statistics":"Show statistics"),$e(m,"title",`Toggle theme (${ht.mode??""})`),F(u,n[ht.mode])}),h(e,r),Oe()}qe(["click"]);function nt(e){const t=e.hue/65535,n=e.saturation/65535,r=e.brightness/65535;let o,c,v;const b=Math.floor(t*6),_=t*6-b,w=r*(1-n),g=r*(1-_*n),m=r*(1-(1-_)*n);switch(b%6){case 0:o=r,c=m,v=w;break;case 1:o=g,c=r,v=w;break;case 2:o=w,c=r,v=m;break;case 3:o=w,c=g,v=r;break;case 4:o=m,c=w,v=r;break;default:o=r,c=w,v=g;break}const u=Math.round(o*255),y=Math.round(c*255),P=Math.round(v*255);return`rgb(${u}, ${y}, ${P})`}function Ua(e){const t=Math.floor(e);if(t<60)return`${t}s`;if(t<3600)return`${Math.floor(t/60)}m ${t%60}s`;const n=Math.floor(t/3600),r=Math.floor(t%3600/60);return`${n}h ${r}m`}var Wa=k('<div class="card"><h2><span class="status-indicator"></span> Server Statistics</h2> <div class="stats-list"><div class="stat"><span class="stat-label">Uptime</span> <span class="stat-value"> </span></div> <div class="stat"><span class="stat-label">Devices</span> <span class="stat-value"> </span></div> <div class="stat"><span class="stat-label">Packets RX</span> <span class="stat-value"> </span></div> <div class="stat"><span class="stat-label">Packets TX</span> <span class="stat-value"> </span></div> <div class="stat"><span class="stat-label">Errors</span> <span class="stat-value"> </span></div></div></div>');function ja(e,t){Re(t,!1),kt();var n=Wa(),r=l(i(n),2),o=i(r),c=l(i(o),2),v=i(c,!0);s(c),s(o);var b=l(o,2),_=l(i(b),2),w=i(_,!0);s(_),s(b);var g=l(b,2),m=l(i(g),2),u=i(m,!0);s(m),s(g);var y=l(g,2),P=l(i(y),2),X=i(P,!0);s(P),s(y);var p=l(y,2),x=l(i(p),2),C=i(x,!0);s(x),s(p),s(r),s(n),B(T=>{F(v,T),F(w,je.value.device_count),F(u,je.value.packets_received),F(X,je.value.packets_sent),F(C,je.value.error_count)},[()=>Ua(je.value.uptime_seconds)]),h(e,n),Oe()}const Ge="/api";async function qa(){const e=await fetch(`${Ge}/products`);if(!e.ok)throw new Error(`Failed to fetch products: ${e.status}`);return e.json()}async function Ga(e){const t=await fetch(`${Ge}/devices`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({product_id:e})});if(!t.ok){const n=await t.json();throw new Error(n.detail||`Failed to create device: ${t.status}`)}}async function Jt(e){const t=await fetch(`${Ge}/devices/${e}`,{method:"DELETE"});if(!t.ok)throw new Error(`Failed to delete device: ${t.status}`)}async function Lt(){const e=await fetch(`${Ge}/devices`,{method:"DELETE"});if(!e.ok)throw new Error(`Failed to remove devices: ${e.status}`);return e.json()}async function Ja(e){const t=await fetch(`${Ge}/scenarios/global`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!t.ok){const n=await t.json();throw new Error(n.detail||`Failed to set global scenario: ${t.status}`)}}async function Ya(){const e=await fetch(`${Ge}/scenarios/global`,{method:"DELETE"});if(!e.ok)throw new Error(`Failed to clear global scenario: ${e.status}`)}async function Za(e,t,n){const r=await fetch(`${Ge}/scenarios/${e}/${encodeURIComponent(t)}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)});if(!r.ok){const o=await r.json();throw new Error(o.detail||`Failed to set ${e} scenario: ${r.status}`)}}async function Ka(e,t){const n=await fetch(`${Ge}/scenarios/${e}/${encodeURIComponent(t)}`,{method:"DELETE"});if(n.status!==404&&!n.ok)throw new Error(`Failed to clear ${e} scenario: ${n.status}`)}var Qa=k("<option> </option>"),$a=k("<option>Loading products...</option>"),er=k("<option> </option>"),tr=k('<p style="color: var(--accent-danger); font-size: 0.85em; margin-top: 10px;"> </p>'),ar=k('<div class="card"><div class="toolbar-header svelte-zw83d1"><h2>Device Management</h2> <div class="toolbar-actions svelte-zw83d1"><div class="view-toggle svelte-zw83d1"><button title="Card view"><svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor"><rect x="1" y="1" width="6" height="6" rx="1"></rect><rect x="9" y="1" width="6" height="6" rx="1"></rect><rect x="1" y="9" width="6" height="6" rx="1"></rect><rect x="9" y="9" width="6" height="6" rx="1"></rect></svg></button> <button title="Table view"><svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor"><rect x="1" y="2" width="14" height="2" rx="0.5"></rect><rect x="1" y="7" width="14" height="2" rx="0.5"></rect><rect x="1" y="12" width="14" height="2" rx="0.5"></rect></svg></button></div> <div class="page-size svelte-zw83d1"><label for="page-size" class="svelte-zw83d1">Show:</label> <select id="page-size" class="svelte-zw83d1"></select></div> <button class="btn btn-delete"> </button></div></div> <form><div class="form-row"><div class="form-group"><label for="product-id">Product</label> <select id="product-id"><!></select></div> <button type="submit" class="btn"> </button></div> <!></form></div>');function rr(e,t){Re(t,!0);let n=J(lt([])),r=J(null),o=J(!1),c=J(!1),v=J(null);const b=[10,20,50,100];Xt(async()=>{try{f(n,await qa(),!0),a(n).length>0&&f(r,a(n)[0].pid,!0)}catch(D){f(v,D instanceof Error?D.message:"Failed to load products",!0)}});async function _(D){if(D.preventDefault(),a(r)!==null){f(o,!0),f(v,null);try{await Ga(a(r))}catch(G){f(v,G instanceof Error?G.message:"Failed to create device",!0)}finally{f(o,!1)}}}async function w(){if(V.count!==0&&confirm(`Remove all ${V.count} devices?`)){f(c,!0),f(v,null);try{const D=await Lt();console.log(`Removed ${D.removed} devices`)}catch(D){f(v,D instanceof Error?D.message:"Failed to remove devices",!0)}finally{f(c,!1)}}}function g(D){const G=D.target;I.setPageSize(parseInt(G.value,10))}var m=ar(),u=i(m),y=l(i(u),2),P=i(y),X=i(P);let p;X.__click=()=>I.setViewMode("card");var x=l(X,2);let C;x.__click=()=>I.setViewMode("table"),s(P);var T=l(P,2),M=l(i(T),2);M.__change=g,ye(M,21,()=>b,Ie,(D,G)=>{var te=Qa(),$=i(te,!0);s(te);var ce={};B(()=>{F($,a(G)),ce!==(ce=a(G))&&(te.value=(te.__value=a(G))??"")}),h(D,te)}),s(M);var L;Gt(M),s(T);var z=l(T,2);z.__click=w;var O=i(z,!0);s(z),s(y),s(u);var W=l(u,2),j=i(W),H=i(j),ue=l(i(H),2),ee=i(ue);{var A=D=>{var G=$a();G.value=G.__value="",h(D,G)},Q=D=>{var G=Le(),te=de(G);ye(te,17,()=>a(n),$=>$.pid,($,ce)=>{var me=er(),S=i(me);s(me);var N={};B(()=>{F(S,`${a(ce).pid??""} - ${a(ce).name??""}`),N!==(N=a(ce).pid)&&(me.value=(me.__value=a(ce).pid)??"")}),h($,me)}),h(D,G)};R(ee,D=>{a(n).length===0?D(A):D(Q,!1)})}s(ue),s(H);var fe=l(H,2),xe=i(fe,!0);s(fe),s(j);var be=l(j,2);{var ne=D=>{var G=tr(),te=i(G,!0);s(G),B(()=>F(te,a(v))),h(D,G)};R(be,D=>{a(v)&&D(ne)})}s(W),s(m),B(()=>{p=Xe(X,1,"view-btn svelte-zw83d1",null,p,{active:I.viewMode==="card"}),C=Xe(x,1,"view-btn svelte-zw83d1",null,C,{active:I.viewMode==="table"}),L!==(L=I.pageSize)&&(M.value=(M.__value=I.pageSize)??"",Ft(M,I.pageSize)),z.disabled=a(c)||V.count===0,$e(z,"title",V.count===0?"No devices to remove":"Remove all devices"),F(O,a(c)?"Removing...":"Remove All"),ue.disabled=a(n).length===0,fe.disabled=a(o)||a(r)===null,F(xe,a(o)?"Adding...":"Add Device")}),Fa("submit",W,_),It(ue,()=>a(r),D=>f(r,D)),h(e,m),Oe()}qe(["click","change"]);var sr=k('<span class="badge badge-capability">color</span>'),ir=k('<span class="badge badge-capability">IR</span>'),nr=k('<span class="badge badge-extended-mz"> </span>'),lr=k('<span class="badge badge-capability"> </span>'),or=k('<span class="badge badge-capability"> </span>'),cr=k('<span class="badge badge-capability">HEV</span>'),vr=k('<div class="metadata-display"><div class="metadata-row"><span class="metadata-label">Firmware:</span> <span class="metadata-value"> </span></div> <div class="metadata-row"><span class="metadata-label">Vendor:</span> <span class="metadata-value"> </span></div> <div class="metadata-row"><span class="metadata-label">Product:</span> <span class="metadata-value"> </span></div> <div class="metadata-row"><span class="metadata-label">Capabilities:</span> <span class="metadata-value" style="color: var(--accent-primary);"> </span></div> <div class="metadata-row"><span class="metadata-label">Group:</span> <span class="metadata-value"> </span></div> <div class="metadata-row"><span class="metadata-label">Location:</span> <span class="metadata-value"> </span></div> <div class="metadata-row"><span class="metadata-label">Uptime:</span> <span class="metadata-value"> </span></div> <div class="metadata-row"><span class="metadata-label">WiFi Signal:</span> <span class="metadata-value"> </span></div></div>'),dr=k('<div class="zone-segment"></div>'),ur=k('<div class="zone-strip"></div>'),fr=k('<button type="button" class="toggle-link"> </button> <!>',1),_r=k('<div class="tile-zone"></div>'),pr=k('<div class="tile-grid"></div>'),br=k('<div style="color: var(--text-dimmed);">No color data</div>'),mr=k('<div class="tile-item"><div class="tile-label"></div> <!></div>'),hr=k('<div class="tiles-container"></div>'),gr=k('<button type="button" class="toggle-link"> </button> <!>',1),wr=k('<div style="margin-top: 4px;"><span class="color-swatch"></span> <span style="color: var(--text-muted); font-size: 0.75em;">Current color</span></div>'),yr=k('<div class="device"><div class="device-header"><div><div class="device-serial"> </div> <div class="device-label"> </div></div> <button class="btn btn-delete btn-sm"> </button></div> <div class="badges"><span> </span> <span class="badge badge-capability"> </span> <!> <!> <!> <!> <!></div> <button type="button" class="toggle-link"> </button> <!> <!></div>');function xr(e,t){Re(t,!0);let n=J(!1);async function r(){if(confirm(`Delete device ${t.device.serial}?`)){f(n,!0);try{await Jt(t.device.serial)}catch(S){alert(S instanceof Error?S.message:"Failed to delete device")}finally{f(n,!1)}}}function o(S){return`${Math.floor(S/1e9)}s`}function c(){const S=[];return t.device.has_color&&S.push("Color"),t.device.has_infrared&&S.push("Infrared"),t.device.has_multizone&&S.push(`Multizone (${t.device.zone_count} zones)`),t.device.has_extended_multizone&&S.push("Extended Multizone"),t.device.has_matrix&&S.push(`Matrix (${t.device.tile_count} tiles)`),t.device.has_hev&&S.push("HEV/Clean"),t.device.has_relays&&S.push("Relays"),t.device.has_buttons&&S.push("Buttons"),S.join(", ")||"None"}let v=De(()=>I.isZonesExpanded(t.device.serial)),b=De(()=>I.isMetadataExpanded(t.device.serial));var _=yr(),w=i(_),g=i(w),m=i(g),u=i(m,!0);s(m);var y=l(m,2),P=i(y,!0);s(y),s(g);var X=l(g,2);X.__click=r;var p=i(X,!0);s(X),s(w);var x=l(w,2),C=i(x);let T;var M=i(C,!0);s(C);var L=l(C,2),z=i(L);s(L);var O=l(L,2);{var W=S=>{var N=sr();h(S,N)};R(O,S=>{t.device.has_color&&S(W)})}var j=l(O,2);{var H=S=>{var N=ir();h(S,N)};R(j,S=>{t.device.has_infrared&&S(H)})}var ue=l(j,2);{var ee=S=>{var N=nr(),Z=i(N);s(N),B(()=>F(Z,`extended-mz×${t.device.zone_count??""}`)),h(S,N)},A=S=>{var N=Le(),Z=de(N);{var _e=ve=>{var q=lr(),se=i(q);s(q),B(()=>F(se,`multizone×${t.device.zone_count??""}`)),h(ve,q)};R(Z,ve=>{t.device.has_multizone&&ve(_e)},!0)}h(S,N)};R(ue,S=>{t.device.has_extended_multizone?S(ee):S(A,!1)})}var Q=l(ue,2);{var fe=S=>{var N=or(),Z=i(N);s(N),B(()=>F(Z,`matrix×${t.device.tile_count??""}`)),h(S,N)};R(Q,S=>{t.device.has_matrix&&S(fe)})}var xe=l(Q,2);{var be=S=>{var N=cr();h(S,N)};R(xe,S=>{t.device.has_hev&&S(be)})}s(x);var ne=l(x,2);ne.__click=()=>I.toggleMetadataExpanded(t.device.serial);var D=i(ne);s(ne);var G=l(ne,2);{var te=S=>{var N=vr(),Z=i(N),_e=l(i(Z),2),ve=i(_e);s(_e),s(Z);var q=l(Z,2),se=l(i(q),2),Y=i(se,!0);s(se),s(q);var ae=l(q,2),re=l(i(ae),2),le=i(re,!0);s(re),s(ae);var oe=l(ae,2),K=l(i(oe),2),pe=i(K,!0);s(K),s(oe);var ie=l(oe,2),Pe=l(i(ie),2),Be=i(Pe,!0);s(Pe),s(ie);var He=l(ie,2),Je=l(i(He),2),et=i(Je,!0);s(Je),s(He);var Ve=l(He,2),he=l(i(Ve),2),Ce=i(he,!0);s(he),s(Ve);var Te=l(Ve,2),Ze=l(i(Te),2),d=i(Ze);s(Ze),s(Te),s(N),B((E,U,ge)=>{F(ve,`${t.device.version_major??""}.${t.device.version_minor??""}`),F(Y,t.device.vendor),F(le,t.device.product),F(pe,E),F(Be,t.device.group_label),F(et,t.device.location_label),F(Ce,U),F(d,`${ge??""} dBm`)},[c,()=>o(t.device.uptime_ns),()=>t.device.wifi_signal.toFixed(1)]),h(S,N)};R(G,S=>{a(b)&&S(te)})}var $=l(G,2);{var ce=S=>{var N=fr(),Z=de(N);Z.__click=()=>I.toggleZonesExpanded(t.device.serial);var _e=i(Z);s(Z);var ve=l(Z,2);{var q=se=>{var Y=ur();ye(Y,21,()=>t.device.zone_colors,Ie,(ae,re)=>{var le=dr();B(oe=>Ke(le,`background: ${oe??""};`),[()=>nt(a(re))]),h(ae,le)}),s(Y),h(se,Y)};R(ve,se=>{a(v)&&se(q)})}B(()=>F(_e,`${a(v)?"▾":"▸"} ${a(v)?"Hide":"Show"} zones (${t.device.zone_colors.length??""})`)),h(S,N)},me=S=>{var N=Le(),Z=de(N);{var _e=q=>{var se=gr(),Y=de(se);Y.__click=()=>I.toggleZonesExpanded(t.device.serial);var ae=i(Y);s(Y);var re=l(Y,2);{var le=oe=>{var K=hr();ye(K,21,()=>t.device.tile_devices,Ie,(pe,ie,Pe)=>{var Be=mr(),He=i(Be);He.textContent=`T${Pe+1}`;var Je=l(He,2);{var et=he=>{var Ce=pr();ye(Ce,21,()=>a(ie).colors.slice(0,(a(ie).width||8)*(a(ie).height||8)),Ie,(Te,Ze)=>{var d=_r();B(E=>Ke(d,`background: ${E??""};`),[()=>nt(a(Ze))]),h(Te,d)}),s(Ce),B(()=>Ke(Ce,`grid-template-columns: repeat(${(a(ie).width||8)??""}, 8px);`)),h(he,Ce)},Ve=he=>{var Ce=br();h(he,Ce)};R(Je,he=>{a(ie).colors&&a(ie).colors.length>0?he(et):he(Ve,!1)})}s(Be),h(pe,Be)}),s(K),h(oe,K)};R(re,oe=>{a(v)&&oe(le)})}B(()=>F(ae,`${a(v)?"▾":"▸"} ${a(v)?"Hide":"Show"} tiles (${t.device.tile_devices.length??""})`)),h(q,se)},ve=q=>{var se=Le(),Y=de(se);{var ae=re=>{var le=wr(),oe=i(le);vt(2),s(le),B(K=>Ke(oe,`background: ${K??""};`),[()=>nt(t.device.color)]),h(re,le)};R(Y,re=>{t.device.has_color&&t.device.color&&re(ae)},!0)}h(q,se)};R(Z,q=>{t.device.has_matrix&&t.device.tile_devices&&t.device.tile_devices.length>0?q(_e):q(ve,!1)},!0)}h(S,N)};R($,S=>{t.device.has_multizone&&t.device.zone_colors&&t.device.zone_colors.length>0?S(ce):S(me,!1)})}s(_),B(()=>{F(u,t.device.serial),F(P,t.device.label),X.disabled=a(n),F(p,a(n)?"...":"Del"),T=Xe(C,1,"badge",null,T,{"badge-power-on":t.device.power_level>0,"badge-power-off":t.device.power_level===0}),F(M,t.device.power_level>0?"ON":"OFF"),F(z,`P${t.device.product??""}`),F(D,`${a(b)?"▾":"▸"} ${a(b)?"Hide":"Show"} metadata`)}),h(e,_),Oe()}qe(["click"]);var kr=k('<div class="no-devices">No devices emulated</div>'),Sr=k('<div class="pagination svelte-qz4xni"><button class="btn btn-sm">Previous</button> <span class="page-info svelte-qz4xni"> </span> <button class="btn btn-sm">Next</button></div>'),Er=k('<div class="devices-grid"></div> <!>',1),Fr=k('<div class="card"><h2 style="display: flex; justify-content: space-between; align-items: center;"><span> </span> <button class="btn btn-delete" title="Remove all devices from server (runtime only)"> </button></h2> <!></div>');function Ir(e,t){Re(t,!0);let n=J(!1),r=J(lt(V.count));async function o(){if(V.count===0){alert("No devices to remove");return}const C=`Remove all ${V.count} device(s) from the server?

This will stop all devices from responding to LIFX protocol packets, but will not delete persistent storage.`;if(confirm(C)){f(n,!0);try{const T=await Lt();alert(T.message)}catch(T){alert(T instanceof Error?T.message:"Failed to remove devices")}finally{f(n,!1)}}}let c=De(()=>Math.max(1,Math.ceil(V.count/I.pageSize))),v=De(()=>()=>{const C=(I.currentPage-1)*I.pageSize,T=C+I.pageSize;return V.list.slice(C,T)});function b(){I.currentPage>1&&I.setCurrentPage(I.currentPage-1)}function _(){I.currentPage<a(c)&&I.setCurrentPage(I.currentPage+1)}dt(()=>{if(Math.abs(V.count-a(r))>0){const T=Math.max(1,Math.ceil(V.count/I.pageSize));I.currentPage>T&&I.setCurrentPage(1),f(r,V.count,!0)}});var w=Fr(),g=i(w),m=i(g),u=i(m);s(m);var y=l(m,2);y.__click=o;var P=i(y,!0);s(y),s(g);var X=l(g,2);{var p=C=>{var T=kr();h(C,T)},x=C=>{var T=Er(),M=de(T);ye(M,21,()=>a(v)(),O=>O.serial,(O,W)=>{xr(O,{get device(){return a(W)}})}),s(M);var L=l(M,2);{var z=O=>{var W=Sr(),j=i(W);j.__click=b;var H=l(j,2),ue=i(H);s(H);var ee=l(H,2);ee.__click=_,s(W),B(()=>{j.disabled=I.currentPage<=1,F(ue,`Page ${I.currentPage??""} of ${a(c)??""}`),ee.disabled=I.currentPage>=a(c)}),h(O,W)};R(L,O=>{a(c)>1&&O(z)})}h(C,T)};R(X,C=>{V.count===0?C(p):C(x,!1)})}s(w),B(()=>{F(u,`Devices (${V.count??""})`),y.disabled=a(n)||V.count===0,F(P,a(n)?"Removing...":"Remove All")}),h(e,w),Oe()}qe(["click"]);var Lr=k('<div class="no-devices svelte-14519bm">No devices emulated</div>'),Cr=k('<div class="zone-mini svelte-14519bm"></div>'),Ar=k('<span class="more-zones svelte-14519bm"> </span>'),Pr=k('<div class="zone-mini-strip svelte-14519bm"><!> <!></div>'),Tr=k('<span class="color-swatch svelte-14519bm"></span>'),zr=k('<span class="no-color svelte-14519bm">-</span>'),Mr=k('<tr class="svelte-14519bm"><td class="cell-serial svelte-14519bm"> </td><td class="cell-label svelte-14519bm"> </td><td class="cell-product svelte-14519bm"> </td><td class="svelte-14519bm"><span> </span></td><td class="svelte-14519bm"><!></td><td class="svelte-14519bm"><button class="btn btn-delete btn-sm"> </button></td></tr>'),Nr=k('<div class="pagination svelte-14519bm"><button class="btn btn-sm">Previous</button> <span class="page-info svelte-14519bm"> </span> <button class="btn btn-sm">Next</button></div>'),Dr=k('<div class="table-container svelte-14519bm"><table class="device-table svelte-14519bm"><thead><tr><th class="svelte-14519bm">Serial</th><th class="svelte-14519bm">Label</th><th class="svelte-14519bm">Product</th><th class="svelte-14519bm">Power</th><th class="svelte-14519bm">Color</th><th class="svelte-14519bm">Actions</th></tr></thead><tbody class="svelte-14519bm"></tbody></table></div> <!>',1),Xr=k('<div class="card"><h2 style="display: flex; justify-content: space-between; align-items: center;"><span> </span> <button class="btn btn-delete" title="Remove all devices from server (runtime only)"> </button></h2> <!></div>');function Rr(e,t){Re(t,!0);let n=J(!1),r=J(null),o=J(lt(V.count));async function c(){if(V.count===0){alert("No devices to remove");return}const L=`Remove all ${V.count} device(s) from the server?

This will stop all devices from responding to LIFX protocol packets, but will not delete persistent storage.`;if(confirm(L)){f(n,!0);try{const z=await Lt();alert(z.message)}catch(z){alert(z instanceof Error?z.message:"Failed to remove devices")}finally{f(n,!1)}}}async function v(L){if(confirm(`Delete device ${L}?`)){f(r,L,!0);try{await Jt(L)}catch(z){alert(z instanceof Error?z.message:"Failed to delete device")}finally{f(r,null)}}}function b(L){return{1:"Original 1000",10:"White 800 (Low Voltage)",11:"White 800 (High Voltage)",18:"White 900 BR30",20:"Color 1000 BR30",22:"Color 1000",27:"LIFX A19",28:"LIFX BR30",29:"LIFX+ A19",30:"LIFX+ BR30",31:"LIFX Z",32:"LIFX Z 2",36:"LIFX Downlight",37:"LIFX Downlight",38:"LIFX Beam",43:"LIFX A19",44:"LIFX BR30",45:"LIFX+ A19",46:"LIFX+ BR30",49:"LIFX Mini Color",50:"LIFX Mini Day and Dusk",51:"LIFX Mini White",52:"LIFX GU10",55:"LIFX Tile",57:"LIFX Candle",59:"LIFX Mini Color",60:"LIFX Mini Day and Dusk",61:"LIFX Mini White",62:"LIFX A19",63:"LIFX BR30",64:"LIFX A19 Night Vision",65:"LIFX BR30 Night Vision",68:"LIFX Candle CA",70:"LIFX Switch",71:"LIFX Switch",81:"LIFX Candle Warm to White",82:"LIFX Filament",85:"LIFX A19 HEV",87:"LIFX Candle Color",88:"LIFX BR30 HEV",89:"LIFX A19 Clean",90:"LIFX Color",91:"LIFX Color",94:"LIFX BR30",96:"LIFX Candle White to Warm",97:"LIFX A19",98:"LIFX BR30",99:"LIFX Clean",100:"LIFX Filament Clear",101:"LIFX Filament Amber",109:"LIFX A19 HEV",110:"LIFX BR30 HEV",111:"LIFX Neon",112:"LIFX Lightstrip",120:"LIFX GU10"}[L]||`Product ${L}`}let _=De(()=>Math.max(1,Math.ceil(V.count/I.pageSize))),w=De(()=>()=>{const L=(I.currentPage-1)*I.pageSize,z=L+I.pageSize;return V.list.slice(L,z)});function g(){I.currentPage>1&&I.setCurrentPage(I.currentPage-1)}function m(){I.currentPage<a(_)&&I.setCurrentPage(I.currentPage+1)}dt(()=>{if(Math.abs(V.count-a(o))>0){const z=Math.max(1,Math.ceil(V.count/I.pageSize));I.currentPage>z&&I.setCurrentPage(1),f(o,V.count,!0)}});var u=Xr(),y=i(u),P=i(y),X=i(P);s(P);var p=l(P,2);p.__click=c;var x=i(p,!0);s(p),s(y);var C=l(y,2);{var T=L=>{var z=Lr();h(L,z)},M=L=>{var z=Dr(),O=de(z),W=i(O),j=l(i(W));ye(j,21,()=>a(w)(),ee=>ee.serial,(ee,A)=>{var Q=Mr(),fe=i(Q),xe=i(fe,!0);s(fe);var be=l(fe),ne=i(be,!0);s(be);var D=l(be),G=i(D,!0);s(D);var te=l(D),$=i(te);let ce;var me=i($,!0);s($),s(te);var S=l(te),N=i(S);{var Z=Y=>{var ae=Pr(),re=i(ae);ye(re,17,()=>a(A).zone_colors.slice(0,16),Ie,(K,pe)=>{var ie=Cr();B(Pe=>Ke(ie,`background: ${Pe??""};`),[()=>nt(a(pe))]),h(K,ie)});var le=l(re,2);{var oe=K=>{var pe=Ar(),ie=i(pe);s(pe),B(()=>F(ie,`+${a(A).zone_colors.length-16}`)),h(K,pe)};R(le,K=>{a(A).zone_colors.length>16&&K(oe)})}s(ae),h(Y,ae)},_e=Y=>{var ae=Le(),re=de(ae);{var le=K=>{var pe=Tr();B(ie=>Ke(pe,`background: ${ie??""};`),[()=>nt(a(A).color)]),h(K,pe)},oe=K=>{var pe=zr();h(K,pe)};R(re,K=>{a(A).has_color&&a(A).color?K(le):K(oe,!1)},!0)}h(Y,ae)};R(N,Y=>{a(A).has_multizone&&a(A).zone_colors&&a(A).zone_colors.length>0?Y(Z):Y(_e,!1)})}s(S);var ve=l(S),q=i(ve);q.__click=()=>v(a(A).serial);var se=i(q,!0);s(q),s(ve),s(Q),B(Y=>{F(xe,a(A).serial),F(ne,a(A).label),F(G,Y),ce=Xe($,1,"power-badge svelte-14519bm",null,ce,{"power-on":a(A).power_level>0,"power-off":a(A).power_level===0}),F(me,a(A).power_level>0?"ON":"OFF"),q.disabled=a(r)===a(A).serial,F(se,a(r)===a(A).serial?"...":"Del")},[()=>b(a(A).product)]),h(ee,Q)}),s(j),s(W),s(O);var H=l(O,2);{var ue=ee=>{var A=Nr(),Q=i(A);Q.__click=g;var fe=l(Q,2),xe=i(fe);s(fe);var be=l(fe,2);be.__click=m,s(A),B(()=>{Q.disabled=I.currentPage<=1,F(xe,`Page ${I.currentPage??""} of ${a(_)??""}`),be.disabled=I.currentPage>=a(_)}),h(ee,A)};R(H,ee=>{a(_)>1&&ee(ue)})}h(L,z)};R(C,L=>{V.count===0?L(T):L(M,!1)})}s(u),B(()=>{F(X,`Devices (${V.count??""})`),p.disabled=a(n)||V.count===0,F(x,a(n)?"Removing...":"Remove All")}),h(e,u),Oe()}qe(["click"]);var Or=k('<div class="activity-disabled svelte-i8zsux"><p class="svelte-i8zsux">Activity logging is disabled.</p> <p class="hint svelte-i8zsux">Start the emulator with <code class="svelte-i8zsux">--activity</code> to enable packet logging.</p></div>'),Br=k('<button class="btn btn-sm">Clear</button>'),Hr=k('<div style="color: var(--text-dimmed);">No activity yet</div>'),Vr=k('<div style="color: var(--text-dimmed);">No matching activity</div>'),Ur=k('<div class="activity-item"><span class="activity-time"> </span> <span> </span> <span class="activity-packet"> </span> <span class="device-serial"> </span> <span style="color: var(--text-dimmed);"> </span></div>'),Wr=k('<div class="activity-filters"><div class="filter-group"><label for="filter-direction">Direction:</label> <select id="filter-direction"><option>All</option><option>RX</option><option>TX</option></select></div> <div class="filter-group"><label for="filter-device">Device/Target:</label> <input id="filter-device" type="text" placeholder="Filter by device..."/></div> <div class="filter-group"><label for="filter-packet">Packet:</label> <input id="filter-packet" type="text" placeholder="Filter by packet..."/></div> <!></div> <div class="activity-log"><!></div>',1),jr=k('<div class="card"><h2>Recent Activity</h2> <!></div>');function qr(e,t){Re(t,!0);let n=J("all"),r=J(""),o=J("");function c(m){return new Date(m*1e3).toLocaleTimeString()}let v=De(()=>()=>{let m=ot.reversed;if(a(n)!=="all"&&(m=m.filter(u=>u.direction===a(n))),a(r)){const u=a(r).toLowerCase();m=m.filter(y=>y.device?.toLowerCase().includes(u)||y.target?.toLowerCase().includes(u))}if(a(o)){const u=a(o).toLowerCase();m=m.filter(y=>y.packet_name.toLowerCase().includes(u))}return m});var b=jr(),_=l(i(b),2);{var w=m=>{var u=Or();h(m,u)},g=m=>{var u=Wr(),y=de(u),P=i(y),X=l(i(P),2),p=i(X);p.value=p.__value="all";var x=l(p);x.value=x.__value="rx";var C=l(x);C.value=C.__value="tx",s(X),s(P);var T=l(P,2),M=l(i(T),2);Se(M),s(T);var L=l(T,2),z=l(i(L),2);Se(z),s(L);var O=l(L,2);{var W=A=>{var Q=Br();Q.__click=()=>{f(n,"all"),f(r,""),f(o,"")},h(A,Q)};R(O,A=>{(a(n)!=="all"||a(r)||a(o))&&A(W)})}s(y);var j=l(y,2),H=i(j);{var ue=A=>{var Q=Hr();h(A,Q)},ee=A=>{var Q=Le(),fe=de(Q);{var xe=ne=>{var D=Vr();h(ne,D)},be=ne=>{var D=Le(),G=de(D);ye(G,17,()=>a(v)(),Ie,(te,$)=>{var ce=Ur(),me=i(ce),S=i(me,!0);s(me);var N=l(me,2),Z=i(N,!0);s(N);var _e=l(N,2),ve=i(_e,!0);s(_e);var q=l(_e,2),se=i(q,!0);s(q);var Y=l(q,2),ae=i(Y,!0);s(Y),s(ce),B((re,le)=>{F(S,re),Xe(N,1,Pa(a($).direction==="rx"?"activity-rx":"activity-tx")),F(Z,le),F(ve,a($).packet_name),F(se,a($).device||a($).target||"N/A"),F(ae,a($).addr)},[()=>c(a($).timestamp),()=>a($).direction.toUpperCase()]),h(te,ce)}),h(ne,D)};R(fe,ne=>{a(v)().length===0?ne(xe):ne(be,!1)},!0)}h(A,Q)};R(H,A=>{ot.count===0?A(ue):A(ee,!1)})}s(j),It(X,()=>a(n),A=>f(n,A)),Fe(M,()=>a(r),A=>f(r,A)),Fe(z,()=>a(o),A=>f(o,A)),h(m,u)};R(_,m=>{je.value.activity_enabled?m(g,!1):m(w)})}s(b),h(e,b),Oe()}qe(["click"]);var Gr=k("<button> </button>"),Jr=k("<option> </option>"),Yr=k("<option> </option>"),Zr=k('<div class="form-group" style="margin-top: 12px;"><label for="identifier"> </label> <select id="identifier"><!></select></div>'),Kr=k('<div class="inline-row svelte-15drtwo"><input type="text" placeholder="Packet type (e.g., 101)" style="width: 140px;" class="svelte-15drtwo"/> <input type="number" min="0" max="1" step="0.1" placeholder="Drop rate" style="width: 100px;" class="svelte-15drtwo"/> <button type="button" class="btn btn-delete btn-sm">X</button></div>'),Qr=k('<div class="inline-row svelte-15drtwo"><input type="text" placeholder="Packet type (e.g., 101)" style="width: 140px;" class="svelte-15drtwo"/> <input type="number" min="0" step="0.1" placeholder="Delay (s)" style="width: 100px;" class="svelte-15drtwo"/> <button type="button" class="btn btn-delete btn-sm">X</button></div>'),$r=k('<button type="button" class="btn btn-sm">Clear</button>'),es=k('<p class="message error svelte-15drtwo"> </p>'),ts=k('<p class="message success svelte-15drtwo"> </p>'),as=k('<div class="card"><h2>Scenario Configuration</h2> <div class="scope-tabs svelte-15drtwo"></div> <!> <div class="scenario-form svelte-15drtwo"><div class="form-section svelte-15drtwo"><div class="section-header svelte-15drtwo"><span class="section-title svelte-15drtwo">Drop Packets</span> <button type="button" class="btn btn-sm">+ Add</button></div> <p class="section-desc svelte-15drtwo">Specify packet types to drop (0.0 = never, 1.0 = always)</p> <!></div> <div class="form-section svelte-15drtwo"><div class="section-header svelte-15drtwo"><span class="section-title svelte-15drtwo">Response Delays</span> <button type="button" class="btn btn-sm">+ Add</button></div> <p class="section-desc svelte-15drtwo">Add delay (seconds) before responding to packet types</p> <!></div> <div class="form-section svelte-15drtwo"><label for="malformed" class="section-title svelte-15drtwo">Malformed Packets</label> <p class="section-desc svelte-15drtwo">Packet types to send with corrupted payloads (comma-separated)</p> <input id="malformed" type="text" placeholder="e.g., 101, 102, 118" class="svelte-15drtwo"/></div> <div class="form-section svelte-15drtwo"><label for="invalid" class="section-title svelte-15drtwo">Invalid Field Values</label> <p class="section-desc svelte-15drtwo">Packet types to send with 0xFF bytes (comma-separated)</p> <input id="invalid" type="text" placeholder="e.g., 101, 102" class="svelte-15drtwo"/></div> <div class="form-section svelte-15drtwo"><div class="section-header svelte-15drtwo"><span class="section-title svelte-15drtwo">Firmware Version Override</span> <!></div> <p class="section-desc svelte-15drtwo">Override reported firmware version (major.minor)</p> <div class="inline-row svelte-15drtwo"><input type="number" min="0" max="255" placeholder="Major" style="width: 80px;" class="svelte-15drtwo"/> <span>.</span> <input type="number" min="0" max="255" placeholder="Minor" style="width: 80px;" class="svelte-15drtwo"/></div></div> <div class="form-section svelte-15drtwo"><label for="partial" class="section-title svelte-15drtwo">Partial Responses</label> <p class="section-desc svelte-15drtwo">Packet types to send with incomplete data (comma-separated)</p> <input id="partial" type="text" placeholder="e.g., 506, 512" class="svelte-15drtwo"/></div> <div class="form-section svelte-15drtwo"><label class="checkbox-label svelte-15drtwo"><input type="checkbox" class="svelte-15drtwo"/> <span>Send Unhandled</span></label> <p class="section-desc svelte-15drtwo">Return StateUnhandled for unknown packet types</p></div></div> <!> <!> <div class="actions svelte-15drtwo"><button class="btn"> </button> <button class="btn btn-delete"> </button></div></div>');function rs(e,t){Re(t,!0);const n=["matrix","extended_multizone","multizone","hev","infrared","color","basic"];let r=J("global"),o=J(""),c=J(!1),v=J(null),b=J(null),_=J(lt([])),w=J(lt([])),g=J(""),m=J(""),u=J(""),y=J(""),P=J(""),X=J(!1);function p(d){return{global:"devices",device:"devices",type:"types",location:"locations",group:"groups"}[d]}let x=De(()=>()=>{switch(a(r)){case"device":return V.list.map(d=>d.serial);case"type":return n;case"location":return[...new Set(V.list.map(d=>d.location_label).filter(Boolean))];case"group":return[...new Set(V.list.map(d=>d.group_label).filter(Boolean))];default:return[]}}),C=De(()=>()=>{switch(a(r)){case"global":return Ye.global;case"device":return a(o)?Ye.devices[a(o)]:null;case"type":return a(o)?Ye.types[a(o)]:null;case"location":return a(o)?Ye.locations[a(o)]:null;case"group":return a(o)?Ye.groups[a(o)]:null;default:return null}});function T(d){if(!d){f(_,[],!0),f(w,[],!0),f(g,""),f(m,""),f(u,""),f(y,""),f(P,""),f(X,!0);return}d.drop_packets&&Object.keys(d.drop_packets).length>0?f(_,Object.entries(d.drop_packets).map(([E,U])=>({packetType:E,rate:String(U)})),!0):f(_,[],!0),d.response_delays&&Object.keys(d.response_delays).length>0?f(w,Object.entries(d.response_delays).map(([E,U])=>({packetType:E,delay:String(U)})),!0):f(w,[],!0),f(g,d.malformed_packets?.join(", ")||"",!0),f(m,d.invalid_field_values?.join(", ")||"",!0),f(P,d.partial_responses?.join(", ")||"",!0),d.firmware_version?(f(u,String(d.firmware_version[0]),!0),f(y,String(d.firmware_version[1]),!0)):(f(u,""),f(y,"")),f(X,d.send_unhandled??!0,!0)}function M(){const d={};if(a(_).length>0){d.drop_packets={};for(const{packetType:E,rate:U}of a(_))E&&U&&(d.drop_packets[E]=parseFloat(U))}if(a(w).length>0){d.response_delays={};for(const{packetType:E,delay:U}of a(w))E&&U&&(d.response_delays[E]=parseFloat(U))}return a(g).trim()&&(d.malformed_packets=a(g).split(",").map(E=>parseInt(E.trim(),10)).filter(E=>!isNaN(E))),a(m).trim()&&(d.invalid_field_values=a(m).split(",").map(E=>parseInt(E.trim(),10)).filter(E=>!isNaN(E))),a(P).trim()&&(d.partial_responses=a(P).split(",").map(E=>parseInt(E.trim(),10)).filter(E=>!isNaN(E))),a(u)&&a(y)&&(d.firmware_version=[parseInt(a(u),10),parseInt(a(y),10)]),d.send_unhandled=a(X),d}async function L(){f(v,null),f(b,null),f(c,!0);try{const d=M();if(a(r)==="global")await Ja(d);else{if(!a(o))throw new Error("Please select an identifier");await Za(p(a(r)),a(o),d)}f(b,"Scenario applied successfully"),setTimeout(()=>f(b,null),3e3)}catch(d){f(v,d instanceof Error?d.message:"Failed to apply scenario",!0)}finally{f(c,!1)}}async function z(){f(v,null),f(b,null),f(c,!0);try{if(a(r)==="global")await Ya();else{if(!a(o))throw new Error("Please select an identifier");await Ka(p(a(r)),a(o))}T(null),f(b,"Scenario cleared successfully"),setTimeout(()=>f(b,null),3e3)}catch(d){f(v,d instanceof Error?d.message:"Failed to clear scenario",!0)}finally{f(c,!1)}}function O(){f(_,[...a(_),{packetType:"",rate:"1.0"}],!0)}function W(d){f(_,a(_).filter((E,U)=>U!==d),!0)}function j(){f(w,[...a(w),{packetType:"",delay:"0.5"}],!0)}function H(d){f(w,a(w).filter((E,U)=>U!==d),!0)}function ue(){f(u,""),f(y,"")}dt(()=>{a(r)==="global"?T(a(C)()):a(o)?T(a(C)()):T(null)}),dt(()=>{const d=a(x)();a(r)!=="global"&&d.length>0&&!d.includes(a(o))&&f(o,d[0],!0)});var ee=as(),A=l(i(ee),2);ye(A,20,()=>["global","device","type","location","group"],Ie,(d,E)=>{var U=Gr();let ge;U.__click=()=>f(r,E,!0);var ke=i(U,!0);s(U),B(Ee=>{ge=Xe(U,1,"scope-tab svelte-15drtwo",null,ge,{active:a(r)===E}),F(ke,Ee)},[()=>E.charAt(0).toUpperCase()+E.slice(1)]),h(d,U)}),s(A);var Q=l(A,2);{var fe=d=>{var E=Zr(),U=i(E),ge=i(U);s(U);var ke=l(U,2),Ee=i(ke);{var tt=Ae=>{var Ue=Jr(),ut=i(Ue);s(Ue),Ue.value=Ue.__value="",B(()=>F(ut,`No ${a(r)??""}s available`)),h(Ae,Ue)},ze=Ae=>{var Ue=Le(),ut=de(Ue);ye(ut,17,()=>a(x)(),Ie,(Yt,ft)=>{var at=Yr(),Zt=i(at,!0);s(at);var Ct={};B(()=>{F(Zt,a(ft)),Ct!==(Ct=a(ft))&&(at.value=(at.__value=a(ft))??"")}),h(Yt,at)}),h(Ae,Ue)};R(Ee,Ae=>{a(x)().length===0?Ae(tt):Ae(ze,!1)})}s(ke),s(E),B(Ae=>F(ge,`${Ae??""}:`),[()=>a(r).charAt(0).toUpperCase()+a(r).slice(1)]),It(ke,()=>a(o),Ae=>f(o,Ae)),h(d,E)};R(Q,d=>{a(r)!=="global"&&d(fe)})}var xe=l(Q,2),be=i(xe),ne=i(be),D=l(i(ne),2);D.__click=O,s(ne);var G=l(ne,4);ye(G,17,()=>a(_),Ie,(d,E,U)=>{var ge=Kr(),ke=i(ge);Se(ke);var Ee=l(ke,2);Se(Ee);var tt=l(Ee,2);tt.__click=()=>W(U),s(ge),Fe(ke,()=>a(E).packetType,ze=>a(E).packetType=ze),Fe(Ee,()=>a(E).rate,ze=>a(E).rate=ze),h(d,ge)}),s(be);var te=l(be,2),$=i(te),ce=l(i($),2);ce.__click=j,s($);var me=l($,4);ye(me,17,()=>a(w),Ie,(d,E,U)=>{var ge=Qr(),ke=i(ge);Se(ke);var Ee=l(ke,2);Se(Ee);var tt=l(Ee,2);tt.__click=()=>H(U),s(ge),Fe(ke,()=>a(E).packetType,ze=>a(E).packetType=ze),Fe(Ee,()=>a(E).delay,ze=>a(E).delay=ze),h(d,ge)}),s(te);var S=l(te,2),N=l(i(S),4);Se(N),s(S);var Z=l(S,2),_e=l(i(Z),4);Se(_e),s(Z);var ve=l(Z,2),q=i(ve),se=l(i(q),2);{var Y=d=>{var E=$r();E.__click=ue,h(d,E)};R(se,d=>{(a(u)||a(y))&&d(Y)})}s(q);var ae=l(q,4),re=i(ae);Se(re);var le=l(re,4);Se(le),s(ae),s(ve);var oe=l(ve,2),K=l(i(oe),4);Se(K),s(oe);var pe=l(oe,2),ie=i(pe),Pe=i(ie);Se(Pe),vt(2),s(ie),vt(2),s(pe),s(xe);var Be=l(xe,2);{var He=d=>{var E=es(),U=i(E,!0);s(E),B(()=>F(U,a(v))),h(d,E)};R(Be,d=>{a(v)&&d(He)})}var Je=l(Be,2);{var et=d=>{var E=ts(),U=i(E,!0);s(E),B(()=>F(U,a(b))),h(d,E)};R(Je,d=>{a(b)&&d(et)})}var Ve=l(Je,2),he=i(Ve);he.__click=L;var Ce=i(he,!0);s(he);var Te=l(he,2);Te.__click=z;var Ze=i(Te,!0);s(Te),s(Ve),s(ee),B(()=>{he.disabled=a(c)||a(r)!=="global"&&!a(o),F(Ce,a(c)?"Applying...":"Apply"),Te.disabled=a(c)||a(r)!=="global"&&!a(o),F(Ze,a(c)?"Clearing...":"Clear")}),Fe(N,()=>a(g),d=>f(g,d)),Fe(_e,()=>a(m),d=>f(m,d)),Fe(re,()=>a(u),d=>f(u,d)),Fe(le,()=>a(y),d=>f(y,d)),Fe(K,()=>a(P),d=>f(P,d)),Ra(Pe,()=>a(X),d=>f(X,d)),h(e,ee),Oe()}qe(["click"]);var ss=k('<span class="tab-count svelte-1uha8ag"> </span>'),is=k('<span class="tab-count svelte-1uha8ag"> </span>'),ns=k("<button> <!></button>"),ls=k("<!> <!>",1),os=k('<div class="container"><!> <!> <div class="tabs svelte-1uha8ag"></div> <div class="tab-content svelte-1uha8ag"><!></div></div>');function bs(e,t){Re(t,!1);const n=[{id:"devices",label:"Devices"},{id:"activity",label:"Activity"},{id:"scenarios",label:"Scenarios"}];Xt(()=>{Qe.connect()}),Kt(()=>{Qe.disconnect()}),kt();var r=os(),o=i(r);Va(o,{});var c=l(o,2);{var v=u=>{ja(u,{})};R(c,u=>{I.showStats&&u(v)})}var b=l(c,2);ye(b,5,()=>n,Ie,(u,y)=>{var P=ns();let X;P.__click=()=>I.setActiveTab(a(y).id);var p=i(P),x=l(p);{var C=M=>{var L=ss(),z=i(L,!0);s(L),B(()=>F(z,V.count)),h(M,L)},T=M=>{var L=Le(),z=de(L);{var O=W=>{var j=is(),H=i(j,!0);s(j),B(()=>F(H,ot.count)),h(W,j)};R(z,W=>{a(y).id==="activity"&&W(O)},!0)}h(M,L)};R(x,M=>{a(y).id==="devices"?M(C):M(T,!1)})}s(P),B(()=>{X=Xe(P,1,"tab svelte-1uha8ag",null,X,{active:I.activeTab===a(y).id}),F(p,`${a(y).label??""} `)}),h(u,P)}),s(b);var _=l(b,2),w=i(_);{var g=u=>{var y=ls(),P=de(y);rr(P,{});var X=l(P,2);{var p=C=>{Rr(C,{})},x=C=>{Ir(C,{})};R(X,C=>{I.viewMode==="table"?C(p):C(x,!1)})}h(u,y)},m=u=>{var y=Le(),P=de(y);{var X=x=>{qr(x,{})},p=x=>{var C=Le(),T=de(C);{var M=L=>{rs(L,{})};R(T,L=>{I.activeTab==="scenarios"&&L(M)},!0)}h(x,C)};R(P,x=>{I.activeTab==="activity"?x(X):x(p,!1)},!0)}h(u,y)};R(w,u=>{I.activeTab==="devices"?u(g):u(m,!1)})}s(_),s(r),h(e,r),Oe()}qe(["click"]);export{bs as component};
