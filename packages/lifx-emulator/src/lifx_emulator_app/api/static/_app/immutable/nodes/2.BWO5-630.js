import{a as w,f as S,c as de}from"../chunks/CiI5xlTc.js";import{i as De}from"../chunks/BEoErfWv.js";import{o as ia,a as Ea}from"../chunks/BloQUvLC.js";import{h as B,a as Sa,b as ka,w as p,r as Aa,H as Na,s as Ge,c as Le,d as He,k as Ae,S as Ta,aw as Ma,af as Qe,e as Te,j as Xe,l as Ca,aH as Da,aN as na,au as Ve,aO as za,a1 as Ke,aP as Ia,aQ as Fa,aL as Ra,L as Oa,i as Pe,aR as $,aS as oa,f as va,p as la,aT as We,a3 as La,aU as Ha,aV as Pa,at as Wa,g as Ua,U as qa,aW as Xa,V as Ba,am as Va,aX as Ja,aY as Ya,aZ as Za,a_ as ja,a$ as Ga,b0 as Qa,Y as F,W as ie,B as ne,C as K,D as I,F as oe,G as v,J as f,I as o,ag as ca,X as Ka,Z as $e}from"../chunks/eMl1SKyf.js";import{a as Ce,d as Z,s as se,t as Ue,u as me}from"../chunks/Dh1HxqQJ.js";import{d as Je,s as E,e as $a}from"../chunks/CHhzdN_j.js";import{i as z}from"../chunks/D9xvlGh5.js";function Me(a,e){return e}function et(a,e,r){for(var t=[],n=e.length,i,s=e.length,d=0;d<n;d++){let y=e[d];la(y,()=>{if(i){if(i.pending.delete(y),i.done.add(y),i.pending.size===0){var g=a.outrogroups;Be(Ve(i.done)),g.delete(i),g.size===0&&(a.outrogroups=null)}}else s-=1},!1)}if(s===0){var c=t.length===0&&r!==null;if(c){var _=r,u=_.parentNode;Wa(u),u.append(_),a.items.clear()}Be(e,!c)}else i={pending:new Set(e),done:new Set},(a.outrogroups??=new Set).add(i)}function Be(a,e=!0){for(var r=0;r<a.length;r++)Ua(a[r],e)}var ea;function ue(a,e,r,t,n,i=null){var s=a,d=new Map,c=(e&oa)!==0;if(c){var _=a;s=B?Le(Oa(_)):_.appendChild(Pe())}B&&Sa();var u=null,y=Da(()=>{var b=r();return na(b)?b:b==null?[]:Ve(b)}),g,h=!0;function k(){l.fallback=u,at(l,g,s,e,t),u!==null&&(g.length===0?(u.f&$)===0?va(u):(u.f^=$,he(u,null,s)):la(u,()=>{u=null}))}var C=ka(()=>{g=p(y);var b=g.length;let x=!1;if(B){var A=Aa(s)===Na;A!==(b===0)&&(s=Ge(),Le(s),He(!1),x=!0)}for(var M=new Set,R=Te,O=Ca(),T=0;T<b;T+=1){B&&Ae.nodeType===Ta&&Ae.data===Ma&&(s=Ae,x=!0,He(!1));var P=g[T],W=t(P,T),D=h?null:d.get(W);D?(D.v&&Qe(D.v,P),D.i&&Qe(D.i,T),O&&R.skipped_effects.delete(D.e)):(D=tt(d,h?s:ea??=Pe(),P,W,T,n,e,r),h||(D.e.f|=$),d.set(W,D)),M.add(W)}if(b===0&&i&&!u&&(h?u=Xe(()=>i(s)):(u=Xe(()=>i(ea??=Pe())),u.f|=$)),B&&b>0&&Le(Ge()),!h)if(O){for(const[ve,fe]of d)M.has(ve)||R.skipped_effects.add(fe.e);R.oncommit(k),R.ondiscard(()=>{})}else k();x&&He(!0),p(y)}),l={effect:C,items:d,outrogroups:null,fallback:u};h=!1,B&&(s=Ae)}function ge(a){for(;a!==null&&(a.f&Ha)===0;)a=a.next;return a}function at(a,e,r,t,n){var i=(t&Pa)!==0,s=e.length,d=a.items,c=ge(a.effect.first),_,u=null,y,g=[],h=[],k,C,l,b;if(i)for(b=0;b<s;b+=1)k=e[b],C=n(k,b),l=d.get(C).e,(l.f&$)===0&&(l.nodes?.a?.measure(),(y??=new Set).add(l));for(b=0;b<s;b+=1){if(k=e[b],C=n(k,b),l=d.get(C).e,a.outrogroups!==null)for(const D of a.outrogroups)D.pending.delete(l),D.done.delete(l);if((l.f&$)!==0)if(l.f^=$,l===c)he(l,null,r);else{var x=u?u.next:c;l===a.effect.last&&(a.effect.last=l.prev),l.prev&&(l.prev.next=l.next),l.next&&(l.next.prev=l.prev),re(a,u,l),re(a,l,x),he(l,x,r),u=l,g=[],h=[],c=ge(u.next);continue}if((l.f&We)!==0&&(va(l),i&&(l.nodes?.a?.unfix(),(y??=new Set).delete(l))),l!==c){if(_!==void 0&&_.has(l)){if(g.length<h.length){var A=h[0],M;u=A.prev;var R=g[0],O=g[g.length-1];for(M=0;M<g.length;M+=1)he(g[M],A,r);for(M=0;M<h.length;M+=1)_.delete(h[M]);re(a,R.prev,O.next),re(a,u,R),re(a,O,A),c=A,u=O,b-=1,g=[],h=[]}else _.delete(l),he(l,c,r),re(a,l.prev,l.next),re(a,l,u===null?a.effect.first:u.next),re(a,u,l),u=l;continue}for(g=[],h=[];c!==null&&c!==l;)(_??=new Set).add(c),h.push(c),c=ge(c.next);if(c===null)continue}(l.f&$)===0&&g.push(l),u=l,c=ge(l.next)}if(a.outrogroups!==null){for(const D of a.outrogroups)D.pending.size===0&&(Be(Ve(D.done)),a.outrogroups?.delete(D));a.outrogroups.size===0&&(a.outrogroups=null)}if(c!==null||_!==void 0){var T=[];if(_!==void 0)for(l of _)(l.f&We)===0&&T.push(l);for(;c!==null;)(c.f&We)===0&&c!==a.fallback&&T.push(c),c=ge(c.next);var P=T.length;if(P>0){var W=(t&oa)!==0&&s===0?r:null;if(i){for(b=0;b<P;b+=1)T[b].nodes?.a?.measure();for(b=0;b<P;b+=1)T[b].nodes?.a?.fix()}et(a,T,W)}}i&&La(()=>{if(y!==void 0)for(l of y)l.nodes?.a?.apply()})}function tt(a,e,r,t,n,i,s,d){var c=(s&Ia)!==0?(s&Fa)===0?Ra(r,!1,!1):Ke(r):null,_=(s&za)!==0?Ke(n):null;return{v:c,i:_,e:Xe(()=>(i(e,c??r,_??n,d),()=>{a.delete(t)}))}}function he(a,e,r){if(a.nodes)for(var t=a.nodes.start,n=a.nodes.end,i=e&&(e.f&$)===0?e.nodes.start:r;t!==null;){var s=qa(t);if(i.before(t),t===n)return;t=s}}function re(a,e,r){e===null?a.effect.first=r:e.next=r,r===null?a.effect.last=e:r.prev=e}function da(a){var e,r,t="";if(typeof a=="string"||typeof a=="number")t+=a;else if(typeof a=="object")if(Array.isArray(a)){var n=a.length;for(e=0;e<n;e++)a[e]&&(r=da(a[e]))&&(t&&(t+=" "),t+=r)}else for(r in a)a[r]&&(t&&(t+=" "),t+=r);return t}function rt(){for(var a,e,r=0,t="",n=arguments.length;r<n;r++)(a=arguments[r])&&(e=da(a))&&(t&&(t+=" "),t+=e);return t}function st(a){return typeof a=="object"?rt(a):a??""}const aa=[...`
\r\f \v\uFEFF`];function it(a,e,r){var t=a==null?"":""+a;if(e&&(t=t?t+" "+e:e),r){for(var n in r)if(r[n])t=t?t+" "+n:n;else if(t.length)for(var i=n.length,s=0;(s=t.indexOf(n,s))>=0;){var d=s+i;(s===0||aa.includes(t[s-1]))&&(d===t.length||aa.includes(t[d]))?t=(s===0?"":t.substring(0,s))+t.substring(d+1):s=d}}return t===""?null:t}function nt(a,e){return a==null?null:String(a)}function Ye(a,e,r,t,n,i){var s=a.__className;if(B||s!==r||s===void 0){var d=it(r,t,i);(!B||d!==a.getAttribute("class"))&&(d==null?a.removeAttribute("class"):a.className=d),a.__className=r}else if(i&&n!==i)for(var c in i){var _=!!i[c];(n==null||_!==!!n[c])&&a.classList.toggle(c,_)}return i}function Ne(a,e,r,t){var n=a.__style;if(B||n!==e){var i=nt(e);(!B||i!==a.getAttribute("style"))&&(i==null?a.removeAttribute("style"):a.style.cssText=i),a.__style=e}return t}function ua(a,e,r=!1){if(a.multiple){if(e==null)return;if(!na(e))return Ja();for(var t of a.options)t.selected=e.includes(be(t));return}for(t of a.options){var n=be(t);if(Ya(n,e)){t.selected=!0;return}}(!r||e!==void 0)&&(a.selectedIndex=-1)}function ot(a){var e=new MutationObserver(()=>{ua(a,a.__value)});e.observe(a,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["value"]}),Va(()=>{e.disconnect()})}function vt(a,e,r=e){var t=new WeakSet,n=!0;Xa(a,"change",i=>{var s=i?"[selected]":":checked",d;if(a.multiple)d=[].map.call(a.querySelectorAll(s),be);else{var c=a.querySelector(s)??a.querySelector("option:not([disabled])");d=c&&be(c)}r(d),Te!==null&&t.add(Te)}),Ba(()=>{var i=e();if(a===document.activeElement){var s=Za??Te;if(t.has(s))return}if(ua(a,i,n),n&&i===void 0){var d=a.querySelector(":checked");d!==null&&(i=be(d),r(i))}a.__value=i,n=!1}),ot(a)}function be(a){return"__value"in a?a.__value:a.value}const lt=Symbol("is custom element"),ct=Symbol("is html");function ta(a,e,r,t){var n=dt(a);B&&(n[e]=a.getAttribute(e)),n[e]!==(n[e]=r)&&(r==null?a.removeAttribute(e):typeof r!="string"&&ut(a).includes(e)?a[e]=r:a.setAttribute(e,r))}function dt(a){return a.__attributes??={[lt]:a.nodeName.includes("-"),[ct]:a.namespaceURI===ja}}var ra=new Map;function ut(a){var e=a.getAttribute("is")||a.nodeName,r=ra.get(e);if(r)return r;ra.set(e,r=[]);for(var t,n=a,i=Element.prototype;i!==n;){t=Qa(n);for(var s in t)t[s].set&&r.push(s);n=Ga(n)}return r}const sa=2e3,ft=3e4;function _t(){let a=ie("disconnected"),e=null,r=sa,t=null;function n(){return`${window.location.protocol==="https:"?"wss:":"ws:"}//${window.location.host}/ws`}function i(u){try{const y=JSON.parse(u.data);switch(y.type){case"sync":{const g=y.data;g.stats&&se.set(g.stats),g.devices&&Z.set(g.devices),g.activity&&Ce.set(g.activity);break}case"stats":se.set(y.data);break;case"device_added":Z.add(y.data);break;case"device_removed":{const{serial:g}=y.data;Z.remove(g);break}case"device_updated":{const{serial:g,changes:h}=y.data;Z.update(g,h);break}case"activity":Ce.add(y.data);break;case"scenario_changed":console.log("Scenario changed:",y.data);break;case"error":console.error("WebSocket error:",y.message);break}}catch(y){console.error("Failed to parse WebSocket message:",y)}}function s(){if(!(e&&(e.readyState===WebSocket.CONNECTING||e.readyState===WebSocket.OPEN))){F(a,"connecting");try{e=new WebSocket(n()),e.onopen=()=>{F(a,"connected"),r=sa,e.send(JSON.stringify({type:"subscribe",topics:["stats","devices","activity","scenarios"]})),e.send(JSON.stringify({type:"sync"}))},e.onmessage=i,e.onclose=()=>{F(a,"disconnected"),e=null,d()},e.onerror=()=>{F(a,"error"),e?.close()}}catch(u){console.error("WebSocket connection error:",u),F(a,"error"),d()}}}function d(){t&&clearTimeout(t),t=setTimeout(()=>{t=null,s()},r),r=Math.min(r*1.5,ft)}function c(){t&&(clearTimeout(t),t=null),e&&(e.close(),e=null),F(a,"disconnected")}function _(u){e&&e.readyState===WebSocket.OPEN&&e.send(JSON.stringify(u))}return{get status(){return p(a)},connect:s,disconnect:c,send:_,sync(){_({type:"sync"})}}}const ce=_t();var pt=S('<header class="header"><div class="header-title"><h1>LIFX Emulator Monitor</h1> <span></span></div> <div class="header-controls"><button class="theme-toggle"> </button></div></header> <p class="subtitle">Real-time monitoring and device management</p>',1);function mt(a,e){ne(e,!1);const r={light:"☀",dark:"☾",system:"◐"};De();var t=pt(),n=K(t),i=v(n),s=f(v(i),2);let d;o(i);var c=f(i,2),_=v(c);_.__click=()=>Ue.toggle();var u=v(_,!0);o(_),o(c),o(n),ca(2),I(()=>{d=Ye(s,1,"status-indicator",null,d,{connecting:ce.status==="connecting",disconnected:ce.status==="disconnected",error:ce.status==="error"}),ta(s,"title",ce.status),ta(_,"title",`Toggle theme (${Ue.mode??""})`),E(u,r[Ue.mode])}),w(a,t),oe()}Je(["click"]);function qe(a){const e=a.hue/65535,r=a.saturation/65535,t=a.brightness/65535;let n,i,s;const d=Math.floor(e*6),c=e*6-d,_=t*(1-r),u=t*(1-c*r),y=t*(1-(1-c)*r);switch(d%6){case 0:n=t,i=y,s=_;break;case 1:n=u,i=t,s=_;break;case 2:n=_,i=t,s=y;break;case 3:n=_,i=u,s=t;break;case 4:n=y,i=_,s=t;break;default:n=t,i=_,s=u;break}const g=Math.round(n*255),h=Math.round(i*255),k=Math.round(s*255);return`rgb(${g}, ${h}, ${k})`}function gt(a){const e=Math.floor(a);if(e<60)return`${e}s`;if(e<3600)return`${Math.floor(e/60)}m ${e%60}s`;const r=Math.floor(e/3600),t=Math.floor(e%3600/60);return`${r}h ${t}m`}var ht=S('<div class="card"><h2><span class="status-indicator"></span> Server Statistics</h2> <div class="stats-list"><div class="stat"><span class="stat-label">Uptime</span> <span class="stat-value"> </span></div> <div class="stat"><span class="stat-label">Devices</span> <span class="stat-value"> </span></div> <div class="stat"><span class="stat-label">Packets RX</span> <span class="stat-value"> </span></div> <div class="stat"><span class="stat-label">Packets TX</span> <span class="stat-value"> </span></div> <div class="stat"><span class="stat-label">Errors</span> <span class="stat-value"> </span></div></div></div>');function bt(a,e){ne(e,!1),De();var r=ht(),t=f(v(r),2),n=v(t),i=f(v(n),2),s=v(i,!0);o(i),o(n);var d=f(n,2),c=f(v(d),2),_=v(c,!0);o(c),o(d);var u=f(d,2),y=f(v(u),2),g=v(y,!0);o(y),o(u);var h=f(u,2),k=f(v(h),2),C=v(k,!0);o(k),o(h);var l=f(h,2),b=f(v(l),2),x=v(b,!0);o(b),o(l),o(t),o(r),I(A=>{E(s,A),E(_,se.value.device_count),E(g,se.value.packets_received),E(C,se.value.packets_sent),E(x,se.value.error_count)},[()=>gt(se.value.uptime_seconds)]),w(a,r),oe()}const ze="/api";async function yt(){const a=await fetch(`${ze}/products`);if(!a.ok)throw new Error(`Failed to fetch products: ${a.status}`);return a.json()}async function wt(a){const e=await fetch(`${ze}/devices`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({product_id:a})});if(!e.ok){const r=await e.json();throw new Error(r.detail||`Failed to create device: ${e.status}`)}}async function xt(a){const e=await fetch(`${ze}/devices/${a}`,{method:"DELETE"});if(!e.ok)throw new Error(`Failed to delete device: ${e.status}`)}async function Et(){const a=await fetch(`${ze}/devices`,{method:"DELETE"});if(!a.ok)throw new Error(`Failed to remove devices: ${a.status}`);return a.json()}var St=S("<option>Loading products...</option>"),kt=S("<option> </option>"),At=S('<p style="color: var(--accent-danger); font-size: 0.85em; margin-bottom: 10px;"> </p>'),Nt=S('<div class="card"><h2>Add Device</h2> <form><div class="form-group"><label for="product-id">Product ID</label> <select id="product-id"><!></select></div> <!> <button type="submit" class="btn"> </button></form></div>');function Tt(a,e){ne(e,!0);let r=ie(Ka([])),t=ie(null),n=ie(!1),i=ie(null);ia(async()=>{try{F(r,await yt(),!0),p(r).length>0&&F(t,p(r)[0].pid,!0)}catch(x){F(i,x instanceof Error?x.message:"Failed to load products",!0)}});async function s(x){if(x.preventDefault(),p(t)!==null){F(n,!0),F(i,null);try{await wt(p(t))}catch(A){F(i,A instanceof Error?A.message:"Failed to create device",!0)}finally{F(n,!1)}}}var d=Nt(),c=f(v(d),2),_=v(c),u=f(v(_),2),y=v(u);{var g=x=>{var A=St();A.value=A.__value="",w(x,A)},h=x=>{var A=de(),M=K(A);ue(M,17,()=>p(r),R=>R.pid,(R,O)=>{var T=kt(),P=v(T);o(T);var W={};I(()=>{E(P,`${p(O).pid??""} - ${p(O).name??""}`),W!==(W=p(O).pid)&&(T.value=(T.__value=p(O).pid)??"")}),w(R,T)}),w(x,A)};z(y,x=>{p(r).length===0?x(g):x(h,!1)})}o(u),o(_);var k=f(_,2);{var C=x=>{var A=At(),M=v(A,!0);o(A),I(()=>E(M,p(i))),w(x,A)};z(k,x=>{p(i)&&x(C)})}var l=f(k,2),b=v(l,!0);o(l),o(c),o(d),I(()=>{u.disabled=p(r).length===0,l.disabled=p(n)||p(t)===null,E(b,p(n)?"Adding...":"Add Device")}),$a("submit",c,s),vt(u,()=>p(t),x=>F(t,x)),w(a,d),oe()}var Mt=S('<span class="badge badge-capability">color</span>'),Ct=S('<span class="badge badge-capability">IR</span>'),Dt=S('<span class="badge badge-extended-mz"> </span>'),zt=S('<span class="badge badge-capability"> </span>'),It=S('<span class="badge badge-capability"> </span>'),Ft=S('<span class="badge badge-capability">HEV</span>'),Rt=S('<div class="metadata-display"><div class="metadata-row"><span class="metadata-label">Firmware:</span> <span class="metadata-value"> </span></div> <div class="metadata-row"><span class="metadata-label">Vendor:</span> <span class="metadata-value"> </span></div> <div class="metadata-row"><span class="metadata-label">Product:</span> <span class="metadata-value"> </span></div> <div class="metadata-row"><span class="metadata-label">Capabilities:</span> <span class="metadata-value" style="color: var(--accent-primary);"> </span></div> <div class="metadata-row"><span class="metadata-label">Group:</span> <span class="metadata-value"> </span></div> <div class="metadata-row"><span class="metadata-label">Location:</span> <span class="metadata-value"> </span></div> <div class="metadata-row"><span class="metadata-label">Uptime:</span> <span class="metadata-value"> </span></div> <div class="metadata-row"><span class="metadata-label">WiFi Signal:</span> <span class="metadata-value"> </span></div></div>'),Ot=S('<div class="zone-segment"></div>'),Lt=S('<div class="zone-strip"></div>'),Ht=S('<button type="button" class="toggle-link"> </button> <!>',1),Pt=S('<div class="tile-zone"></div>'),Wt=S('<div class="tile-grid"></div>'),Ut=S('<div style="color: var(--text-dimmed);">No color data</div>'),qt=S('<div class="tile-item"><div class="tile-label"></div> <!></div>'),Xt=S('<div class="tiles-container"></div>'),Bt=S('<button type="button" class="toggle-link"> </button> <!>',1),Vt=S('<div style="margin-top: 4px;"><span class="color-swatch"></span> <span style="color: var(--text-muted); font-size: 0.75em;">Current color</span></div>'),Jt=S('<div class="device"><div class="device-header"><div><div class="device-serial"> </div> <div class="device-label"> </div></div> <button class="btn btn-delete btn-sm"> </button></div> <div class="badges"><span> </span> <span class="badge badge-capability"> </span> <!> <!> <!> <!> <!></div> <button type="button" class="toggle-link"> </button> <!> <!></div>');function Yt(a,e){ne(e,!0);let r=ie(!1);async function t(){if(confirm(`Delete device ${e.device.serial}?`)){F(r,!0);try{await xt(e.device.serial)}catch(m){alert(m instanceof Error?m.message:"Failed to delete device")}finally{F(r,!1)}}}function n(m){return`${Math.floor(m/1e9)}s`}function i(){const m=[];return e.device.has_color&&m.push("Color"),e.device.has_infrared&&m.push("Infrared"),e.device.has_multizone&&m.push(`Multizone (${e.device.zone_count} zones)`),e.device.has_extended_multizone&&m.push("Extended Multizone"),e.device.has_matrix&&m.push(`Matrix (${e.device.tile_count} tiles)`),e.device.has_hev&&m.push("HEV/Clean"),e.device.has_relays&&m.push("Relays"),e.device.has_buttons&&m.push("Buttons"),m.join(", ")||"None"}let s=$e(()=>me.isZonesExpanded(e.device.serial)),d=$e(()=>me.isMetadataExpanded(e.device.serial));var c=Jt(),_=v(c),u=v(_),y=v(u),g=v(y,!0);o(y);var h=f(y,2),k=v(h,!0);o(h),o(u);var C=f(u,2);C.__click=t;var l=v(C,!0);o(C),o(_);var b=f(_,2),x=v(b);let A;var M=v(x,!0);o(x);var R=f(x,2),O=v(R);o(R);var T=f(R,2);{var P=m=>{var N=Mt();w(m,N)};z(T,m=>{e.device.has_color&&m(P)})}var W=f(T,2);{var D=m=>{var N=Ct();w(m,N)};z(W,m=>{e.device.has_infrared&&m(D)})}var ve=f(W,2);{var fe=m=>{var N=Dt(),L=v(N);o(N),I(()=>E(L,`extended-mz×${e.device.zone_count??""}`)),w(m,N)},Ie=m=>{var N=de(),L=K(N);{var ee=j=>{var H=zt(),U=v(H);o(H),I(()=>E(U,`multizone×${e.device.zone_count??""}`)),w(j,H)};z(L,j=>{e.device.has_multizone&&j(ee)},!0)}w(m,N)};z(ve,m=>{e.device.has_extended_multizone?m(fe):m(Ie,!1)})}var Ze=f(ve,2);{var fa=m=>{var N=It(),L=v(N);o(N),I(()=>E(L,`matrix×${e.device.tile_count??""}`)),w(m,N)};z(Ze,m=>{e.device.has_matrix&&m(fa)})}var _a=f(Ze,2);{var pa=m=>{var N=Ft();w(m,N)};z(_a,m=>{e.device.has_hev&&m(pa)})}o(b);var ye=f(b,2);ye.__click=()=>me.toggleMetadataExpanded(e.device.serial);var ma=v(ye);o(ye);var je=f(ye,2);{var ga=m=>{var N=Rt(),L=v(N),ee=f(v(L),2),j=v(ee);o(ee),o(L);var H=f(L,2),U=f(v(H),2),q=v(U,!0);o(U),o(H);var G=f(H,2),V=f(v(G),2),J=v(V,!0);o(V),o(G);var X=f(G,2),ae=f(v(X),2),Fe=v(ae,!0);o(ae),o(X);var Y=f(X,2),we=f(v(Y),2),_e=v(we,!0);o(we),o(Y);var le=f(Y,2),xe=f(v(le),2),Re=v(xe,!0);o(xe),o(le);var pe=f(le,2),Q=f(v(pe),2),te=v(Q,!0);o(Q),o(pe);var Ee=f(pe,2),Se=f(v(Ee),2),ke=v(Se);o(Se),o(Ee),o(N),I((Oe,wa,xa)=>{E(j,`${e.device.version_major??""}.${e.device.version_minor??""}`),E(q,e.device.vendor),E(J,e.device.product),E(Fe,Oe),E(_e,e.device.group_label),E(Re,e.device.location_label),E(te,wa),E(ke,`${xa??""} dBm`)},[i,()=>n(e.device.uptime_ns),()=>e.device.wifi_signal.toFixed(1)]),w(m,N)};z(je,m=>{p(d)&&m(ga)})}var ha=f(je,2);{var ba=m=>{var N=Ht(),L=K(N);L.__click=()=>me.toggleZonesExpanded(e.device.serial);var ee=v(L);o(L);var j=f(L,2);{var H=U=>{var q=Lt();ue(q,21,()=>e.device.zone_colors,Me,(G,V)=>{var J=Ot();I(X=>Ne(J,`background: ${X??""};`),[()=>qe(p(V))]),w(G,J)}),o(q),w(U,q)};z(j,U=>{p(s)&&U(H)})}I(()=>E(ee,`${p(s)?"▾":"▸"} ${p(s)?"Hide":"Show"} zones (${e.device.zone_colors.length??""})`)),w(m,N)},ya=m=>{var N=de(),L=K(N);{var ee=H=>{var U=Bt(),q=K(U);q.__click=()=>me.toggleZonesExpanded(e.device.serial);var G=v(q);o(q);var V=f(q,2);{var J=X=>{var ae=Xt();ue(ae,21,()=>e.device.tile_devices,Me,(Fe,Y,we)=>{var _e=qt(),le=v(_e);le.textContent=`T${we+1}`;var xe=f(le,2);{var Re=Q=>{var te=Wt();ue(te,21,()=>p(Y).colors.slice(0,(p(Y).width||8)*(p(Y).height||8)),Me,(Ee,Se)=>{var ke=Pt();I(Oe=>Ne(ke,`background: ${Oe??""};`),[()=>qe(p(Se))]),w(Ee,ke)}),o(te),I(()=>Ne(te,`grid-template-columns: repeat(${(p(Y).width||8)??""}, 8px);`)),w(Q,te)},pe=Q=>{var te=Ut();w(Q,te)};z(xe,Q=>{p(Y).colors&&p(Y).colors.length>0?Q(Re):Q(pe,!1)})}o(_e),w(Fe,_e)}),o(ae),w(X,ae)};z(V,X=>{p(s)&&X(J)})}I(()=>E(G,`${p(s)?"▾":"▸"} ${p(s)?"Hide":"Show"} tiles (${e.device.tile_devices.length??""})`)),w(H,U)},j=H=>{var U=de(),q=K(U);{var G=V=>{var J=Vt(),X=v(J);ca(2),o(J),I(ae=>Ne(X,`background: ${ae??""};`),[()=>qe(e.device.color)]),w(V,J)};z(q,V=>{e.device.has_color&&e.device.color&&V(G)},!0)}w(H,U)};z(L,H=>{e.device.has_matrix&&e.device.tile_devices&&e.device.tile_devices.length>0?H(ee):H(j,!1)},!0)}w(m,N)};z(ha,m=>{e.device.has_multizone&&e.device.zone_colors&&e.device.zone_colors.length>0?m(ba):m(ya,!1)})}o(c),I(()=>{E(g,e.device.serial),E(k,e.device.label),C.disabled=p(r),E(l,p(r)?"...":"Del"),A=Ye(x,1,"badge",null,A,{"badge-power-on":e.device.power_level>0,"badge-power-off":e.device.power_level===0}),E(M,e.device.power_level>0?"ON":"OFF"),E(O,`P${e.device.product??""}`),E(ma,`${p(d)?"▾":"▸"} ${p(d)?"Hide":"Show"} metadata`)}),w(a,c),oe()}Je(["click"]);var Zt=S('<div class="no-devices">No devices emulated</div>'),jt=S('<div class="devices-grid"></div>'),Gt=S('<div class="card"><h2 style="display: flex; justify-content: space-between; align-items: center;"><span> </span> <button class="btn btn-delete" title="Remove all devices from server (runtime only)"> </button></h2> <!></div>');function Qt(a,e){ne(e,!0);let r=ie(!1);async function t(){if(Z.count===0){alert("No devices to remove");return}const h=`Remove all ${Z.count} device(s) from the server?

This will stop all devices from responding to LIFX protocol packets, but will not delete persistent storage.`;if(confirm(h)){F(r,!0);try{const k=await Et();alert(k.message)}catch(k){alert(k instanceof Error?k.message:"Failed to remove devices")}finally{F(r,!1)}}}var n=Gt(),i=v(n),s=v(i),d=v(s);o(s);var c=f(s,2);c.__click=t;var _=v(c,!0);o(c),o(i);var u=f(i,2);{var y=h=>{var k=Zt();w(h,k)},g=h=>{var k=jt();ue(k,21,()=>Z.list,C=>C.serial,(C,l)=>{Yt(C,{get device(){return p(l)}})}),o(k),w(h,k)};z(u,h=>{Z.count===0?h(y):h(g,!1)})}o(n),I(()=>{E(d,`Devices (${Z.count??""})`),c.disabled=p(r)||Z.count===0,E(_,p(r)?"Removing...":"Remove All")}),w(a,n),oe()}Je(["click"]);var Kt=S('<div style="color: var(--text-dimmed);">No activity yet</div>'),$t=S('<div class="activity-item"><span class="activity-time"> </span> <span> </span> <span class="activity-packet"> </span> <span class="device-serial"> </span> <span style="color: var(--text-dimmed);"> </span></div>'),er=S('<div class="card"><h2>Recent Activity</h2> <div class="activity-log"><!></div></div>');function ar(a,e){ne(e,!1);function r(s){return new Date(s*1e3).toLocaleTimeString()}De();var t=de(),n=K(t);{var i=s=>{var d=er(),c=f(v(d),2),_=v(c);{var u=g=>{var h=Kt();w(g,h)},y=g=>{var h=de(),k=K(h);ue(k,1,()=>Ce.reversed,Me,(C,l)=>{var b=$t(),x=v(b),A=v(x,!0);o(x);var M=f(x,2),R=v(M,!0);o(M);var O=f(M,2),T=v(O,!0);o(O);var P=f(O,2),W=v(P,!0);o(P);var D=f(P,2),ve=v(D,!0);o(D),o(b),I((fe,Ie)=>{E(A,fe),Ye(M,1,st(p(l).direction==="rx"?"activity-rx":"activity-tx")),E(R,Ie),E(T,p(l).packet_name),E(W,p(l).device||p(l).target||"N/A"),E(ve,p(l).addr)},[()=>r(p(l).timestamp),()=>p(l).direction.toUpperCase()]),w(C,b)}),w(g,h)};z(_,g=>{Ce.count===0?g(u):g(y,!1)})}o(c),o(d),w(s,d)};z(n,s=>{se.value.activity_enabled&&s(i)})}w(a,t),oe()}var tr=S('<div class="container"><!> <div class="grid"><!> <!></div> <!> <div style="margin-top: 25px;"><!></div></div>');function cr(a,e){ne(e,!1),ia(()=>{ce.connect()}),Ea(()=>{ce.disconnect()}),De();var r=tr(),t=v(r);mt(t,{});var n=f(t,2),i=v(n);bt(i,{});var s=f(i,2);Tt(s,{}),o(n);var d=f(n,2);Qt(d,{});var c=f(d,2),_=v(c);ar(_,{}),o(c),o(r),w(a,r),oe()}export{cr as component};
