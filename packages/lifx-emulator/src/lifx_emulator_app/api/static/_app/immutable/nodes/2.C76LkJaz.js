import{a as w,f as S,c as fe}from"../chunks/CM0W4ud5.js";import{i as sa}from"../chunks/oI0JkNSl.js";import{o as ga,a as Ra}from"../chunks/B_L6UN-Y.js";import{h as Y,a as La,b as za,w as f,r as Fa,H as Ia,s as oa,c as Ze,d as Ge,k as Oe,S as Oa,aw as Ha,af as va,e as ne,j as ta,l as Pa,aH as Wa,aN as ha,au as na,aO as Ua,a1 as ca,aP as Xa,aQ as qa,aL as Va,L as Ba,i as je,aR as le,aS as ba,f as ya,p as wa,aT as Ke,a3 as xa,aU as Ya,aV as Ja,at as Za,g as Ga,U as ja,aW as Ea,V as Ka,am as Qa,aX as $a,aY as et,aZ as ka,a_ as at,a$ as tt,b0 as rt,b1 as it,b2 as st,aM as nt,q as lt,a0 as ot,Y as N,W as K,B as _e,C as te,D as H,F as me,G as o,J as c,I as l,ag as Sa,X as vt,Z as ra}from"../chunks/BOE2s64r.js";import{a as We,d as V,s as ue,t as Qe,u as Se}from"../chunks/B0EuJDkz.js";import{d as Ce,s as x,e as ct}from"../chunks/BzinYOwG.js";import{i as F}from"../chunks/C0nK52XN.js";function Pe(e,a){return a}function dt(e,a,r){for(var t=[],i=a.length,s,n=a.length,_=0;_<i;_++){let p=a[_];wa(p,()=>{if(s){if(s.pending.delete(p),s.done.add(p),s.pending.size===0){var h=e.outrogroups;ia(na(s.done)),h.delete(s),h.size===0&&(e.outrogroups=null)}}else n-=1},!1)}if(n===0){var d=t.length===0&&r!==null;if(d){var m=r,v=m.parentNode;Za(v),v.append(m),e.items.clear()}ia(a,!d)}else s={pending:new Set(a),done:new Set},(e.outrogroups??=new Set).add(s)}function ia(e,a=!0){for(var r=0;r<e.length;r++)Ga(e[r],a)}var da;function ye(e,a,r,t,i,s=null){var n=e,_=new Map,d=(a&ba)!==0;if(d){var m=e;n=Y?Ze(Ba(m)):m.appendChild(je())}Y&&La();var v=null,p=Wa(()=>{var y=r();return ha(y)?y:y==null?[]:na(y)}),h,b=!0;function k(){u.fallback=v,ut(u,h,n,a,t),v!==null&&(h.length===0?(v.f&le)===0?ya(v):(v.f^=le,Ne(v,null,n)):wa(v,()=>{v=null}))}var T=za(()=>{h=f(p);var y=h.length;let I=!1;if(Y){var W=Fa(n)===Ia;W!==(y===0)&&(n=oa(),Ze(n),Ge(!1),I=!0)}for(var R=new Set,U=ne,J=Pa(),L=0;L<y;L+=1){Y&&Oe.nodeType===Oa&&Oe.data===Ha&&(n=Oe,I=!0,Ge(!1));var E=h[L],M=t(E,L),D=b?null:_.get(M);D?(D.v&&va(D.v,E),D.i&&va(D.i,L),J&&U.skipped_effects.delete(D.e)):(D=ft(_,b?n:da??=je(),E,M,L,i,a,r),b||(D.e.f|=le),_.set(M,D)),R.add(M)}if(y===0&&s&&!v&&(b?v=ta(()=>s(n)):(v=ta(()=>s(da??=je())),v.f|=le)),Y&&y>0&&Ze(oa()),!b)if(J){for(const[Q,C]of _)R.has(Q)||U.skipped_effects.add(C.e);U.oncommit(k),U.ondiscard(()=>{})}else k();I&&Ge(!0),f(p)}),u={effect:T,items:_,outrogroups:null,fallback:v};b=!1,Y&&(n=Oe)}function Ae(e){for(;e!==null&&(e.f&Ya)===0;)e=e.next;return e}function ut(e,a,r,t,i){var s=(t&Ja)!==0,n=a.length,_=e.items,d=Ae(e.effect.first),m,v=null,p,h=[],b=[],k,T,u,y;if(s)for(y=0;y<n;y+=1)k=a[y],T=i(k,y),u=_.get(T).e,(u.f&le)===0&&(u.nodes?.a?.measure(),(p??=new Set).add(u));for(y=0;y<n;y+=1){if(k=a[y],T=i(k,y),u=_.get(T).e,e.outrogroups!==null)for(const D of e.outrogroups)D.pending.delete(u),D.done.delete(u);if((u.f&le)!==0)if(u.f^=le,u===d)Ne(u,null,r);else{var I=v?v.next:d;u===e.effect.last&&(e.effect.last=u.prev),u.prev&&(u.prev.next=u.next),u.next&&(u.next.prev=u.prev),de(e,v,u),de(e,u,I),Ne(u,I,r),v=u,h=[],b=[],d=Ae(v.next);continue}if((u.f&Ke)!==0&&(ya(u),s&&(u.nodes?.a?.unfix(),(p??=new Set).delete(u))),u!==d){if(m!==void 0&&m.has(u)){if(h.length<b.length){var W=b[0],R;v=W.prev;var U=h[0],J=h[h.length-1];for(R=0;R<h.length;R+=1)Ne(h[R],W,r);for(R=0;R<b.length;R+=1)m.delete(b[R]);de(e,U.prev,J.next),de(e,v,U),de(e,J,W),d=W,v=J,y-=1,h=[],b=[]}else m.delete(u),Ne(u,d,r),de(e,u.prev,u.next),de(e,u,v===null?e.effect.first:v.next),de(e,v,u),v=u;continue}for(h=[],b=[];d!==null&&d!==u;)(m??=new Set).add(d),b.push(d),d=Ae(d.next);if(d===null)continue}(u.f&le)===0&&h.push(u),v=u,d=Ae(u.next)}if(e.outrogroups!==null){for(const D of e.outrogroups)D.pending.size===0&&(ia(na(D.done)),e.outrogroups?.delete(D));e.outrogroups.size===0&&(e.outrogroups=null)}if(d!==null||m!==void 0){var L=[];if(m!==void 0)for(u of m)(u.f&Ke)===0&&L.push(u);for(;d!==null;)(d.f&Ke)===0&&d!==e.fallback&&L.push(d),d=Ae(d.next);var E=L.length;if(E>0){var M=(t&ba)!==0&&n===0?r:null;if(s){for(y=0;y<E;y+=1)L[y].nodes?.a?.measure();for(y=0;y<E;y+=1)L[y].nodes?.a?.fix()}dt(e,L,M)}}s&&xa(()=>{if(p!==void 0)for(u of p)u.nodes?.a?.apply()})}function ft(e,a,r,t,i,s,n,_){var d=(n&Xa)!==0?(n&qa)===0?Va(r,!1,!1):ca(r):null,m=(n&Ua)!==0?ca(i):null;return{v:d,i:m,e:ta(()=>(s(a,d??r,m??i,_),()=>{e.delete(t)}))}}function Ne(e,a,r){if(e.nodes)for(var t=e.nodes.start,i=e.nodes.end,s=a&&(a.f&le)===0?a.nodes.start:r;t!==null;){var n=ja(t);if(s.before(t),t===i)return;t=n}}function de(e,a,r){a===null?e.effect.first=r:a.next=r,r===null?e.effect.last=a:r.prev=a}function Aa(e){var a,r,t="";if(typeof e=="string"||typeof e=="number")t+=e;else if(typeof e=="object")if(Array.isArray(e)){var i=e.length;for(a=0;a<i;a++)e[a]&&(r=Aa(e[a]))&&(t&&(t+=" "),t+=r)}else for(r in e)e[r]&&(t&&(t+=" "),t+=r);return t}function _t(){for(var e,a,r=0,t="",i=arguments.length;r<i;r++)(e=arguments[r])&&(a=Aa(e))&&(t&&(t+=" "),t+=a);return t}function mt(e){return typeof e=="object"?_t(e):e??""}const ua=[...`
\r\f \v\uFEFF`];function pt(e,a,r){var t=e==null?"":""+e;if(a&&(t=t?t+" "+a:a),r){for(var i in r)if(r[i])t=t?t+" "+i:i;else if(t.length)for(var s=i.length,n=0;(n=t.indexOf(i,n))>=0;){var _=n+s;(n===0||ua.includes(t[n-1]))&&(_===t.length||ua.includes(t[_]))?t=(n===0?"":t.substring(0,n))+t.substring(_+1):n=_}}return t===""?null:t}function gt(e,a){return e==null?null:String(e)}function la(e,a,r,t,i,s){var n=e.__className;if(Y||n!==r||n===void 0){var _=pt(r,t,s);(!Y||_!==e.getAttribute("class"))&&(_==null?e.removeAttribute("class"):e.className=_),e.__className=r}else if(s&&i!==s)for(var d in s){var m=!!s[d];(i==null||m!==!!i[d])&&e.classList.toggle(d,m)}return s}function He(e,a,r,t){var i=e.__style;if(Y||i!==a){var s=gt(a);(!Y||s!==e.getAttribute("style"))&&(s==null?e.removeAttribute("style"):e.style.cssText=s),e.__style=a}return t}function Na(e,a,r=!1){if(e.multiple){if(a==null)return;if(!ha(a))return $a();for(var t of e.options)t.selected=a.includes(Te(t));return}for(t of e.options){var i=Te(t);if(et(i,a)){t.selected=!0;return}}(!r||a!==void 0)&&(e.selectedIndex=-1)}function ht(e){var a=new MutationObserver(()=>{Na(e,e.__value)});a.observe(e,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["value"]}),Qa(()=>{a.disconnect()})}function Ta(e,a,r=a){var t=new WeakSet,i=!0;Ea(e,"change",s=>{var n=s?"[selected]":":checked",_;if(e.multiple)_=[].map.call(e.querySelectorAll(n),Te);else{var d=e.querySelector(n)??e.querySelector("option:not([disabled])");_=d&&Te(d)}r(_),ne!==null&&t.add(ne)}),Ka(()=>{var s=a();if(e===document.activeElement){var n=ka??ne;if(t.has(n))return}if(Na(e,s,i),i&&s===void 0){var _=e.querySelector(":checked");_!==null&&(s=Te(_),r(s))}e.__value=s,i=!1}),ht(e)}function Te(e){return"__value"in e?e.__value:e.value}const bt=Symbol("is custom element"),yt=Symbol("is html");function fa(e){if(Y){var a=!1,r=()=>{if(!a){if(a=!0,e.hasAttribute("value")){var t=e.value;Me(e,"value",null),e.value=t}if(e.hasAttribute("checked")){var i=e.checked;Me(e,"checked",null),e.checked=i}}};e.__on_r=r,xa(r),it()}}function Me(e,a,r,t){var i=wt(e);Y&&(i[a]=e.getAttribute(a),a==="src"||a==="srcset"||a==="href"&&e.nodeName==="LINK")||i[a]!==(i[a]=r)&&(a==="loading"&&(e[st]=r),r==null?e.removeAttribute(a):typeof r!="string"&&xt(e).includes(a)?e[a]=r:e.setAttribute(a,r))}function wt(e){return e.__attributes??={[bt]:e.nodeName.includes("-"),[yt]:e.namespaceURI===at}}var _a=new Map;function xt(e){var a=e.getAttribute("is")||e.nodeName,r=_a.get(a);if(r)return r;_a.set(a,r=[]);for(var t,i=e,s=Element.prototype;s!==i;){t=rt(i);for(var n in t)t[n].set&&r.push(n);i=tt(i)}return r}function ma(e,a,r=a){var t=new WeakSet;Ea(e,"input",async i=>{var s=i?e.defaultValue:e.value;if(s=$e(e)?ea(s):s,r(s),ne!==null&&t.add(ne),await nt(),s!==(s=a())){var n=e.selectionStart,_=e.selectionEnd,d=e.value.length;if(e.value=s??"",_!==null){var m=e.value.length;n===_&&_===d&&m>d?(e.selectionStart=m,e.selectionEnd=m):(e.selectionStart=n,e.selectionEnd=Math.min(_,m))}}}),(Y&&e.defaultValue!==e.value||lt(a)==null&&e.value)&&(r($e(e)?ea(e.value):e.value),ne!==null&&t.add(ne)),ot(()=>{var i=a();if(e===document.activeElement){var s=ka??ne;if(t.has(s))return}$e(e)&&i===ea(e.value)||e.type==="date"&&!i&&!e.value||i!==e.value&&(e.value=i??"")})}function $e(e){var a=e.type;return a==="number"||a==="range"}function ea(e){return e===""?null:+e}const pa=2e3,Et=3e4;function kt(){let e=K("disconnected"),a=null,r=pa,t=null;function i(){return`${window.location.protocol==="https:"?"wss:":"ws:"}//${window.location.host}/ws`}function s(v){try{const p=JSON.parse(v.data);switch(p.type){case"sync":{const h=p.data;h.stats&&ue.set(h.stats),h.devices&&V.set(h.devices),h.activity&&We.set(h.activity);break}case"stats":ue.set(p.data);break;case"device_added":V.add(p.data);break;case"device_removed":{const{serial:h}=p.data;V.remove(h);break}case"device_updated":{const{serial:h,changes:b}=p.data;V.update(h,b);break}case"activity":We.add(p.data);break;case"scenario_changed":console.log("Scenario changed:",p.data);break;case"error":console.error("WebSocket error:",p.message);break}}catch(p){console.error("Failed to parse WebSocket message:",p)}}function n(){if(!(a&&(a.readyState===WebSocket.CONNECTING||a.readyState===WebSocket.OPEN))){N(e,"connecting");try{a=new WebSocket(i()),a.onopen=()=>{N(e,"connected"),r=pa,a.send(JSON.stringify({type:"subscribe",topics:["stats","devices","activity","scenarios"]})),a.send(JSON.stringify({type:"sync"}))},a.onmessage=s,a.onclose=()=>{N(e,"disconnected"),a=null,_()},a.onerror=()=>{N(e,"error"),a?.close()}}catch(v){console.error("WebSocket connection error:",v),N(e,"error"),_()}}}function _(){t&&clearTimeout(t),t=setTimeout(()=>{t=null,n()},r),r=Math.min(r*1.5,Et)}function d(){t&&(clearTimeout(t),t=null),a&&(a.close(),a=null),N(e,"disconnected")}function m(v){a&&a.readyState===WebSocket.OPEN&&a.send(JSON.stringify(v))}return{get status(){return f(e)},connect:n,disconnect:d,send:m,sync(){m({type:"sync"})}}}const be=kt();var St=S('<header class="header"><div class="header-title"><h1>LIFX Emulator Monitor</h1> <span></span></div> <div class="header-controls"><button class="theme-toggle"> </button></div></header> <p class="subtitle">Real-time monitoring and device management</p>',1);function At(e,a){_e(a,!1);const r={light:"☀",dark:"☾",system:"◐"};sa();var t=St(),i=te(t),s=o(i),n=c(o(s),2);let _;l(s);var d=c(s,2),m=o(d);m.__click=()=>Qe.toggle();var v=o(m,!0);l(m),l(d),l(i),Sa(2),H(()=>{_=la(n,1,"status-indicator",null,_,{connecting:be.status==="connecting",disconnected:be.status==="disconnected",error:be.status==="error"}),Me(n,"title",be.status),Me(m,"title",`Toggle theme (${Qe.mode??""})`),x(v,r[Qe.mode])}),w(e,t),me()}Ce(["click"]);function aa(e){const a=e.hue/65535,r=e.saturation/65535,t=e.brightness/65535;let i,s,n;const _=Math.floor(a*6),d=a*6-_,m=t*(1-r),v=t*(1-d*r),p=t*(1-(1-d)*r);switch(_%6){case 0:i=t,s=p,n=m;break;case 1:i=v,s=t,n=m;break;case 2:i=m,s=t,n=p;break;case 3:i=m,s=v,n=t;break;case 4:i=p,s=m,n=t;break;default:i=t,s=m,n=v;break}const h=Math.round(i*255),b=Math.round(s*255),k=Math.round(n*255);return`rgb(${h}, ${b}, ${k})`}function Nt(e){const a=Math.floor(e);if(a<60)return`${a}s`;if(a<3600)return`${Math.floor(a/60)}m ${a%60}s`;const r=Math.floor(a/3600),t=Math.floor(a%3600/60);return`${r}h ${t}m`}var Tt=S('<div class="card"><h2><span class="status-indicator"></span> Server Statistics</h2> <div class="stats-list"><div class="stat"><span class="stat-label">Uptime</span> <span class="stat-value"> </span></div> <div class="stat"><span class="stat-label">Devices</span> <span class="stat-value"> </span></div> <div class="stat"><span class="stat-label">Packets RX</span> <span class="stat-value"> </span></div> <div class="stat"><span class="stat-label">Packets TX</span> <span class="stat-value"> </span></div> <div class="stat"><span class="stat-label">Errors</span> <span class="stat-value"> </span></div></div></div>');function Mt(e,a){_e(a,!1),sa();var r=Tt(),t=c(o(r),2),i=o(t),s=c(o(i),2),n=o(s,!0);l(s),l(i);var _=c(i,2),d=c(o(_),2),m=o(d,!0);l(d),l(_);var v=c(_,2),p=c(o(v),2),h=o(p,!0);l(p),l(v);var b=c(v,2),k=c(o(b),2),T=o(k,!0);l(k),l(b);var u=c(b,2),y=c(o(u),2),I=o(y,!0);l(y),l(u),l(t),l(r),H(W=>{x(n,W),x(m,ue.value.device_count),x(h,ue.value.packets_received),x(T,ue.value.packets_sent),x(I,ue.value.error_count)},[()=>Nt(ue.value.uptime_seconds)]),w(e,r),me()}const Ue="/api";async function Ct(){const e=await fetch(`${Ue}/products`);if(!e.ok)throw new Error(`Failed to fetch products: ${e.status}`);return e.json()}async function Dt(e){const a=await fetch(`${Ue}/devices`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({product_id:e})});if(!a.ok){const r=await a.json();throw new Error(r.detail||`Failed to create device: ${a.status}`)}}async function Rt(e){const a=await fetch(`${Ue}/devices/${e}`,{method:"DELETE"});if(!a.ok)throw new Error(`Failed to delete device: ${a.status}`)}async function Ma(){const e=await fetch(`${Ue}/devices`,{method:"DELETE"});if(!e.ok)throw new Error(`Failed to remove devices: ${e.status}`);return e.json()}var Lt=S("<option>Loading products...</option>"),zt=S("<option> </option>"),Ft=S('<p style="color: var(--accent-danger); font-size: 0.85em; margin-top: 10px;"> </p>'),It=S('<div class="card"><div class="toolbar-header"><h2>Device Management</h2> <button class="btn btn-delete"> </button></div> <form><div class="form-row"><div class="form-group"><label for="product-id">Product</label> <select id="product-id"><!></select></div> <button type="submit" class="btn"> </button></div> <!></form></div>');function Ot(e,a){_e(a,!0);let r=K(vt([])),t=K(null),i=K(!1),s=K(!1),n=K(null);ga(async()=>{try{N(r,await Ct(),!0),f(r).length>0&&N(t,f(r)[0].pid,!0)}catch(E){N(n,E instanceof Error?E.message:"Failed to load products",!0)}});async function _(E){if(E.preventDefault(),f(t)!==null){N(i,!0),N(n,null);try{await Dt(f(t))}catch(M){N(n,M instanceof Error?M.message:"Failed to create device",!0)}finally{N(i,!1)}}}async function d(){if(V.count!==0&&confirm(`Remove all ${V.count} devices?`)){N(s,!0),N(n,null);try{const E=await Ma();console.log(`Removed ${E.removed} devices`)}catch(E){N(n,E instanceof Error?E.message:"Failed to remove devices",!0)}finally{N(s,!1)}}}var m=It(),v=o(m),p=c(o(v),2);p.__click=d;var h=o(p,!0);l(p),l(v);var b=c(v,2),k=o(b),T=o(k),u=c(o(T),2),y=o(u);{var I=E=>{var M=Lt();M.value=M.__value="",w(E,M)},W=E=>{var M=fe(),D=te(M);ye(D,17,()=>f(r),Q=>Q.pid,(Q,C)=>{var X=zt(),pe=o(X);l(X);var ge={};H(()=>{x(pe,`${f(C).pid??""} - ${f(C).name??""}`),ge!==(ge=f(C).pid)&&(X.value=(X.__value=f(C).pid)??"")}),w(Q,X)}),w(E,M)};F(y,E=>{f(r).length===0?E(I):E(W,!1)})}l(u),l(T);var R=c(T,2),U=o(R,!0);l(R),l(k);var J=c(k,2);{var L=E=>{var M=Ft(),D=o(M,!0);l(M),H(()=>x(D,f(n))),w(E,M)};F(J,E=>{f(n)&&E(L)})}l(b),l(m),H(()=>{p.disabled=f(s)||V.count===0,Me(p,"title",V.count===0?"No devices to remove":"Remove all devices"),x(h,f(s)?"Removing...":"Remove All"),u.disabled=f(r).length===0,R.disabled=f(i)||f(t)===null,x(U,f(i)?"Adding...":"Add Device")}),ct("submit",b,_),Ta(u,()=>f(t),E=>N(t,E)),w(e,m),me()}Ce(["click"]);var Ht=S('<span class="badge badge-capability">color</span>'),Pt=S('<span class="badge badge-capability">IR</span>'),Wt=S('<span class="badge badge-extended-mz"> </span>'),Ut=S('<span class="badge badge-capability"> </span>'),Xt=S('<span class="badge badge-capability"> </span>'),qt=S('<span class="badge badge-capability">HEV</span>'),Vt=S('<div class="metadata-display"><div class="metadata-row"><span class="metadata-label">Firmware:</span> <span class="metadata-value"> </span></div> <div class="metadata-row"><span class="metadata-label">Vendor:</span> <span class="metadata-value"> </span></div> <div class="metadata-row"><span class="metadata-label">Product:</span> <span class="metadata-value"> </span></div> <div class="metadata-row"><span class="metadata-label">Capabilities:</span> <span class="metadata-value" style="color: var(--accent-primary);"> </span></div> <div class="metadata-row"><span class="metadata-label">Group:</span> <span class="metadata-value"> </span></div> <div class="metadata-row"><span class="metadata-label">Location:</span> <span class="metadata-value"> </span></div> <div class="metadata-row"><span class="metadata-label">Uptime:</span> <span class="metadata-value"> </span></div> <div class="metadata-row"><span class="metadata-label">WiFi Signal:</span> <span class="metadata-value"> </span></div></div>'),Bt=S('<div class="zone-segment"></div>'),Yt=S('<div class="zone-strip"></div>'),Jt=S('<button type="button" class="toggle-link"> </button> <!>',1),Zt=S('<div class="tile-zone"></div>'),Gt=S('<div class="tile-grid"></div>'),jt=S('<div style="color: var(--text-dimmed);">No color data</div>'),Kt=S('<div class="tile-item"><div class="tile-label"></div> <!></div>'),Qt=S('<div class="tiles-container"></div>'),$t=S('<button type="button" class="toggle-link"> </button> <!>',1),er=S('<div style="margin-top: 4px;"><span class="color-swatch"></span> <span style="color: var(--text-muted); font-size: 0.75em;">Current color</span></div>'),ar=S('<div class="device"><div class="device-header"><div><div class="device-serial"> </div> <div class="device-label"> </div></div> <button class="btn btn-delete btn-sm"> </button></div> <div class="badges"><span> </span> <span class="badge badge-capability"> </span> <!> <!> <!> <!> <!></div> <button type="button" class="toggle-link"> </button> <!> <!></div>');function tr(e,a){_e(a,!0);let r=K(!1);async function t(){if(confirm(`Delete device ${a.device.serial}?`)){N(r,!0);try{await Rt(a.device.serial)}catch(g){alert(g instanceof Error?g.message:"Failed to delete device")}finally{N(r,!1)}}}function i(g){return`${Math.floor(g/1e9)}s`}function s(){const g=[];return a.device.has_color&&g.push("Color"),a.device.has_infrared&&g.push("Infrared"),a.device.has_multizone&&g.push(`Multizone (${a.device.zone_count} zones)`),a.device.has_extended_multizone&&g.push("Extended Multizone"),a.device.has_matrix&&g.push(`Matrix (${a.device.tile_count} tiles)`),a.device.has_hev&&g.push("HEV/Clean"),a.device.has_relays&&g.push("Relays"),a.device.has_buttons&&g.push("Buttons"),g.join(", ")||"None"}let n=ra(()=>Se.isZonesExpanded(a.device.serial)),_=ra(()=>Se.isMetadataExpanded(a.device.serial));var d=ar(),m=o(d),v=o(m),p=o(v),h=o(p,!0);l(p);var b=c(p,2),k=o(b,!0);l(b),l(v);var T=c(v,2);T.__click=t;var u=o(T,!0);l(T),l(m);var y=c(m,2),I=o(y);let W;var R=o(I,!0);l(I);var U=c(I,2),J=o(U);l(U);var L=c(U,2);{var E=g=>{var A=Ht();w(g,A)};F(L,g=>{a.device.has_color&&g(E)})}var M=c(L,2);{var D=g=>{var A=Pt();w(g,A)};F(M,g=>{a.device.has_infrared&&g(D)})}var Q=c(M,2);{var C=g=>{var A=Wt(),z=o(A);l(A),H(()=>x(z,`extended-mz×${a.device.zone_count??""}`)),w(g,A)},X=g=>{var A=fe(),z=te(A);{var $=B=>{var O=Ut(),P=o(O);l(O),H(()=>x(P,`multizone×${a.device.zone_count??""}`)),w(B,O)};F(z,B=>{a.device.has_multizone&&B($)},!0)}w(g,A)};F(Q,g=>{a.device.has_extended_multizone?g(C):g(X,!1)})}var pe=c(Q,2);{var ge=g=>{var A=Xt(),z=o(A);l(A),H(()=>x(z,`matrix×${a.device.tile_count??""}`)),w(g,A)};F(pe,g=>{a.device.has_matrix&&g(ge)})}var Xe=c(pe,2);{var oe=g=>{var A=qt();w(g,A)};F(Xe,g=>{a.device.has_hev&&g(oe)})}l(y);var re=c(y,2);re.__click=()=>Se.toggleMetadataExpanded(a.device.serial);var qe=o(re);l(re);var De=c(re,2);{var ie=g=>{var A=Vt(),z=o(A),$=c(o(z),2),B=o($);l($),l(z);var O=c(z,2),P=c(o(O),2),q=o(P,!0);l(P),l(O);var G=c(O,2),Z=c(o(G),2),ee=o(Z,!0);l(Z),l(G);var j=c(G,2),ve=c(o(j),2),Be=o(ve,!0);l(ve),l(j);var ae=c(j,2),Re=c(o(ae),2),Ee=o(Re,!0);l(Re),l(ae);var he=c(ae,2),Le=c(o(he),2),Ye=o(Le,!0);l(Le),l(he);var ke=c(he,2),se=c(o(ke),2),ce=o(se,!0);l(se),l(ke);var ze=c(ke,2),Fe=c(o(ze),2),Ie=o(Fe);l(Fe),l(ze),l(A),H((Je,Ca,Da)=>{x(B,`${a.device.version_major??""}.${a.device.version_minor??""}`),x(q,a.device.vendor),x(ee,a.device.product),x(Be,Je),x(Ee,a.device.group_label),x(Ye,a.device.location_label),x(ce,Ca),x(Ie,`${Da??""} dBm`)},[s,()=>i(a.device.uptime_ns),()=>a.device.wifi_signal.toFixed(1)]),w(g,A)};F(De,g=>{f(_)&&g(ie)})}var we=c(De,2);{var xe=g=>{var A=Jt(),z=te(A);z.__click=()=>Se.toggleZonesExpanded(a.device.serial);var $=o(z);l(z);var B=c(z,2);{var O=P=>{var q=Yt();ye(q,21,()=>a.device.zone_colors,Pe,(G,Z)=>{var ee=Bt();H(j=>He(ee,`background: ${j??""};`),[()=>aa(f(Z))]),w(G,ee)}),l(q),w(P,q)};F(B,P=>{f(n)&&P(O)})}H(()=>x($,`${f(n)?"▾":"▸"} ${f(n)?"Hide":"Show"} zones (${a.device.zone_colors.length??""})`)),w(g,A)},Ve=g=>{var A=fe(),z=te(A);{var $=O=>{var P=$t(),q=te(P);q.__click=()=>Se.toggleZonesExpanded(a.device.serial);var G=o(q);l(q);var Z=c(q,2);{var ee=j=>{var ve=Qt();ye(ve,21,()=>a.device.tile_devices,Pe,(Be,ae,Re)=>{var Ee=Kt(),he=o(Ee);he.textContent=`T${Re+1}`;var Le=c(he,2);{var Ye=se=>{var ce=Gt();ye(ce,21,()=>f(ae).colors.slice(0,(f(ae).width||8)*(f(ae).height||8)),Pe,(ze,Fe)=>{var Ie=Zt();H(Je=>He(Ie,`background: ${Je??""};`),[()=>aa(f(Fe))]),w(ze,Ie)}),l(ce),H(()=>He(ce,`grid-template-columns: repeat(${(f(ae).width||8)??""}, 8px);`)),w(se,ce)},ke=se=>{var ce=jt();w(se,ce)};F(Le,se=>{f(ae).colors&&f(ae).colors.length>0?se(Ye):se(ke,!1)})}l(Ee),w(Be,Ee)}),l(ve),w(j,ve)};F(Z,j=>{f(n)&&j(ee)})}H(()=>x(G,`${f(n)?"▾":"▸"} ${f(n)?"Hide":"Show"} tiles (${a.device.tile_devices.length??""})`)),w(O,P)},B=O=>{var P=fe(),q=te(P);{var G=Z=>{var ee=er(),j=o(ee);Sa(2),l(ee),H(ve=>He(j,`background: ${ve??""};`),[()=>aa(a.device.color)]),w(Z,ee)};F(q,Z=>{a.device.has_color&&a.device.color&&Z(G)},!0)}w(O,P)};F(z,O=>{a.device.has_matrix&&a.device.tile_devices&&a.device.tile_devices.length>0?O($):O(B,!1)},!0)}w(g,A)};F(we,g=>{a.device.has_multizone&&a.device.zone_colors&&a.device.zone_colors.length>0?g(xe):g(Ve,!1)})}l(d),H(()=>{x(h,a.device.serial),x(k,a.device.label),T.disabled=f(r),x(u,f(r)?"...":"Del"),W=la(I,1,"badge",null,W,{"badge-power-on":a.device.power_level>0,"badge-power-off":a.device.power_level===0}),x(R,a.device.power_level>0?"ON":"OFF"),x(J,`P${a.device.product??""}`),x(qe,`${f(_)?"▾":"▸"} ${f(_)?"Hide":"Show"} metadata`)}),w(e,d),me()}Ce(["click"]);var rr=S('<div class="no-devices">No devices emulated</div>'),ir=S('<div class="devices-grid"></div>'),sr=S('<div class="card"><h2 style="display: flex; justify-content: space-between; align-items: center;"><span> </span> <button class="btn btn-delete" title="Remove all devices from server (runtime only)"> </button></h2> <!></div>');function nr(e,a){_e(a,!0);let r=K(!1);async function t(){if(V.count===0){alert("No devices to remove");return}const b=`Remove all ${V.count} device(s) from the server?

This will stop all devices from responding to LIFX protocol packets, but will not delete persistent storage.`;if(confirm(b)){N(r,!0);try{const k=await Ma();alert(k.message)}catch(k){alert(k instanceof Error?k.message:"Failed to remove devices")}finally{N(r,!1)}}}var i=sr(),s=o(i),n=o(s),_=o(n);l(n);var d=c(n,2);d.__click=t;var m=o(d,!0);l(d),l(s);var v=c(s,2);{var p=b=>{var k=rr();w(b,k)},h=b=>{var k=ir();ye(k,21,()=>V.list,T=>T.serial,(T,u)=>{tr(T,{get device(){return f(u)}})}),l(k),w(b,k)};F(v,b=>{V.count===0?b(p):b(h,!1)})}l(i),H(()=>{x(_,`Devices (${V.count??""})`),d.disabled=f(r)||V.count===0,x(m,f(r)?"Removing...":"Remove All")}),w(e,i),me()}Ce(["click"]);var lr=S('<button class="btn btn-sm">Clear</button>'),or=S('<div style="color: var(--text-dimmed);">No activity yet</div>'),vr=S('<div style="color: var(--text-dimmed);">No matching activity</div>'),cr=S('<div class="activity-item"><span class="activity-time"> </span> <span> </span> <span class="activity-packet"> </span> <span class="device-serial"> </span> <span style="color: var(--text-dimmed);"> </span></div>'),dr=S('<div class="card"><h2>Recent Activity</h2> <div class="activity-filters"><div class="filter-group"><label for="filter-direction">Direction:</label> <select id="filter-direction"><option>All</option><option>RX</option><option>TX</option></select></div> <div class="filter-group"><label for="filter-device">Device/Target:</label> <input id="filter-device" type="text" placeholder="Filter by device..."/></div> <div class="filter-group"><label for="filter-packet">Packet:</label> <input id="filter-packet" type="text" placeholder="Filter by packet..."/></div> <!></div> <div class="activity-log"><!></div></div>');function ur(e,a){_e(a,!0);let r=K("all"),t=K(""),i=K("");function s(v){return new Date(v*1e3).toLocaleTimeString()}let n=ra(()=>()=>{let v=We.reversed;if(f(r)!=="all"&&(v=v.filter(p=>p.direction===f(r))),f(t)){const p=f(t).toLowerCase();v=v.filter(h=>h.device?.toLowerCase().includes(p)||h.target?.toLowerCase().includes(p))}if(f(i)){const p=f(i).toLowerCase();v=v.filter(h=>h.packet_name.toLowerCase().includes(p))}return v});var _=fe(),d=te(_);{var m=v=>{var p=dr(),h=c(o(p),2),b=o(h),k=c(o(b),2),T=o(k);T.value=T.__value="all";var u=c(T);u.value=u.__value="rx";var y=c(u);y.value=y.__value="tx",l(k),l(b);var I=c(b,2),W=c(o(I),2);fa(W),l(I);var R=c(I,2),U=c(o(R),2);fa(U),l(R);var J=c(R,2);{var L=C=>{var X=lr();X.__click=()=>{N(r,"all"),N(t,""),N(i,"")},w(C,X)};F(J,C=>{(f(r)!=="all"||f(t)||f(i))&&C(L)})}l(h);var E=c(h,2),M=o(E);{var D=C=>{var X=or();w(C,X)},Q=C=>{var X=fe(),pe=te(X);{var ge=oe=>{var re=vr();w(oe,re)},Xe=oe=>{var re=fe(),qe=te(re);ye(qe,17,()=>f(n)(),Pe,(De,ie)=>{var we=cr(),xe=o(we),Ve=o(xe,!0);l(xe);var g=c(xe,2),A=o(g,!0);l(g);var z=c(g,2),$=o(z,!0);l(z);var B=c(z,2),O=o(B,!0);l(B);var P=c(B,2),q=o(P,!0);l(P),l(we),H((G,Z)=>{x(Ve,G),la(g,1,mt(f(ie).direction==="rx"?"activity-rx":"activity-tx")),x(A,Z),x($,f(ie).packet_name),x(O,f(ie).device||f(ie).target||"N/A"),x(q,f(ie).addr)},[()=>s(f(ie).timestamp),()=>f(ie).direction.toUpperCase()]),w(De,we)}),w(oe,re)};F(pe,oe=>{f(n)().length===0?oe(ge):oe(Xe,!1)},!0)}w(C,X)};F(M,C=>{We.count===0?C(D):C(Q,!1)})}l(E),l(p),Ta(k,()=>f(r),C=>N(r,C)),ma(W,()=>f(t),C=>N(t,C)),ma(U,()=>f(i),C=>N(i,C)),w(v,p)};F(d,v=>{ue.value.activity_enabled&&v(m)})}w(e,_),me()}Ce(["click"]);var fr=S('<div class="container"><!> <div class="grid"><!> <!></div> <!> <div style="margin-top: 25px;"><!></div></div>');function wr(e,a){_e(a,!1),ga(()=>{be.connect()}),Ra(()=>{be.disconnect()}),sa();var r=fr(),t=o(r);At(t,{});var i=c(t,2),s=o(i);Mt(s,{});var n=c(s,2);Ot(n,{}),l(i);var _=c(i,2);nr(_,{});var d=c(_,2),m=o(d);ur(m,{}),l(d),l(r),w(e,r),me()}export{wr as component};
